function SubtitlesForLLDictionaryLoader(){function l(e){e&&2<e.length&&(null!=e[0].order?e.sort((c,m)=>c.order>=m.order?1:-1):null!=e[0].orderDesc&&e.sort((c,m)=>c.orderDesc<=m.orderDesc?1:-1));return e}this.words=new Map;this.toLang=this.fromLang=null;const n=[{regex:/^(.+)s$/m,replace:"$1"},{regex:/^(.+)es$/m,replace:"$1"},{regex:/^(.+)is$/m,replace:"$1y"},{regex:/^(.+)ron$/m,replace:"$1r"},{regex:/^(.+)o$/m,replace:"$1ar"},{regex:/^(.+)a$/m,replace:"$1ar"},{regex:/^(.+)o$/m,replace:"$1er"},{regex:/^(.+)e$/m,
replace:"$1er"},{regex:/^(.+)o$/m,replace:"$1ir"},{regex:/^(.+)e$/m,replace:"$1ir"},{regex:/^(.+)\u00e9is$/m,replace:"$1"},{regex:/^(.+)los$/m,replace:"$1"},{regex:/^(.+)zco$/m,replace:"$1cer"},{regex:/^(.+)zco$/m,replace:"$1cir"},{regex:/^(.+)as$/m,replace:"$1ar"},{regex:/^(.+)es$/m,replace:"$1er"},{regex:/^(.+)es$/m,replace:"$1ir"},{regex:/^(.+)an$/m,replace:"$1ar"},{regex:/^(.+)en$/m,replace:"$1er"},{regex:/^(.+)en$/m,replace:"$1ir"},{regex:/^(.+)amos$/m,replace:"$1ar"},{regex:/^(.+)\u00e1is$/m,
replace:"$1ar"},{regex:/^(.+)emos$/m,replace:"$1er"},{regex:/^(.+)\u00e9is$/m,replace:"$1er"},{regex:/^(.+)imos$/m,replace:"$1ir"},{regex:/^(.+)\u00eds$/m,replace:"$1ir"},{regex:/^(.+)\u00edamos$/m,replace:"$1er"},{regex:/^(.+)gamos$/m,replace:"$1er"},{regex:/^(.+)ado[s]?$/m,replace:"$1ar"},{regex:/^(.+)ada[s]?$/m,replace:"$1ar"},{regex:/^(.+)ido[s]?$/m,replace:"$1er"},{regex:/^(.+)ida[s]?$/m,replace:"$1er"},{regex:/^(.+)ido[s]?$/m,replace:"$1ir"},{regex:/^(.+)ida[s]?$/m,replace:"$1ir"},{regex:/^(.+)ndo[s]$/m,
replace:"$1r"},{regex:/^(.+)endo[s]$/m,replace:"$1r"},{regex:/^(.+)dos$/m,replace:"$1ar"}],k={en:[{regex:/^(.{2,})'s$/m,replace:"$1"},{regex:/^(?!was$|has$|his$|ass$|this$)(.{2,})s$/m,replace:"$1"},{regex:/^(.{2,})es$/m,replace:"$1"},{regex:/^(.+)ies$/m,replace:"$1y"},{regex:/^(.+)es$/m,replace:"$1is"},{regex:/^(.{2,})us$/m,replace:"$1i"},{regex:/^(?!sold$)(.{3,})d$/m,replace:"$1"},{regex:/^(.{3,})ed$/m,replace:"$1"},{regex:/^(.{2,})i[e]?d$/m,replace:"$1y"},{regex:/^(.+)([a-z])\2ed$/m,replace:"$1$2"},
{regex:/^(?!thing$|bring$|doing$)(.{2,})ing$/m,replace:"$1e"},{regex:/^(?!thing$|bring$|using$)(.{2,})ing$/m,replace:"$1"},{regex:/^(.+)ying$/m,replace:"$1ie"},{regex:/^(.+)([a-z])\2ing$/m,replace:"$1$2"},{regex:/^(.{2,})er$/m,replace:"$1e"},{regex:/^(.{2,})er$/m,replace:"$1"},{regex:/^(.{2,})or$/m,replace:"$1"},{regex:/^(.{2,})ier$/m,replace:"$1y"},{regex:/^(.{2,})ist$/m,replace:"$1"},{regex:/^(.{2,})ist$/m,replace:"$1e"},{regex:/^(.{2,})est$/m,replace:"$1e"},{regex:/^(.{2,})est$/m,replace:"$1"},
{regex:/^(.{2,})iest$/m,replace:"$1y"},{regex:/^(.{2,})ly$/m,replace:"$1e"},{regex:/^(.{2,})ly$/m,replace:"$1"},{regex:/^(.{2,})lly$/m,replace:"$1ll"},{regex:/^(.{2,})ingly$/m,replace:"$1e"},{regex:/^(.{2,})ingly$/m,replace:"$1"}],es:n,"es-419":n,ar:{regex:/^\u0648(.+)$/m,replace:"$1"},ja:[{regex:/^(.+)(?:\u304b|\u304d|\u3051|\u3053\u3046|\u3044[\u305f\u3066])$/m,replace:"$1\u304f"},{regex:/^(.+)(?:\u3055|\u3057|\u305b|\u305d\u3046|\u3057[\u305f\u3066])$/m,replace:"$1\u3059"},{regex:/^(.+)(?:\u305f|\u3061|\u3066|\u3068\u3046|\u3063[\u305f\u3066])$/m,
replace:"$1\u3064"},{regex:/^(.+)(?:\u306a|\u306b|\u306d|\u306e\u3046|\u3093[\u3060\u3067])$/m,replace:"$1\u306c"},{regex:/^(.+)(?:\u3070|\u3073|\u3079|\u307c\u3046|\u3093[\u3060\u3067])$/m,replace:"$1\u3076"},{regex:/^(.+)(?:\u307e|\u307f|\u3081|\u3082\u3046|\u3093[\u3060\u3067])$/m,replace:"$1\u3080"},{regex:/^(.+?)(?:\u3089|\u308a|\u308c|\u308d\u3046|[\u3063]?[\u305f\u3066])$/m,replace:"$1\u308b"},{regex:/^(.+)(?:\u308f|\u3044|\u3048|\u304a\u3046|\u3063[\u305f\u3066])$/m,replace:"$1\u3046"},{regex:/^(.+)\u3079$/m,
replace:"$1\u3079\u308b"},{regex:/^(.+)(?:\u304b\u3063\u305f|\u304f\u3066)$/m,replace:"$1\u3044"},{regex:/^\u3057(?:\u305f|\u3066[\u308b]?)$/m,replace:"\u3059\u308b"},{regex:/^\u3084(?:\u3063\u305f|\u3063\u3066|\u308a)$/m,replace:"\u884c\u308b"}]};this.get=(e,c,m,b,h)=>{if(null==b||0==b)e=e.toLowerCase(),b=0;return subtitlesForLL.languageCode.isNotSeparateLanguage(this.fromLang)&&"ja"!=this.fromLang&&"en"==this.toLang?0==this.words.has(e)?1<e.length&&(!c||null==c.recursiveSearch||1==c.recursiveSearch)?
this.get(e.substring(0,e.length-1),c,m):null:l(this.words.get(e)):c&&null!=c.recursiveSearch&&1!=c.recursiveSearch?l(this.words.get(e)):this.getByRegex(e,c,m,b,h)};this.getByRegex=(e,c,m,b,h,a)=>{if(null==b||0==b)e=e.toLowerCase(),b=0;null==h&&(h=e);this.words.has(e)&&(null==a&&(a=[]),a=a.concat(l(this.words.get(e))));if(k[this.fromLang]){for(;b<k[this.fromLang].length;b++)if(e=k[this.fromLang][b],h.match(e.regex))return e=h.replace(e.regex,e.replace),this.getByRegex(e,c,m,b+1,h,a);if(b>=k[this.fromLang].length&&
c&&c.enableDecreaseSearch&&1<h.length)return b=h.substring(0,h.length-1),this.getByRegex(b,c,m,0,b,a)}return a};this.load=(e,c,m)=>{this.fromLang=e;this.toLang=c;this.words=new Map;console.time("DictionaryLoader.load() \u8f9e\u66f8\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f");let b=subtitlesForLL.common.availableTokenizeLocalDictionaryName(e,c);if(null==b)console.warn("\u8aad\u307f\u8fbc\u3081\u308b\u8f9e\u66f8\u304c\u3042\u308a\u307e\u305b\u3093\u3002fromLang = "+e+", toLang="+c),m(null);else{c=
chrome.runtime.getURL("/dic/"+b+".txt");var h;fetch(c,{}).then(a=>{h=a.status;return a.text()}).then(a=>{if(200!=h)console.error("\u8f9e\u66f8\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc"),m(null);else{console.timeEnd("DictionaryLoader.load() \u8f9e\u66f8\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f");console.time("DictionaryLoader.load() \u30d1\u30fc\u30b9");switch(b){case "EJDict-hand":var f=a.split("\n");for(a=0;a<f.length;a++)if(!(null==f[a]||0>=f[a].length)){var d=f[a].split("\t");
if(!(null==d||2>d.length)){var g=d[0].split(","),q=void 0;for(var p=0;p<g.length;p++)if(!(null==g[p]||0>=g[p].length)){var r=g[p].toLowerCase().replace(/\.$/m,"");if(!(0>=r.length||1<=p&&r==q)){q=r;var t={};t.word=r;t.originalWord=d[0]||"";t.meaning=d[1]||"";t.orderDesc=Number(d[2])||0;this.words.has(r)?this.words.get(r).push(t):this.words.set(r,[t])}}}}break;case "EDict":f=a.split("\n");q=/^([^ ]+?) (?:\[([^\]]+?)\] )?\/(.*)\/EntL([0-9]+)X?\/$/m;for(a=0;a<f.length;a++)if(!(null==f[a]||0>=f[a].length))if(p=
f[a].match(q),null==p)console.warn("\u6b63\u898f\u8868\u73fe\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u884c\u304c\u3042\u308a\u307e\u3057\u305f\u3002i="+a+", array[i]="+f[a]);else if(null==p[1]||null==p[3])console.error("\u30ef\u30fc\u30c9\u304cnull\u3067\u3059\u3002array[i]="+f[a]+", m[1]="+p[1]+", m[3]="+p[3]);else{g=p[1].split(";");for(r=0;r<g.length;r++)g[r]=g[r].replace(/\(.*\)$/m,"").toLowerCase();if(p[2]){d=p[2].split(";");for(r=0;r<d.length;r++)g.push(d[r].replace(/\(.*\)$/m,""));d=p[2]}r=
p[1];meaning=p[3];p=p[4];for(t=0;t<g.length;t++){let u={};u.word=g[t];u.reading=d;u.originalWord=r;u.meaning=meaning;u.order=p;this.words.has(g[t])?this.words.get(g[t]).push(u):this.words.set(g[t],[u])}}break;case "CC-CEDict":q=/^(?!#)([^ \n]+) ([^ \n]+) \[([^\]\n]+)\] \/(.+)\/$/m;f=a.split("\n");for(a=0;a<f.length;a++)if(!(null==f[a]||0>=f[a].length))if(g=f[a].match(q),null==g)console.warn("\u6b63\u898f\u8868\u73fe\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u884c\u304c\u3042\u308a\u307e\u3057\u305f\u3002i="+
a+", array[i]="+f[a]);else if("zh-hant"==e&&null==g[1]||"zh"==e&&null==g[2]||null==g[3]||null==g[4])console.error("\u6b63\u898f\u8868\u73fe\u306b\u3088\u308b\u30c7\u30fc\u30bf\u62bd\u51fa\u304c\u6b63\u3057\u304f\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u3002array[i] = "+f[a]),console.error("  m = "+JSON.stringify(g));else for(d={},d.originalWord="zh-hant"==e?g[1]:g[2],d.reading=g[3],d.meaning=g[4],g=d.originalWord.split("\uff0c"),p=0;p<g.length;p++)0>=g[p].length||(d.word=g[p].toLowerCase(),this.words.has(d.word)?
this.words.get(d.word).push(d):this.words.set(d.word,[d]));break;case "KEngDic":f=a.split("\n");q=/^([0-9]+)\t([^\t]+)\t[^\t]*\t([^\t]*)\t[^\t]*\t[^\t]*\t[^\t]*\t[^\t]*\t([0-9]*|NULL)\t([^\t]*)/m;for(a=0;a<f.length;a++)null==f[a]||0>=f[a].length||(d=f[a].match(q),null==d?console.warn("\u6b63\u898f\u8868\u73fe\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u884c\u304c\u3042\u308a\u307e\u3057\u305f\u3002i="+a+", array[i]="+f[a]):null==d[2]||"NULL"==d[2]?console.error("\u97d3\u56fd\u8a9e\u304cnull\u3067\u3059"):
(g={},g.word=d[2].toLowerCase(),g.originalWord=d[2],d[1]&&(g.order=d[1]),d[3]&&"NULL"!=d[3]&&(g.meaning=d[3]),d[4]&&"NULL"!=d[4]&&(g.pos=d[4]),d[5]&&"NULL"!=d[5]&&(g.kanji=d[5]),this.words.has(g.word)?this.words.get(g.word).push(g):this.words.set(g.word,[g])));break;case "Yaitron-en-th":case "Yaitron-th-en":f=JSON.parse(a);for(q=0;q<f.length;q++)a=f[q],"en"==e&&(a.originalWord=a.word,a.word=a.word.toLowerCase()),this.words.has(a.word)?this.words.get(a.word).push(a):this.words.set(a.word,[a]);break;
case "en-es-en-Dic-en-es":case "en-es-en-Dic-es-en":for(q=/<c>(.+?)<\/c>[\s]*<d>(.+?)<\/d>[\s]*(?:<t>(.+?)<\/t>)?/g;d=q.exec(a);)null==d?console.warn("\u6b63\u898f\u8868\u73fe\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u884c\u304c\u3042\u308a\u307e\u3057\u305f\u3002i="+i+", array[i]="+f[i]):null==d[1]||0>=d[1].length?console.error("\u82f1\u8a9e\u304b\u30b9\u30da\u30a4\u30f3\u8a9e\u3001\u3044\u305a\u308c\u304b\u304cnull\u3067\u3059"):d[3]&&d[3].match("{phrase}")||(d[1]=d[1].replace(/^(-)|(-)$/gm,""),
g={},g.originalWord=d[1],g.word=d[1].toLowerCase(),g.meaning=d[2],g.pos=d[3],this.words.has(g.word)?this.words.get(g.word).push(g):this.words.set(g.word,[g]));break;case "en_ar_dict":f=a.split("\n");q=/^([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)$/m;for(a=0;a<f.length;a++)null==f[a]||0>=f[a].length||(d=f[a].match(q),null==d?console.warn("\u6b63\u898f\u8868\u73fe\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044\u884c\u304c\u3042\u308a\u307e\u3057\u305f\u3002i="+a+", array[i]="+f[a]):null==d[1]||null==d[3]||null==
d[4]?console.error("null\u306e\u30ef\u30fc\u30c9\u304c\u3042\u308a\u307e\u3059"):(g={},g.originalWord=d[3],g.word=d[3].toLowerCase(),g.meaning=d[4].replace(" :: "," / "),this.words.has(g.word)?this.words.get(g.word).push(g):this.words.set(g.word,[g])));break;case "English-Hindi-Dictionary":for(f=JSON.parse(a),q=0;q<f.length;q++)null==f[q]||0>=f[q].length||this.words.set(f[q][0],f[q][1])}console.timeEnd("DictionaryLoader.load() \u30d1\u30fc\u30b9");m&&m(this.words)}}).catch(a=>{console.error(a)})}}}
;function SubtitlesForLLGoogleDict(){this.search=(l,n)=>{let k;k="https://clients5.google.com/translate_a/single?client=gtx&dj=1&dt=t&dt=sp&dt=ld&dt=bd&sl="+encodeURIComponent(subtitlesForLL.languageCode.toGoogleLangCode(l.from));k+="&tl="+encodeURIComponent(subtitlesForLL.languageCode.toGoogleLangCode(l.to));k+="&q="+encodeURIComponent(l.word);l.inputEncoding&&(k+="&ie="+encodeURIComponent(l.inputEncoding));let e={responseURL:k,status:0};fetch(k,{}).then(c=>{e.status=c.status;return c.text()}).then(c=>
{e.responseText=c;n(e,null)}).catch(c=>{console.error(c);n(e,c);n=null})}};let serviceWorkerStatus="loading",langSettingsExist=null;const MIN_DEBUG=!0;chrome&&chrome.runtime&&"hlofmmmlhfelbfhcpapoackkglljfcnb"===chrome.runtime.id||MIN_DEBUG?importScripts("../common/common-min.js"):(importScripts("../common/common.js"),importScripts("../common/language-code.js"),importScripts("../service-worker/subtitles-indexeddb.js"),importScripts("../service-worker/word-separator.js"),importScripts("../service-worker/dictionary-loader.js"),importScripts("../service-worker/google-dict.js"));
importScripts("./lib/kuromoji.js");importScripts("./lib/gunzip.min.js");
(function(){function l(c){c=c?JSON.parse(JSON.stringify(c)):{};c.userIdentifier=c.userIdentifier||btoa(String.fromCharCode(...crypto.getRandomValues(new Uint8Array(32)))).substring(0,32);if(null==c.nativeLanguage||null==c.learningLanguage){console.warn("defaultConfigs() - \u8a00\u8a9e\u8a2d\u5b9a\u304c\u3042\u308a\u307e\u305b\u3093(\u4f8b\u5916)");var m=self.navigator.languages&&self.navigator.languages[0]||self.navigator.language||self.navigator.userLanguage||self.navigator.browserLanguage;c.nativeLanguage=
self.subtitlesForLL.languageCode.codes[m]?m:"en";c.learningLanguage="en"!=c.nativeLanguage?"en":"ja"}null==c.amazonRegion&&console.warn("defaultConfigs() - amazon\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\u304c\u3042\u308a\u307e\u305b\u3093(\u4f8b\u5916)");return c}function n(){this.wordSeparater=this.kuromojiTokenizer=this.googleDict=this.subtitleViewerAPIPostSubtitleInfo=this.subtitleViewerAPIGetVideoInfo=null;this.init=()=>{k&&k.learningLanguage&&k.nativeLanguage&&(langSettingsExist=!0,this.wordSeparater=
new SubtitlesForLLWordSeparater,this.wordSeparater.init(k.learningLanguage,k.nativeLanguage,c=>{}),this.setupDictionary(c=>{}));chrome.runtime.onConnect.addListener(c=>{let m=!1;c.onDisconnect.addListener(b=>{m=!0});c.onMessage.addListener(b=>{if("serviceWorkerStatus"==b.type)c.postMessage({status:serviceWorkerStatus,langSettingsExist});else if("tokenize"==b.type)this.wordSeparater.separate(b.word,b.from,b.to,h=>{c.postMessage({index:b.index,words:h})});else if("searchWord"==b.type){if(self.subtitlesForLL.common.availableLocalTranslate(b.data.from,
b.data.to)){let a=this.dicLoader.get(b.data.word,b.options,null);if(a&&0<a.length){c.postMessage({type:"local",words:a});return}}h(c,b);function h(){null==this.googleDict&&(this.googleDict=new SubtitlesForLLGoogleDict);this.googleDict.search(b.data,(a,f)=>{f={type:"googleDict",responseURL:a.responseURL,status:a.status,isError:f&&"error"==f.type};if(200==a.status)try{f.response=JSON.parse(a.responseText)}catch(d){console.error(d)}else a.responseText&&(f.responseText=a.responseText);c.postMessage(f)})}
}else"subtitleViewerAPIGetVideoInfo"==b.type?(null==this.subtitleViewerAPIGetVideoInfo&&(this.subtitleViewerAPIGetVideoInfo=new SubtitlesForLLAPI),b.data.version=e.version,this.subtitleViewerAPIGetVideoInfo.getVideoInfo(b.data,(h,a,f)=>{if(h)console.error(h),c.postMessage(null);else{h={responseURL:a.responseURL,status:a.status};if(200==a.status)try{h.responseNotEscape=JSON.parse(a.responseText),h.response=JSON.parse(a.responseText)}catch(d){console.error(d)}c.postMessage(h)}})):"subtitleViewerAPIPostSubtitleInfo"==
b.type?(null==this.subtitleViewerAPIPostSubtitleInfo&&(this.subtitleViewerAPIPostSubtitleInfo=new SubtitlesForLLAPI),this.subtitleViewerAPIPostSubtitleInfo.postSubtitleInfo({info:b.info,version:e.version},(h,a)=>{0==m&&c.postMessage({responseURL:h.responseURL,status:h.status})})):"readFile"==b.type?new SubtitlesIndexedDB("readonly",(h,a)=>{h.get(b.filePath,f=>{null==f?c.postMessage(null):c.postMessage({text:f})})}):"readSubtitleFile"==b.type?new SubtitlesIndexedDB("readonly",(h,a)=>{h.get(b.filePath+
".srt",(f,d,g)=>{d&&d.text?c.postMessage({text:d.text,type:"srt"}):f.get(b.filePath+".ass",(q,p,r)=>{p&&p.text?c.postMessage({text:p.text,type:"ssa"}):c.postMessage(null)})})}):"saveFile"==b.type?new SubtitlesIndexedDB("readwrite",(h,a)=>{h.add(b.filePath,b.text,(f,d)=>{0==m&&c.postMessage({succeeded:d?!1:!0})})}):"removeFile"==b.type?new SubtitlesIndexedDB("readwrite",(h,a)=>{h.delete(b.filePath,(f,d)=>{0==m&&c.postMessage({succeeded:d?!1:!0})})}):"removeAllFiles"==b.type?new SubtitlesIndexedDB("readwrite",
(h,a)=>{h.deleteAll((f,d)=>{d&&console.error("indexedDB\u306b\u5bfe\u3057\u3066\u306edeleteAll\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");c.postMessage({succeeded:d?!1:!0})})}):"setupDictionary"==b.type?this.setupDictionary(h=>{c.postMessage({})}):"installed"==b.type||"setupDictionary"==b.type?(k=l(b.configs),chrome.storage.sync.set(k),k&&k.nativeLanguage&&k.learningLanguage&&(langSettingsExist=!0),this.wordSeparater=new SubtitlesForLLWordSeparater,this.wordSeparater.init(k.learningLanguage,
k.nativeLanguage,h=>{}),this.setupDictionary(h=>{}),c.postMessage({})):console.warn("background.js - \u4e0d\u660e\u306atype = "+b.type)})});serviceWorkerStatus="loaded"};this.setupDictionary=c=>{this.isLoading=!0;chrome.storage.sync.get(m=>{k=m;null==k||null==k.nativeLanguage||null==k.learningLanguage?c(null):k.learningLanguage&&0<k.learningLanguage.length&&k.nativeLanguage&&0<k.nativeLanguage.length&&(this.dicLoader=new SubtitlesForLLDictionaryLoader,this.dicLoader.load(k.learningLanguage,k.nativeLanguage,
b=>{}),this.wordSeparater.dicLoader=this.dicLoader)})}}self.subtitlesForLL={};self.subtitlesForLL.common=new SubtitlesForLLCommon;self.subtitlesForLL.languageCode=new SubtitlesForLLLanguageCode;let k=null,e=chrome.runtime.getManifest();chrome.storage.sync.get(c=>{null==c||0>=Object.keys(c).length?(langSettingsExist=!1,chrome.tabs.create({url:"install.html"})):k=l(c);(new n).init()})})();function SubtitlesForLLAPI(){this.dicReq=null;this.getDictionary=(l,n)=>{let k;k="https://api2.subtitlesfll.com/v1/dictionary?from="+encodeURIComponent(l.from);k+="&to="+encodeURIComponent(l.to);k+="&word="+encodeURIComponent(l.word);this.dicReq&&this.dicReq.abort();this.dicReq=new XMLHttpRequest;this.dicReq.open("GET",k,!0);this.dicReq.timeout=5E3;this.setXUserAgent(this.dicReq,l.version);this.dicReq.onloadend=e=>{null!=n&&n&&n(this.dicReq,e)};this.dicReq.onerror=e=>{console.error(e);n(this.dicReq,
e);n=null};this.dicReq.send()};this.getVideoInfo=(l,n)=>{let k="https://api2.subtitlesfll.com/v1/info?";if(null==l.catalogId||10>l.catalogId.length)console.warn("\u5f15\u6570catalogId\u306e\u5024\u304c\u60f3\u5b9a\u5916\u3067\u3059\u3002catalogId="+catalogId),n("\u5f15\u6570catalogId\u306e\u5024\u304c\u60f3\u5b9a\u5916\u3067\u3059\u3002catalogId="+l.catalogId);else{k+="catalogId="+encodeURIComponent(l.catalogId);l.isEpisode&&(k+="&isEpisode="+(1==l.isEpisode||1<=l.isEpisode?1:0));l.lang&&(k+="&lang="+
encodeURIComponent(subtitlesForLL.languageCode.toOpensubtitlesOrgLangCode(l.lang.toLowerCase())));var e=new XMLHttpRequest;e.open("GET",k,!0);e.timeout=5E3;this.setXUserAgent(e,l.version);e.setRequestHeader("Cache-Control","no-cache");e.onloadend=c=>{n&&n(null,e,c)};e.send()}};this.postSubtitleInfo=(l,n)=>{if(!(null==l||null==l.info||0>=Object.keys(l.info).length)){var k=new XMLHttpRequest;k.open("POST","https://api2.subtitlesfll.com/v1/info",!0);k.timeout=5E3;this.setXUserAgent(k,l.version);k.setRequestHeader("Content-Type",
"application/json");k.onloadend=e=>{n&&n(k,e)};k.send(JSON.stringify(l.info))}};this.setXUserAgent=(l,n)=>{null!=n?l.setRequestHeader("X-User-Agent","SubtitlesForLearningLanguage(AmazonPrime)/"+n):l.setRequestHeader("X-User-Agent","SubtitlesForLearningLanguage(AmazonPrime)")}};function SubtitlesIndexedDB(l,n){l=l||"read";let k,e,c,m;k=indexedDB.open("subtitlesfll",2);k.onupgradeneeded=b=>{e=b.target.result;c=e.createObjectStore("subtitles",{keyPath:"key"})};k.onsuccess=b=>{e=b.target.result;m=e.transaction(["subtitles"],l);m.oncomplete=h=>{};m.onerror=h=>{h=Error("transaction.onerror: IndexedDB\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002");console.error(h);n&&n(this,h)};c=m.objectStore("subtitles");n&&n(this,null)};k.onerror=b=>{console.error("IndexedDB\u306eopen()\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")};
this.close=()=>{e&&e.close()};this.add=(b,h,a)=>{b=c.put({key:b,text:h});b.onsuccess=f=>{a(this)};b.onerror=f=>{a(this,Error("IndexedDB\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002"))}};this.get=(b,h)=>{const a=c.get(b);a.onsuccess=f=>{h(this,a.result,null)};a.onerror=f=>{h(this,null,Error("indexedDB\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u306e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002key = "+b))}};this.delete=(b,h)=>{const a=
c.delete(b);a.onsuccess=f=>{h(this)};a.onerror=f=>{h(this,Error("indexedDB\u304b\u3089\u524a\u9664\u3059\u308b\u306e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002key = "+b))}};this.deleteAll=b=>{const h=c.clear();h.onsuccess=a=>{b(this)};h.onerror=a=>{b(this,Error("indexedDB\u304b\u3089\u30c7\u30fc\u30bf\u3092\u5168\u3066\u524a\u9664\u3059\u308b\u306e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"))}}};const SubtitlesForLLWordSeparater=function(){this.kuromojiTokenizer=null;this.loadingTokenizer=!1;this.dicLoader=null;this.init=(k,e,c)=>{"ja"==k&&(console.time("kuromoji builder&build\u7d42\u4e86"),this.loadingTokenizer=!0,k=chrome.runtime.getURL("js/service-worker/lib/kuromoji_dict"),kuromoji.builder({dicPath:k}).build((m,b)=>{console.timeEnd("kuromoji builder&build\u7d42\u4e86");this.loadingTokenizer=!1;m?(console.error(m),c&&c(null)):(this.kuromojiTokenizer=b,c&&c(b))}))};const l=/(<i>|<\/i>|<b>|<\/b>|<u>|<\/u>|<br(?:[ ]?\/)?>|<ruby>|<\/ruby>|<rt>.*?<\/rt>|<font color="[#0-9a-fA-F]*">|<\/font>)|(<[^>]*?>)|([^<]+|[<])/gi,
n=new RegExp("([^"+subtitlesForLL.common.separatorRegexNotHyphenApos+"]+(?:[-'][^"+subtitlesForLL.common.separatorRegexNotHyphenApos+"]+)*)(?<!-)|(["+subtitlesForLL.common.separatorRegexNotHyphenApos+"]+)","g");this.separate=(k,e,c,m)=>{if(this.loadingTokenizer)setTimeout(this.separate,1E3,k,e,c,m);else{for(var b,h=[];null!=(b=l.exec(k));)if(b[1])h.push({tag:b[1]});else if(b[2])h.push({ignore:subtitlesForLL.common.escapeHTML(b[2])});else if(b[3])if(b=b[3],"ja"==e&&this.kuromojiTokenizer){b=this.kuromojiTokenizer.tokenize(b);
for(var a=0;a<b.length;a++)h.push({word:subtitlesForLL.common.escapeHTML(b[a].surface_form)})}else if(subtitlesForLL.common.availableTokenizeLocalDictionaryName(e))for(var f=void 0;f=n.exec(b);)if(f[1]){a=f[1];f=f[1].toLowerCase();let d=0;for(;d<f.length;){let g=d+8<f.length?d+8:f.length;for(;g>d;){let q=f.substring(d,g);if("ja"==e?null!=this.dicLoader.getByRegex(q):this.dicLoader.words.has(q)){h.push({word:subtitlesForLL.common.escapeHTML(a.substring(d,g))});d+=g-d;break}else{if(g-1<=d){h.push({word:subtitlesForLL.common.escapeHTML(a.substring(d,
g))});d++;break}g--}}}}else f[2]&&h.push({separate:subtitlesForLL.common.escapeHTML(f[2])});else if(subtitlesForLL.languageCode.isNotSeparateLanguage(e)&&"en"==c)for(a=0;a<b.length;a++)h.push({word:subtitlesForLL.common.escapeHTML(b.charAt(a))});else for(;a=n.exec(b);)a[1]?h.push({word:subtitlesForLL.common.escapeHTML(a[1])}):a[2]&&h.push({separate:subtitlesForLL.common.escapeHTML(a[2])});m(h)}}};
