function SubtitlesForLLAmazonPageChanger(){this.attach=()=>{if(location.pathname.match(/(?:\/gp\/video\/detail|.*\/dp\/.*?|^\/detail)/mi)||"www.primevideo.com"==location.host&&location.pathname.match(/.*\/detail\/.+/mi)){let a=document.body;[][0]=this._addHeaderPlayButtonWithMutations(null);let c=new MutationObserver(e=>{c.disconnect();this._addHeaderPlayButtonWithMutations(e);c.observe(a,{childList:!0,subtree:!0})});c.observe(a,{childList:!0,subtree:!0});if(0==this.addEnableButton()){let e=new MutationObserver(f=>
{e.disconnect();1!=this.addEnableButton()&&e.observe(document.body,{childList:!0,subtree:!0})});e.observe(document.body,{childList:!0,subtree:!0})}this.addEpisodePlayButtons()}};this.addEpisodePlayButtons=a=>{null==a&&(a=0);this._addEpisodePlayButtons(null);let c=document.body.querySelector(".DVWebNode");if(c){let e=new MutationObserver(f=>{e.disconnect();this._addEpisodePlayButtons(f);e.observe(c,{childList:!0,subtree:!0})});e.observe(c,{childList:!0,subtree:!0});(new MutationObserver(f=>{for(let k of f)for(let h of k.removedNodes)if(h.classList.contains("dv-fable-breakpoints")){this.addEpisodePlayButtons();
break}})).observe(document.body.querySelector(".DVWebNode-detail-btf-wrapper"),{childList:!0})}else setTimeout(()=>{10<a?console.warn("\u30a8\u30d4\u30bd\u30fc\u30c9\u8981\u7d20\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u5b57\u5e55\u518d\u751f\u30dc\u30bf\u30f3\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u518d\u8a66\u884c\u3092\u6b62\u3081\u307e\u3059"):(a++,console.warn("\u30a8\u30d4\u30bd\u30fc\u30c9\u8981\u7d20\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u5b57\u5e55\u518d\u751f\u30dc\u30bf\u30f3\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u518d\u8a66\u884c\u3057\u307e\u3059\u3002("+
a+"\u56de\u76ee)"),this.addEpisodePlayButtons(a))},500)};this._addHeaderPlayButtonWithMutations=a=>{var c=[".dv-dp-node-playback"];for(const e of c)c=null==a?document.body.querySelectorAll(e):subtitlesForLL.getTargetElementsByQuerySelectorAll(a,e),null==c||0>=c.length||this._addHeaderPlayButtonWithElems(c)};this._addHeaderPlayButtonWithElems=a=>{if(null==a||0>=a.length)return!1;for(let c of a){let e=c.querySelector("a");if(null!=e)if(0>=e.href.length||/^javascript:/.test(e.href)){let f=new MutationObserver(k=>
{e&&0<e.href.length&&0==/^javascript:/.test(e.href)&&(this._addHeaderPlayButtonWithElems([c]),f.disconnect())});f.observe(e,{attributes:!0})}else if(!c.parentElement.getElementsByClassName("link_to_subtitlesfll").item(0))try{let f='<a class="link_to_subtitlesfll" href="'+subtitlesForLL.getSubtitlePlayUrl(e.href,{enable:!0})+'" style="pointer-events:auto;"><div class="subtitles_fll_green_link" style="padding: 0px 20px 0px 20px; border-radius: 4px; color: #fff;"><span style="vertical-align: middle;"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" viewBox="100 100 300 300" style="width: 35px;height: 35px;"><g></g><path d="M152.443 136.417l207.114 119.573-207.114 119.593z" fill="#fff"></path></svg></span><span style="line-height:68px;">Subtitles for LL</span></div></a>';
c.insertAdjacentHTML("afterend",f);let k=c.parentElement.querySelector(".link_to_subtitlesfll");k.dataset.originalUrl=e.href;k.onclick=this._clickedEnableSubtitlePlayButton;return!0}catch(f){console.error(f)}}return!1};this._addEpisodePlayButtons=a=>{a=null==a?document.body.querySelectorAll("[id^=av-ep-episode-]"):subtitlesForLL.getTargetElementsByQuerySelectorAll(a,"[id^=av-ep-episode-]");if(0>=a.length)return!1;let c=document.body.querySelectorAll(".subtitles_fll_episode_link").length;for(let f=
0;f<a.length;f++){let k=a[f].querySelectorAll('a[data-automation-id="episodes-playbutton"]');if(null==k||0>=k.length||0>=k[0].href.length)continue;let h=subtitlesForLL.getSubtitlePlayUrl(k[0].href,{enable:!0});for(let b=0;b<k.length;b++){let d=k[b],g="subtitles_fll_enable_link_"+b;var e='<div class="subtitles_fll_episode_link subtitles_fll_enable_link_container_'+b+'"><a class="'+g+'" href="'+h+'" data-episode-number="'+(c+f+1)+'" style="pointer-events:auto;"><div class="subtitles_fll_green_link" style="position:relative; width:140px; height:50px; padding: 0px 20px 0px 20px;border-radius: 25px;color: #fff;display: flex; margin:0px 0px; box-sizing:content-box; user-select:none;"><div style="position:absolute; top:0; left:0; right:0; bottom:0; height:23px; margin:auto; text-align:center;"><span style="vertical-align: middle; line-height:100%;"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" viewBox="100 100 300 300" style="width: 20px;height: 20px;"><g></g><path d="M152.443 136.417l207.114 119.573-207.114 119.593z" fill="#fff"></path></svg></span>Subtitles for LL</div></div></a></div>';
null==d.parentElement.parentElement.querySelector("."+g)&&(0==b?d.insertAdjacentHTML("afterend",e):d.parentElement.insertAdjacentHTML("afterend",e),e=d.parentElement.parentElement.querySelector(".subtitles_fll_enable_link_container_"+b).querySelector("."+g),e.dataset.originalUrl=d.href,e.onclick=this._clickedEnableSubtitlePlayButton,(new MutationObserver(m=>{m=d.parentElement.parentElement.querySelector("."+g);null!=m&&(m.href=subtitlesForLL.getSubtitlePlayUrl(d.href,{enable:!0}))})).observe(d,{attributes:!0}),
subtitlesForLL.isEnabledSubtitleViewer&&d.addEventListener("click",m=>{m.preventDefault();m.stopImmediatePropagation();location.href=d.href;return!1},!0))}}return!0};this._clickedEnableSubtitlePlayButton=a=>{a.preventDefault();a.stopImmediatePropagation();a=a.currentTarget;location.href==a.href?location.reload():location.href=a.href};this._getElementsByClassNameFromMutations=(a,c)=>{let e=[];if(a)for(let f=0;f<a.length;f++)for(let k=0;k<a[f].addedNodes.length;k++){let h=subtitlesForLL.getElementsByClassNameFromAddedNode(a[f].addedNodes[k],
c);for(let b=0;h&&b<h.length;b++)e.push(h[b])}return e};this.addEnableButton=()=>{function a(){let k=chrome.runtime.getURL("/icons/logo.svg"),h=document.createElement("div");h.className="subtitles_fll_seek_enable_link";h.style.cssText="display:inline-block; height:18px; margin:0px 10px; color:#999; font-size:10px; vertical-align:top; white-space:nowrap; cursor:pointer;";let b;b=subtitlesForLL.isEnabledSubtitleViewer?"OFF":"ON";h.innerHTML='<img src="'+k+'" alt='+b+' title="'+b+'" style="width:18px; height:18px; border-radius:40%; margin:0px 5px;"><div style="display:inline-block; line-height:18px; vertical-align:top;"><span style="vertical-align:middle;">'+
b+"</span></div>";h.onclick=function(d){if(null==subtitlesForLL.currentCatalogId)console.error("currentCatalogID\u304cnull\u306a\u306e\u3067\u518d\u751fURL\u3092\u751f\u6210\u51fa\u6765\u307e\u305b\u3093\u3002");else{d={autoplay:1};var g=subtitlesForLL.getCurrentVideoTime();null!=g&&(d.t=parseInt(g));d=subtitlesForLL.getDefaultPlayUrl(subtitlesForLL.currentCatalogId,d);subtitlesForLL.isEnabledSubtitleViewer?location.href=d:(d=subtitlesForLL.getSubtitlePlayUrl(d,{enable:!0}),location.href=d);return!1}};
return h}let c,e,f=document.body.querySelector(".atvwebplayersdk-infobar-container");f?(e="beforebegin",c=f.querySelector(".atvwebplayersdk-ad-resume-message"),null==c&&(e="beforeend",c=f.querySelector(".f1iltifw")||f.querySelector(".fud1t1u")||f.querySelector(".ffzg8ke")),null==c&&1==f.children.length&&"DIV"==f.children[0].tagName&&(e="beforeend",c=f.children[0])):(e="afterbegin",c=document.body.querySelector(".bottomPanelItem .infoBar .center"));if(c){if(0<c.parentElement.getElementsByClassName("subtitles_fll_seek_enable_link").length)return!0;
c.insertAdjacentElement(e,a());return!0}return!1}};function SubtitlesForLLAmazonPrime(){function a(){function f(h){var b=document.createElement("style");b.innerText=".subtitles_fll_green_link{background-color:#009a61;}.subtitles_fll_green_link:hover{background-color:#05ab6d;}.subtitles_fll_green_link:active{background-color:#1fce8c;}.subtitles_fll_green_link:disabled{background-color:#8fc5b1;}.subtitles_fll_enable_link_container_1{margin-top:5px;}@media only screen and (max-width: 54.99em){.subtitles_fll_enable_link_container_1{display:none;}}";h.insertAdjacentElement("beforeend",
b);1==subtitlesForLL.isEnabledSubtitleViewer&&(b=document.createElement("style"),b.innerText=c,h.insertAdjacentElement("beforeend",b))}function k(){1==subtitlesForLL.isEnabledSubtitleViewer&&(subtitlesForLL.init(),null!=subtitlesForLL.configs&&subtitlesForLL.configs.hideHelpWindow||(new SubtitlesForLLHelpWindow).draw(),e.load());(new SubtitlesForLLAmazonPageChanger).attach()}if(document.getElementsByTagName("head").item(0))f(document.getElementsByTagName("head").item(0));else{let h=new MutationObserver(b=>
{for(let d=0;d<b.length;d++)for(let g=0;g<b[d].addedNodes.length;g++){let m=b[d].addedNodes[g];if("HEAD"==m.tagName){h.disconnect();h=null;f(m);return}}});h.observe(document,{childList:!0,subtree:!0})}if(!document.body){let h=new MutationObserver(b=>{for(let d=0;d<b.length;d++)for(let g=0;g<b[d].addedNodes.length;g++)if("BODY"==b[d].addedNodes[g].tagName){h.disconnect();h=null;console.log("body\u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002");return}});h.observe(document,{childList:!0,subtree:!0})}"complete"===
document.readyState||"interactive"===document.readyState?k():document.addEventListener("DOMContentLoaded",k,!1)}window.subtitlesForLL=new SubtitlesForLL;const c=".subtitles_fll_dark_green_link{background-color:#447567;}.subtitles_fll_dark_green_link:hover{background-color:#75b1a0;}.subtitles_fll_dark_green_link:active{background-color:#ca9060;}#subtitles_fll_input_button_subtitle_url:focus{outline:0;}#subtitles_fll_main_container>*{pointer-events:auto;}#subtitles_fll_contents_view{font-size:13px; user-select:text;}#subtitles_fll_contents_view a{color:#5c85ce;}#subtitles_fll_contents_view button{background-color:#5c85ce;}#subtitles_fll_contents_view button:hover{background-color:#71945e;}#subtitles_fll_contents_view button:active{background-color:#9e486c;}.subtitles_fll_bg_color_red{background-color:#9e486c !important;}.subtitles_fll_bg_color_blue{background-color:#5c85ce; !important;}.subtitles_fll_color_orange{color:#f9bc4b !important;}.subtitles_fll_color_green{color:#35b285 !important;}.subtitles_fll_color_yellow{color:#dbec84 !important;}.subtitles_fll_color_gray{color:#cecece !important;}.subtitles_fll_color_darkgray{color:#999 !important;}.subtitles_fll_hide_animation{transition:all 800ms 0s ease; opacity:0.0;}.subtitles_fll_show_animation{transition:all 200ms 0s ease; opacity:1.0;}.subtitltes_fll_user_word_delete{background-color:#9e486c !important;}#subtitles_fll_os_login_window_container{position:fixed; width:100%; height:100%; background-color:rgba(0,0,0,0.5);}#subtitles_fll_os_login_window_window{position:fixed; width:320px; height:280px;}.subtitles_fll_settngs_view input, .subtitles_fll_settngs_view select{background-color:#ddd !important;}.subtitles_fll_subtitle_selector_result_detail b{color:#ddd;}.subtitles_fll_search_result_cell{padding: 10px; border-bottom:solid 1px #444;}.subtitles_fll_search_result_cell:hover{background-color:#181818;}.subtitles_fll_search_result_title{font-size:18px; color:var(--blueColor); margin-bottom:3px; font-weight:bold;}.subtitles_fll_search_result_episode_title{font-size:0.95rem; font-weight:bold; color: var(--blueColor); margin-left:20px;}.subtitles_fll_search_result_details{color:#888; margin-left:20px; text-align:right;}.subtitles_fll_search_result_uploader{color:#888; text-align:right;}.subtitles_fll_scroll_bar::-webkit-scrollbar{width:"+
subtitlesForLL.SCROLL_BAR_WIDTH+"px;}.subtitles_fll_scroll_bar::-webkit-scrollbar-track{background:#555;}.subtitles_fll_scroll_bar::-webkit-scrollbar-thumb{background:#888; border-radius:"+.5*subtitlesForLL.SCROLL_BAR_WIDTH+"px;}.word_popup_window_scroll_bar::-webkit-scrollbar{width:"+subtitlesForLL.SCROLL_BAR_WIDTH+"px;}.word_popup_window_scroll_bar::-webkit-scrollbar-track{background:#555; border-radius:"+.5*subtitlesForLL.SCROLL_BAR_WIDTH+"px;}.word_popup_window_scroll_bar::-webkit-scrollbar-thumb{background:#888; border-radius:"+
.5*subtitlesForLL.SCROLL_BAR_WIDTH+"px;}#subtitles_fll_word_popup_window{user-select:text}#subtitles_fll_word_popup_window ul{margin:0px; padding:0px; display:block; color:#eee; list-style:inside;}#subtitles_fll_word_popup_window li{margin:0px; padding:0px; display:list-item; color:#eee !important;}.subtitles_fll_word_popup_window_meaning li::marker{margin:0px;}.subtitles_fll_comment_viewer::-webkit-scrollbar{width:"+subtitlesForLL.SCROLL_BAR_WIDTH+"px;}.subtitles_fll_comment_viewer::-webkit-scrollbar-track{background:rgba(0,0,0,0);}.subtitles_fll_comment_viewer::-webkit-scrollbar-thumb{background:rgba(136,136,136,0.5); border-radius:"+
.5*subtitlesForLL.SCROLL_BAR_WIDTH+"px;}.subtiltes_fll_comment_window_close:hover, .subtitles_fll_word_popup_window_close:hover, .subtitles_fll_adjustment_menu_close:hover{background-color:#777;}.subtiltes_fll_comment_window_close:active, .subtitles_fll_word_popup_window_close:active, .subtitles_fll_adjustment_menu_close:active{background-color:#aaa;}.subtitles_fll_adjust_button:hover{background-color:#555;}#subtitles_fll_overlay_container{user-select:text}.subtitles_fll_overlay_subtitle_cell_container{margin:auto auto 0px auto; pointer-events:auto; text-shadow:1px 1px 3px #000,1px 1px 3px #000,1px 1px 3px #000;}.subtitles_fll_cell{background-color:#222; margin-bottom:5px; padding:10px 5px; position:relative;}.subtitles_fll_cell_subtitle_container{display:inline-block; margin:0px 35px; width:295px; overflow-wrap:anywhere;}.subtitles_fll_cell_seek{position:absolute; width:20px; height:20px; margin:auto 5px; top:0; bottom:0; left:5px; cursor:pointer; user-select:none;}.subtitles_fll_cell_seek img{width:20px; height:20px;}.subtitles_fll_cell_google_translate, .subtitles_fll_cell_deepl_translate{position:absolute; width:15px; height:15px; margin:auto; top:0; bottom:0; right:5px; left:auto; box-sizing:content-box; padding:5px; user-select:none;}.subtitles_fll_cell_deepl_translate{cursor:pointer;}.subtitles_fll_cell_google_translate:hover, .subtitles_fll_cell_deepl_translate:hover{background-color:#555;}.subtitles_fll_cell_google_translate img, .subtitles_fll_cell_deepl_translate img{width:15px; height:15px; pointer-events:none;}.subtitles_fll_cell_deepl_translate{right:25px;}div#learning-level-table span{padding:0px;}div#learning-level-table span.learning-level-content{padding-right:15px;}";
if(subtitlesForLL.hashData&&1==subtitlesForLL.hashData.enable||subtitlesForLL.queryParams.subtitles_for_language_learning&&"enable"==subtitlesForLL.queryParams.subtitles_for_language_learning)subtitlesForLL.isEnabledSubtitleViewer=!0,subtitlesForLL.openSubtitlesApi=new OpenSubtitlesComAPI(!0);(function(f,k){let h=document.createElement("script");h.src=chrome.runtime.getURL(f);h.addEventListener("load",k,!1);document.getElementsByTagName("html").item(0).prepend(h)})("js/scripts/xml-http-request.js",
f=>{});var e=new function(){const f=subtitlesForLL.getElementByClassNameFromAddedNode,k=subtitlesForLL.getElementsByTagNameFromAddedNode;this.currentVideoElem=this.subtitlePlayerCtrl=null;let h,b,d,g,m;this.init=()=>{window.addEventListener("message",z=>{console.log(z);if(z.origin===window.origin&&z.source==window&&null!=z.data)if("/GetPlaybackResources"==z.data.type||"/GetVodPlaybackResources"==z.data.type){console.log("PlaybackResources: PlaybackResources\u3092\u53d6\u5f97\u3057\u307e\u3057\u305f\u3002");
let w;try{if(w=JSON.parse(z.data.body),null==w)return}catch(A){console.warn("PlaybackResources: PlaybackResources\u3092JSON.parse\u3059\u308b\u306e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");return}console.log(w);if("/GetPlaybackResources"!=z.data.type||null!=w.returnedTitleRendition&&null!=w.returnedTitleRendition.contentId)if("/GetVodPlaybackResources"!=z.data.type||null!=w.playbackData&&null!=w.playbackData.result&&null!=w.playbackData.result.contentId){var u="/GetPlaybackResources"==z.data.type?
w.returnedTitleRendition.contentId:w.playbackData.result.contentId;null==subtitlesForLL.playbackResources[u]&&(console.log("PlaybackResources: \u65b0\u898f\u306econtentId\u304c\u9001\u3089\u308c\u3066\u304d\u307e\u3057\u305f\u3002"+u),subtitlesForLL.playbackResources[u]={});w.returnedTitleRendition&&w.returnedTitleRendition.asin&&10>=w.returnedTitleRendition.asin.length&&(subtitlesForLL.playbackResources[u].asin=w.returnedTitleRendition.asin);if(w.catalogMetadata){subtitlesForLL.playbackResourcesOriginal=
w;subtitlesForLL.currentPageTitleId=w.returnedTitleRendition.titleId;let A=w.catalogMetadata;A.catalog&&(A.catalog.id&&null==subtitlesForLL.playbackResources[u].catalogId&&(console.log("PlaybackResources: \u65b0\u898f\u306ecatalogId\u304c\u9001\u3089\u308c\u3066\u304d\u307e\u3057\u305f\u3002"+A.catalog.id),subtitlesForLL.playbackResources[u].catalogId=A.catalog.id),null==subtitlesForLL.playbackResources[u].title&&(A.family&&A.family.tvAncestors&&2<=A.family.tvAncestors.length&&A.family.tvAncestors[1].catalog?
subtitlesForLL.playbackResources[u].title=A.family.tvAncestors[1].catalog.title:A.catalog.title&&(subtitlesForLL.playbackResources[u].title=A.catalog.title)),null==subtitlesForLL.playbackResources[u].images&&A.images&&(subtitlesForLL.playbackResources[u].images=A.images.imageUrls),null!=A.catalog.episodeNumber&&null==subtitlesForLL.playbackResources[u].episodeNumber&&(subtitlesForLL.playbackResources[u].episodeNumber=A.catalog.episodeNumber));A.family&&A.family.tvAncestors&&A.family.tvAncestors[0]&&
A.family.tvAncestors[0].catalog&&null!=A.family.tvAncestors[0].catalog.seasonNumber&&null==subtitlesForLL.playbackResources[u].seasonNumber&&(subtitlesForLL.playbackResources[u].seasonNumber=A.family.tvAncestors[0].catalog.seasonNumber)}if("/GetPlaybackResources"==z.data.type&&w.subtitleUrls&&0<=w.subtitleUrls.length){if(console.log("PlaybackResources: subtitleUrls\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f\u3002"),null==subtitlesForLL.playbackResources[u]||null==subtitlesForLL.playbackResources[u].subtitleUrls)subtitlesForLL.playbackResources[u].subtitleUrls=
w.subtitleUrls}else"/GetVodPlaybackResources"==z.data.type&&w.timedTextUrls&&w.timedTextUrls.result&&w.timedTextUrls.result.subtitleUrls&&0<=w.timedTextUrls.result.subtitleUrls.length&&(subtitlesForLL.playbackResources[u].subtitleUrls=w.timedTextUrls.result.subtitleUrls);if(w.widevine2License||null==w.catalogMetadata)w.widevine2License?console.log("PlaybackResources: widevine2License\u304c\u9001\u3089\u308c\u3066\u304d\u307e\u3057\u305f\u3002"):null==w.catalogMetadata&&console.log("PlaybackResources: catalogMetadata\u3092\u542b\u307e\u306a\u3044\u30c7\u30fc\u30bf\u304c\u9001\u3089\u308c\u3066\u304d\u307e\u3057\u305f\u3002"),
subtitlesForLL.currentContentId!=u&&(console.log("PlaybackResources: currentContentId\u3068\u3001currentCatalogId\u306e\u66f4\u65b0\u3092\u3057\u307e\u3059\u3002catalogId = "+subtitlesForLL.playbackResources[u].catalogId+", contentId = "+u),subtitlesForLL.currentContentId=u,subtitlesForLL.currentCatalogId=subtitlesForLL.parseAsinFromAmazonURL(location.href),console.log("isReceivedNewCatalogId = true\u3092\u5b9f\u884c"),B=!0,x())}else console.warn("PlaybackResources: amazon\u306e/GetVodPlaybackResources\u306b\u305f\u3044\u3059\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u306bcontentId\u304c\u3042\u308a\u307e\u305b\u3093(\u60f3\u5b9a\u5916\u306e\u30ec\u30b9\u30dd\u30f3\u30b9)");
else console.warn("PlaybackResources: amazon\u306e/GetPlaybackResources\u306b\u305f\u3044\u3059\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u306breturnedTitleRendition\u30ad\u30fc\u304c\u542b\u307e\u308c\u306a\u3044\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u3042\u308a\u307e\u3057\u305f\u3002(\u60f3\u5b9a\u5916\u306e\u30ec\u30b9\u30dd\u30f3\u30b9)")}else"/getDetailPage"==z.data.type&&(z=z.data.data,console.log("content.js - \u8ffd\u52a0\u30a8\u30d4\u30bd\u30fc\u30c9\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f\u3002"),
console.log(z),subtitlesForLL.additionalEpisodeDataArray.push(z))});window.addEventListener("beforeunload",z=>{console.log("beforeunload")})};this.load=()=>{0!=subtitlesForLL.isEnabledSubtitleViewer&&("complete"===document.readyState||"interactive"===document.readyState?this._loadedDOMContent():document.addEventListener("DOMContentLoaded",this._loadedDOMContent,!1))};this._loadedDOMContent=()=>{console.log("SVfLL - content.js - loadedDOMContent()");p()};const p=()=>{if(h=document.getElementById("dv-web-player"))if(b=
h.getElementsByClassName("webPlayerElement").item(0)||h.getElementsByClassName("webPlayerSDKContainer").item(0)){subtitlesForLL.webPlayerElement=b;let u=b.getElementsByTagName("video");y(u);d=b.getElementsByClassName("atvwebplayersdk-seekbar-range").item(0);null==d&&(d=b.querySelector(".seekBar .positionBar"))&&(subtitlesForLL.isChromeOSMode=!0);g=b.getElementsByClassName("atvwebplayersdk-infobar-container").item(0)||b.getElementsByClassName("infoBar").item(0);m=b.getElementsByClassName("atvwebplayersdk-playerclose-button").item(0)||
b.getElementsByClassName("closeButtonWrapper").item(0)}if(x())console.log("\u5fc5\u8981\u306a\u8981\u7d20\u304c\u63c3\u3044\u307e\u3057\u305f(MutationObserver\u306a\u3057)");else{console.log("\u5fc5\u8981\u306a\u8981\u7d20\u304c\u63c3\u3046\u307e\u3067\u5f85\u6a5f\u3057\u307e\u3059\u3002");var z=new MutationObserver(u=>{for(let w=0;w<u.length;w++)for(let A=0;A<u[w].addedNodes.length;A++){let F=u[w].addedNodes[A];if(null!=F.classList){null==h&&(h=document.getElementById("dv-web-player"))&&console.log("dvWebPlayerElem\u53d6\u5f97");
null==b&&(b=f(F,"webPlayerElement")||f("webPlayerSDKContainer"),null==b&&(F.classList.contains("webPlayerSDKContainer")||F.ariaLabel&&0==F.ariaLabel.search(/Web player/i))&&(b=F),b&&(console.log(".webPlayerElement\u53d6\u5f97"),subtitlesForLL.webPlayerElement=b));if(b){let n=k(F,"VIDEO");y(n)}if(b&&null==d&&(d=f(F,"atvwebplayersdk-seekbar-range"),null==d)){let n=f(F,"positionBar");if(n&&"seekBar"==n.parentElement.parentElement.className){let l=new MutationObserver(q=>{console.log("seekBarMO() - positionBar.style.width = "+
n.style.width);n.style.width&&0<n.style.width.length&&(l.disconnect(),l=null,d=n,subtitlesForLL.isChromeOSMode=!0,h&&b&&d&&g&&null==this.subtitlePlayerCtrl&&x())});l.observe(n,{attributes:!0})}}b&&null==g&&(g=f(F,"atvwebplayersdk-infobar-container")||f(F,"infoBar"));h&&null==m&&(m=f(F,"atvwebplayersdk-playerclose-button")||f(F,"closeButtonWrapper"));h&&b&&d&&g&&null==this.subtitlePlayerCtrl&&(z.disconnect(),console.log("content.js - SubtitlePlayer\u3092\u751f\u6210\u3057\u307e\u3059\u3002"),console.log(this),
x())}}});z.observe(document.body,{childList:!0,subtree:!0})}};let B=!1;const y=z=>{for(let u=0;u<z.length;u++){let w=z[u];w.addEventListener("loadstart",A=>{console.log("new LOAD START VIDEO");t(A)},!1);w.addEventListener("loadedmetadata",t,!1);w.addEventListener("loadeddata",t,!1);w.addEventListener("canplaythrough",t,!1);w.addEventListener("play",t,!1)}},t=z=>{this.currentVideoElem!=z.target&&(this.currentVideoElem=z.target);x()},x=()=>{console.log("checkLoadedNecessaryElements()\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002isReceivedNewCatalogId == "+
B);if(!(h&&b&&this.currentVideoElem&&d))return console.log("\u307e\u3060\u5fc5\u8981\u306a\u8981\u7d20\u304c\u7121\u3044\u304b\u3001currentCatalogId\u3084video\u8981\u7d20\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),!1;if(0==B&&this.subtitlePlayerCtrl&&this.currentVideoElem==this.subtitlePlayerCtrl.videoElem)return console.log("currentCatalogId\u3084video\u8981\u7d20\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u305b\u3093"),
!1;subtitlesForLL.setDirection(window.getComputedStyle(b).direction);null==this.subtitlePlayerCtrl?(this.subtitlePlayerCtrl=new SubtitlesForLLPlayerController,this.subtitlePlayerCtrl.isReceivedNewCatalogId=B,this.subtitlePlayerCtrl.closeCallback=()=>{console.log("closeCallback()")},this.subtitlePlayerCtrl.init(h,b,this.currentVideoElem,d),(new MutationObserver(z=>{console.log("MutationObserver - \u65b0\u898fVideo\u306e\u691c\u77e5\u51e6\u7406");z.forEach(u=>{u.addedNodes.forEach(w=>{"VIDEO"==w.tagName&&
(console.log("\u65b0\u898f\u306bVIDEO\u30bf\u30b0\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\u3069\u308c\u304c\u52d5\u753b\u518d\u751f\u7528\u306eVideo\u304b\u691c\u77e5\u3059\u308b\u305f\u3081\u3001EventListner\u3092\u4ed8\u3051\u307e\u3059"),console.log(w),y([w]))})})})).observe(this.currentVideoElem.parentElement,{childList:!0})):(0==this.subtitlePlayerCtrl.isClosed&&B&&this.subtitlePlayerCtrl.close(),this.subtitlePlayerCtrl.videoElem!=this.currentVideoElem&&this.subtitlePlayerCtrl.changeVideoElem(this.currentVideoElem),
B&&this.subtitlePlayerCtrl.setReceivedNewCatalogId(B));B=!1;return!0}};subtitlesForLL.setSubtitleViewer(e);e.init();chrome.storage.sync.get(f=>{null==f||0>=Object.keys(f).length?(f=chrome.runtime.getURL("install.html"),f+="?ref="+encodeURIComponent(location.href),location.href=f):(f.userDictionaryRules=f.userDictionaryRules||[],f.subtitleFontSizeVW=f.subtitleFontSizeVW||2.2,f.subtitleScrollViewFontSize=f.subtitleScrollViewFontSize||20,f.dictionaryFontSize=f.dictionaryFontSize||15,f.dictionaryBackgroundAlpha=
f.dictionaryBackgroundAlpha||.8,f.quickBackSec=f.quickBackSec||2,subtitlesForLL.setConfigs(f),null!=f.userWords&&"string"==typeof f.userWords&&2<f.userWords.length&&subtitlesForLL.setUserWords(new Map(JSON.parse(f.userWords))),subtitlesForLL.amazon=new SubtitlesForLLAmazon,subtitlesForLL.localize=new SubtitlesForLLLocalize(f),a())})};function SubtitlesForLLAmazonUIChanger(a){let c=subtitlesForLL.localize.localize;this.brightness=1;this.subtitlePosition=this.subtitleTimingDifferenceCallback=null;this.defaultTiming=this.timing=0;this.subtitlesMainContainer=this.webPlayerSDKContainer=this.dvWebPlayerElem=this.overlaySubtitleContainerElem=this.adjustmentMenuButtonElem=this.adjustmentMenuElem=null;this.video=a;this.clickedButtonCallback=null;this.changeVideoElem=b=>{this.video=b;this.video.addEventListener("play",d=>{e(!1)});this.video.addEventListener("pause",
d=>{e(!0)})};this.changeAmazonStyle=()=>{if(null==document.head.querySelector(".subtitles_fll_amazon")){let b=document.createElement("style");b.classList.add("subtitles_fll_amazon");b.innerText=".atvwebplayersdk-overlays-container .f13stccg{padding:0px 20px;}.webPlayerUIContainer{overflow:hidden;}.f1oe4mb3{display:none !important;}.atvwebplayersdk-bottompanel-container{bottom:0px; top:auto; position:absolute; padding-left:20px !important; padding-right:20px !important; height:auto !important; white-space:nowrap; flex-basis:0px; z-index:2;}.atvwebplayersdk-playpause-button, .atvwebplayersdk-fastseekback-button, .atvwebplayersdk-fastseekforward-button{display:none !important;}.atvwebplayersdk-ad-resume-message{min-width:10px;}.pausedOverlay .buttons{display:none !important;}.bottomPanel{position:absolute; bottom:0px;}.bottomPanel .bottomPanelItem{display:block !important;}.persistentPanel span{padding:0px !important;}.persistentPanel div{width:100% !important;}.persistentPanel>div{height:100% !important;}.infoBar .left{min-width:250px;}.nextTitleButton{white-space:nowrap;}.fkpovp9{background:rgba(0,0,0,0) !important;}div.fk87jrb{position:absolute; top:auto; bottom:0px; height:auto;}.atvwebplayersdk-captions-overlay{position:absolute; margin-top:0px !important; white-space:nowrap;}div.f1iwgj00>div{width:100% !important;}.fbhsa9{padding:0px !important;}.atvwebplayersdk-captions-text{padding:0px !important;}.fif0hcs{min-width:auto !important;}.subtitles_fll_fadeout_animation{animation:0.1s ease 0s SubtitleViewerFadeOut;} @keyframes SubtitleViewerFadeOut{0%{opacity:1} 100%{opacity:0}}.webPlayerSDKContainer .fofauj8, .cascadesContainer .gradientOverlay{background-color: rgba(0,0,0,0) !important;}";
document.head.insertAdjacentElement("beforeend",b)}this.webPlayerSDKContainer&&(this.webPlayerSDKContainer.getElementsByClassName("scalingVideoContainer")[0].style.width="calc(100% - "+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px)",(this.webPlayerSDKContainer.getElementsByClassName("webPlayerUIContainer")[0]||this.webPlayerSDKContainer.getElementsByClassName("scalingUiContainer")[0]).style.width="calc(100% - "+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px)")};this.resetAmazonStyle=()=>{var b=
document.head.querySelector(".subtitles_fll_amazon");b&&b.remove();if(b=this.webPlayerSDKContainer.querySelector(".scalingVideoContainer"))b.style.width="100%";if(b=this.webPlayerSDKContainer.getElementsByClassName("webPlayerUIContainer")[0]||this.webPlayerSDKContainer.getElementsByClassName("scalingUiContainer")[0])b.style.width="100%"};this.change=()=>{this.changeAmazonStyle();if(this.dvWebPlayerElem=document.getElementById("dv-web-player")){this.webPlayerSDKContainer=this.dvWebPlayerElem.querySelector(".webPlayerSDKContainer")||
this.dvWebPlayerElem.querySelector(".webPlayerElement .cascadesContainer");null==this.subtitlesMainContainer&&(this.subtitlesMainContainer=document.createElement("div"),this.subtitlesMainContainer.id="subtitles_fll_main_container",this.subtitlesMainContainer.style.cssText="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none;",this.webPlayerSDKContainer.insertAdjacentElement("beforeend",this.subtitlesMainContainer));var b=this.webPlayerSDKContainer.getElementsByClassName("scalingVideoContainer")[0];
b.style.width="calc(100% - "+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px)";var d=this.webPlayerSDKContainer.getElementsByClassName("webPlayerUIContainer")[0]||this.webPlayerSDKContainer.getElementsByClassName("scalingUiContainer")[0];d.style.width="calc(100% - "+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px)";0==subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)?(b.style.left="0px",d.style.marginLeft="0px",d.style.marginRight="auto"):(b.style.right="0px",d.style.marginLeft=
"auto",d.style.marginRight="0px");null==this.overlayContainer&&(this.overlayContainer=document.createElement("div"),this.overlayContainer.id="subtitles_fll_overlay_container",this.overlayContainer.style.cssText="position:absolute; width:calc(100% - 400px); height:100%; pointer-events:none; top:0px; left:0px; font-size:14px;",this.overlayContainer.innerHTML='<div style="width:100%; height:100%;"><div style="margin:0; width:100%; height:100%; min-height:0px;"></div><div class="subtitles_fll_overlay_subtitle_container" style="position:absolute; margin:0; padding:0px 5px; width:100%; text-align:center; color:#ddd; font-size:'+
subtitlesForLL.configs.subtitleFontSizeVW+'vw; font-weight:normal;"></div>',this.subtitlesMainContainer.appendChild(this.overlayContainer),this.overlaySubtitleContainerElem=this.overlayContainer.getElementsByClassName("subtitles_fll_overlay_subtitle_container")[0],this.overlayCenterContainer=this.overlayContainer.getElementsByClassName("subtitles_fll_overlay_center_container")[0]);(new ResizeObserver(p=>{this.refreshSubtitlePosition();this.refreshAmazonSubtitlePosition()})).observe(this.overlaySubtitleContainerElem.parentElement,
{attributes:!0,attributeFilter:["width","height"]})}b=this.webPlayerSDKContainer.getElementsByClassName("atvwebplayersdk-infobar-container").item(0);if(null!=b)var g=b.children[0];else(b=this.webPlayerSDKContainer.getElementsByClassName("infoBar").item(0))&&(g=b.getElementsByClassName("left").item(0));if(null==g)console.warn("amazon\u306e.atvwebplayersdk-infobar-container\u306echildNodes\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002(\u60f3\u5b9a\u5916)"),console.warn(b.length);
else{d=document.createElement("button");d.ariaLabel="Seek Forward 10 seconds";d.style.cssText="position:relative; width:18px; min-width:18px; height:18px; margin:0px 5px; margin-right:10px; padding:0px; overflow:hidden;";d.innerHTML='<img style="margin:0px; width:18px; height:18px;" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODUiIHZpZXdCb3g9IjAgMCA4MCA4NSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+MTBzIGZvcndhcmQ8L3RpdGxlPjxwYXRoIGQ9Ik02NC4yNCAxNC40NzhsLTMuMjY5IDEuNzUzYzguOTcyIDYuNTU5IDE0LjgwNCAxNy4xNTYgMTQuODA0IDI5LjEyMSAwIDE5LjkxMy0xNi4xNDMgMzYuMDU2LTM2LjA1NyAzNi4wNTYtMTkuOTEzIDAtMzYuMDU2LTE2LjE0My0zNi4wNTYtMzYuMDU2IDAtMTguMjQgMTMuNTQ3LTMzLjMwOCAzMS4xMjctMzUuNzEzdjQuODY4cy0uMDA4Ljk2OC4zMDUgMS4xMDNjLjQyNS4xODMgMS4wNC0uMjI0IDEuMDQtLjIyNEw0OC4wMSA5LjA0OXMuODE4LS4zODYuODE4LS43NGMwLS40MjItLjgxNy0uNzk3LS44MTctLjc5N0wzNS44MzcuODk4cy0uMzY5LS4yNjQtLjc3Mi0uMDQ4Yy0uMjkuMTU0LS4yNzYuODIzLS4yNzYuODIzVjYuMjRDMTUuMzM3IDguNjY2LjI4MiAyNS4yNDMuMjgyIDQ1LjM1MmMwIDIxLjc4IDE3LjY1NiAzOS40MzcgMzkuNDM2IDM5LjQzN3MzOS40MzctMTcuNjU3IDM5LjQzNy0zOS40MzdjMC0xMi41MS01LjgzMS0yMy42NS0xNC45MTUtMzAuODc0IiBmaWxsPSIjRkZGIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=" alt=""><div style="position: absolute; width: 18px; height: 12px; text-align: center; font-size: 10px; margin: auto; top: 0; left: -1px; bottom: 0; right: 0; ">10</div>';
d.onclick=p=>{this.clickedButtonCallback("fastSeekForward")};g.insertAdjacentElement("afterbegin",d);this.playButton=document.createElement("button");this.playButton.style.cssText="position:relative; width:14px; min-width:14px; height:18px; margin:0px 10px; padding:0px; display:none; overflow:hidden;";this.playButton.innerHTML='<img style="margin:0px; width:14px; height:14px; position:absolute;top: 0;left: 0;bottom: 0;right: 0;margin: auto;" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCAwIDkwIDkwIj48cGF0aCBmaWxsPSIjRkZGIiBkPSJNODguMTY0IDQyLjc2MWMyLjQ0NyAxLjIzNyAyLjQ0NyAzLjI0MSAwIDQuNDc4TDQuNDM0IDg5LjUxNEMxLjk4NSA5MC43NSAwIDg5LjU0NyAwIDg2LjgzVjMuMTY5QzAgLjQ1IDEuOTg1LS43NTEgNC40MzQuNDg2bDgzLjczIDQyLjI3NXoiLz48L3N2Zz4=" alt="Play">';
this.playButton.onclick=p=>{this.clickedButtonCallback("play")};g.insertAdjacentElement("afterbegin",this.playButton);this.pauseButton=document.createElement("button");this.pauseButton.ariaLabel="";this.pauseButton.style.cssText="position:relative; width:14px; min-width:14px; height:18px; margin:0px 10px; padding:0px; display:block; overflow:hidden;";this.pauseButton.innerHTML='<img style="margin:0px; width:14px; height:14px; position: absolute;top: 0;left: 0;bottom: 0;right: 0;margin: auto;" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NSIgaGVpZ2h0PSI5NSIgdmlld0JveD0iMCAwIDc1IDk1Ij48cGF0aCBmaWxsPSIjRkZGIiBkPSJNMCAwaDI1djk1SDB6TTUwIDBoMjV2OTVINTB6Ii8+PC9zdmc+" alt="Pause">';
this.pauseButton.onclick=p=>{this.clickedButtonCallback("pause")};g.insertAdjacentElement("afterbegin",this.pauseButton);this.video.paused&&e(!0);this.video.addEventListener("play",p=>{e(!1)});this.video.addEventListener("pause",p=>{e(!0)});d=document.createElement("button");d.ariaLabel="Seek Back 10 seconds";d.style.cssText="position:relative; width:18px; min-width:18px; height:18px; margin:0px 5px; padding:0px; overflow:hidden;";d.innerHTML='<img style="margin:0px; width:18px; height:18px;" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODUiIHZpZXdCb3g9IjAgMCA4MCA4NSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+MTBzIGJhY2s8L3RpdGxlPjxwYXRoIGQ9Ik0xNS4xOTcgMTQuNDc4bDMuMjY4IDEuNzUzQzkuNDk1IDIyLjc5IDMuNjYyIDMzLjM4NyAzLjY2MiA0NS4zNTJjMCAxOS45MTMgMTYuMTQzIDM2LjA1NiAzNi4wNTYgMzYuMDU2IDE5LjkxNCAwIDM2LjA1Ny0xNi4xNDMgMzYuMDU3LTM2LjA1NiAwLTE4LjI0LTEzLjU0Ny0zMy4zMDgtMzEuMTI3LTM1LjcxM3Y0Ljg2OHMuMDA4Ljk2OC0uMzA1IDEuMTAzYy0uNDI1LjE4My0xLjA0LS4yMjQtMS4wNC0uMjI0TDMxLjQyOCA5LjA0OXMtLjgxOC0uMzg2LS44MTgtLjc0YzAtLjQyMi44MTYtLjc5Ny44MTYtLjc5N0w0My42Ljg5OHMuMzY4LS4yNjQuNzcyLS4wNDhjLjI5LjE1NC4yNzYuODIzLjI3Ni44MjNWNi4yNGMxOS40NTEgMi40MjcgMzQuNTA3IDE5LjAwNCAzNC41MDcgMzkuMTEzIDAgMjEuNzgtMTcuNjU2IDM5LjQzNy0zOS40MzcgMzkuNDM3LTIxLjc4IDAtMzkuNDM2LTE3LjY1Ny0zOS40MzYtMzkuNDM3IDAtMTIuNTEgNS44My0yMy42NSAxNC45MTUtMzAuODc0IiBmaWxsPSIjRkZGIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=" alt=""><div style="position: absolute; width: 18px; height: 12px; text-align: center; font-size: 10px; margin: auto; top: 0; left: -1px; bottom: 0; right: 0; ">10</div>';
d.onclick=p=>{this.clickedButtonCallback("fastSeekBack")};g.insertAdjacentElement("afterbegin",d);this.changeBrightness(subtitlesForLL.configs.brightness||1);this.changeContrast(subtitlesForLL.configs.contrast||1);this.changeSaturate(subtitlesForLL.configs.saturate||1);this.changePlaybackRate(subtitlesForLL.configs.playbackRate||1);k(subtitlesForLL.configs.subtitlePosition||0);d=document.createElement("div");d.classList.add("subtitles_fll_adjust_button");this.adjustmentMenuButtonElem=d;d.style.cssText=
"margin:0px; padding:0px 10px; cursor:pointer;";var m=chrome.runtime.getURL("icons/adjust.svg");d.innerHTML='<img src="'+m+'" style="margin:0px; width:30px; min-width:30px; height:18px; object-fit:cover;">';d.onclick=p=>{this.showAdjustmentMenu()};0==subtitlesForLL.isChromeOSMode?(b=g.querySelector(".atvwebplayersdk-ad-resume-message"),null!=b?b.insertAdjacentElement("beforebegin",d):g.insertAdjacentElement("beforeend",d)):(g=b.getElementsByClassName("right").item(0))?g.insertAdjacentElement("afterbegin",
d):console.error("\u30e1\u30fc\u30bf\u30fc\u30a2\u30a4\u30b3\u30f3\u306e\u8868\u793a\u5148\u306e\u8981\u7d20\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093")}};const e=b=>{this.playButton.style.display=b?"block":"none";this.pauseButton.style.display=b?"none":"block"};this.refreshSubtitlePosition=()=>{let b=this.overlaySubtitleContainerElem.parentElement.clientHeight/2+this.overlaySubtitleContainerElem.parentElement.clientWidth*(0<this.video.videoWidth&&0<this.video.videoHeight?this.video.videoHeight/
this.video.videoWidth:.42)/2+(null!=this.subtitlePosition?this.subtitlePosition:0);b+this.overlaySubtitleContainerElem.clientHeight>this.overlaySubtitleContainerElem.parentElement.clientHeight&&(b=this.overlaySubtitleContainerElem.parentElement.clientHeight-this.overlaySubtitleContainerElem.clientHeight);this.overlaySubtitleContainerElem.style.top=b+"px"};this.refreshAmazonSubtitlePosition=()=>{var b=this.webPlayerSDKContainer.getElementsByClassName("atvwebplayersdk-captions-overlay").item(0),d=this.overlaySubtitleContainerElem.getBoundingClientRect();
if(b){d=.42;this.video&&0<this.video.videoWidth&&0<this.video.videoHeight&&(d=this.video.videoHeight/this.video.videoWidth);d*=this.overlaySubtitleContainerElem.parentElement.clientWidth;var g=.5*(this.overlaySubtitleContainerElem.parentElement.clientHeight-d)+30;b.style.top=(0<g?g:0)+"px";b.style.height=Math.min(d+100,this.overlaySubtitleContainerElem.parentElement.clientHeight)+"px"}else if((b=this.webPlayerSDKContainer.getElementsByClassName("persistentPanel").item(0))&&0<b.children.length){for(;;){g=
b.getElementsByTagName("div").item(0);if(null==g)break;b=g}b.style.bottom=this.webPlayerSDKContainer.clientHeight-d.top+"px"}};this.showAdjustmentMenu=()=>{let b=this.webPlayerSDKContainer;var d=b.getBoundingClientRect();let g=this.adjustmentMenuButtonElem.getBoundingClientRect();var m=window.pageXOffset+g.right-(d.left+window.pageXOffset)-200;d=d.height-g.top+20;this.adjustmentMenuElem?(this.adjustmentMenuElem.style.bottom=d+"px",this.adjustmentMenuElem.style.left=m+"px",this.adjustmentMenuElem.style.display=
"block",this.changePlaybackRate(this.video.playbackRate)):(m='<div class="subtitles_fll_adjustment_menu_window" style="position:absolute; font-size:14px; white-space:nowrap; overflow:hidden; width:300px; top:auto; bottom:'+d+"px; left:"+m+'px; background-color:rgba(50,50,50,0.7); z-index:10000; border-radius:30px; color:#ddd;"><div style=""><div class="subtitles_fll_adjustment_menu_close" style="width:20px; height:20px; margin:10px; margin-left:auto; padding:10px; box-sizing:content-box; border-radius:50%; cursor:pointer;"><svg viewBox="0 0 612 612" xmlns="http://www.w3.org/2000/svg"><g><line stroke="#ddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_1" y2="561.45315" x2="561.49999" y1="48.45311" x1="51.5" stroke-width="99" fill="none"/><line stroke="#ddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_2" y2="562" x2="561" y1="50" x1="50" stroke-width="99" fill="none"/><line transform="rotate(90 305.5,306.00000000000006) " stroke="#ddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_4" y2="562" x2="561" y1="50" x1="50" stroke-width="99" fill="none"/></g></svg></div></div><div style="text-wrap:wrap; padding:10px; font-weight:bold; color: red;">'+
c("If the value exceeds the range adjustable with the slider, please adjust using the numerical input box.")+'</div><div style="margin:10px;"><div style="margin:0px 10px;">'+c("Subtitle timing")+'</div><div style="display:flex; width:100%;"><div style="flex-grow:1;"><input class="subtitles_fll_input_range_subtitle_timing" type="range" value="'+Number(this.timing)+'" min="-20" max="20" step="0.5" style="width:100%; height:5px; background:#ddd; appearance:none; border-radius:3px; outline:none;"></div><div style="flex-grow:0; width:65px; margin:0px 10px;"><input class="subtitles_fll_input_text_subtitle_timing" type="number" value="'+
Number(this.timing)+'" step="0.5" style="width:100%; height:25px; border-radius:10px; border:none; text-align:right; background-color:#ddd;"></div></div></div><div style="margin:10px;"><div style="margin:0px 10px;">'+c("Subtitle position")+'</span></div><div style="display:flex; width:100%;"><div style="flex-grow:1;"><input class="subtitles_fll_input_range_subtitle_pos" type="range" min="-100" max="100" step="1" value="'+this.subtitlePosition+'" style="width:100%; height:5px; background:#ddd; appearance:none; border-radius:3px; outline:none;"></div><div style="flex-grow:0; width:65px; margin:0px 10px;"><input class="subtitles_fll_input_text_subtitle_pos" type="number" min="-100" max="100" step="1" value="'+
this.subtitlePosition+'" style="width:100%; height:25px; border-radius:10px; border:none; text-align:right; background-color:#ddd;"></div></div></div><hr style="border:none; border-bottom:solid 1px #888; margin-top:20px;"><div style="margin:10px;"><div style="margin:0px 10px;">'+c("Playback rate")+'</span></div><div style="display:flex; width:100%;"><div style="flex-grow:1;"><input class="subtitles_fll_input_range_playback" type="range" min="0.1" max="2" step="0.1" value="'+this.video.playbackRate+
'" style="width:100%; height:5px; background:#ddd; appearance:none; border-radius:3px; outline:none;"></div><div style="flex-grow:0; width:65px; margin:0px 10px;"><input class="subtitles_fll_input_text_playback" type="number" min="0.1" max="2" step="0.1" value="'+this.video.playbackRate+'" style="width:100%; height:25px; border-radius:10px; border:none; text-align:right; background-color:#ddd;"></div></div></div><div style="margin:10px;"><div style="margin:0px 10px;">'+c("Video brightness")+'</div><div style="display:flex; width:100%;"><div style="flex-grow:1;"><input class="subtitles_fll_input_range_brightness" type="range" min="0.0" max="4.0" step="0.1" value="'+
this.brightness+'" style="width:100%; height:5px; background:#ddd; appearance:none; border-radius:3px; outline:none;"></div><div style="flex-grow:0; width:65px; margin:0px 10px;"><input class="subtitles_fll_input_text_brightness" type="number" min="0.0" max="4.0" step="0.1" value="'+this.brightness+'" style="width:100%; height:25px; border-radius:10px; border:none; text-align:right; background-color:#ddd;"></div></div></div><div style="margin:10px;"><div style="margin:0px 10px;">'+c("Video contrast")+
'</div><div style="display:flex; width:100%;"><div style="flex-grow:1;"><input class="subtitles_fll_input_range_contrast" type="range" min="0.0" max="2.0" step="0.1" value="'+this.contrast+'" style="width:100%; height:5px; background:#ddd; appearance:none; border-radius:3px; outline:none;"></div><div style="flex-grow:0; width:65px; margin:0px 10px;"><input class="subtitles_fll_input_text_contrast" type="number" min="0.0" max="2.0" step="0.1" value="'+this.contrast+'" style="width:100%; height:25px; border-radius:10px; border:none; text-align:right; background-color:#ddd;"></div></div></div><div style="margin:10px;"><div style="margin:0px 10px;">'+
c("Video saturate")+'</div><div style="display:flex; width:100%;"><div style="flex-grow:1;"><input class="subtitles_fll_input_range_saturate" type="range" min="0.0" max="2.0" step="0.1" value="'+this.saturate+'" style="width:100%; height:5px; background:#ddd; appearance:none; border-radius:3px; outline:none;"></div><div style="flex-grow:0; width:65px; margin:0px 10px;"><input class="subtitles_fll_input_text_saturate" type="number" min="0.0" max="2.0" step="0.1" value="'+this.saturate+'" style="width:100%; height:25px; border-radius:10px; border:none; text-align:right; background-color:#ddd;"></div></div></div><div style="text-align:center; margin-bottom:20px;"><button class="subtitles_fll_reset_button subtitles_fll_bg_color_red" style="width:100px; height:40px; text-align:center; border-radius:20px;">'+
c("Reset")+"</button></div></div>",b.insertAdjacentHTML("beforeend",m),this.adjustmentMenuElem=b.getElementsByClassName("subtitles_fll_adjustment_menu_window")[0],b.getElementsByClassName("subtitles_fll_adjustment_menu_close")[0].onclick=p=>{this.hideAdjustmentMenu()},m=b.getElementsByClassName("subtitles_fll_input_range_subtitle_timing")[0],d=b.getElementsByClassName("subtitles_fll_input_text_subtitle_timing")[0],m.oninput=p=>{this.changeSubtitleTiming(p.target.value)},d.onchange=p=>{this.changeSubtitleTiming(p.target.value)},
d.onwheel=p=>{this.changeSubtitleTiming(p.target.value)},m=b.getElementsByClassName("subtitles_fll_input_range_subtitle_pos")[0],d=b.getElementsByClassName("subtitles_fll_input_text_subtitle_pos")[0],m.oninput=p=>{k(p.target.value)},m.onmousedown=p=>{this.overlaySubtitleContainerElem.style.border="solid 2px #999"},m.onmouseup=p=>{this.overlaySubtitleContainerElem.style.border="none"},d.onchange=p=>{k(p.target.value)},d.onwheel=p=>{k(p.target.value)},m=b.getElementsByClassName("subtitles_fll_input_range_playback")[0],
d=b.getElementsByClassName("subtitles_fll_input_text_playback")[0],m.oninput=p=>{this.changePlaybackRate(p.target.value)},d.onchange=p=>{this.changePlaybackRate(p.target.value)},d.onwheel=p=>{this.changePlaybackRate(p.target.value)},m=b.getElementsByClassName("subtitles_fll_input_range_brightness")[0],d=b.getElementsByClassName("subtitles_fll_input_text_brightness")[0],m.oninput=p=>{this.changeBrightness(p.target.value)},d.onchange=p=>{this.changeBrightness(p.target.value)},d.onwheel=p=>{this.changeBrightness(p.target.value)},
m=b.getElementsByClassName("subtitles_fll_input_range_contrast")[0],d=b.getElementsByClassName("subtitles_fll_input_text_contrast")[0],m.oninput=p=>{this.changeContrast(p.target.value)},d.onchange=p=>{this.changeContrast(p.target.value)},d.onwheel=p=>{this.changeContrast(p.target.value)},m=b.getElementsByClassName("subtitles_fll_input_range_saturate")[0],d=b.getElementsByClassName("subtitles_fll_input_text_saturate")[0],m.oninput=p=>{this.changeSaturate(p.target.value)},d.onchange=p=>{this.changeSaturate(p.target.value)},
d.onwheel=p=>{this.changeSaturate(p.target.value)},b.getElementsByClassName("subtitles_fll_reset_button")[0].onclick=p=>{f()})};const f=()=>{this.changeSubtitleTiming(this.defaultTiming);this.changeBrightness(1);this.changeContrast(1);this.changeSaturate(1);this.changePlaybackRate(1);k(0)};this.changeSubtitleTiming=(b,d)=>{if(!isNaN(Number(b))){this.timing=b=Number(b);if(this.adjustmentMenuElem){let g=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_range_subtitle_timing")[0];this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_text_subtitle_timing")[0].value=
b;g.value=b}this.subtitleTimingDifferenceCallback&&!1!==d&&this.subtitleTimingDifferenceCallback(b)}};const k=b=>{if(!isNaN(Number(b))){b=Number(b);if(this.adjustmentMenuElem){let d=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_range_subtitle_pos")[0],g=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_text_subtitle_pos")[0];d.value=b;g.value=b}this.subtitlePosition=b;this.refreshSubtitlePosition();this.refreshAmazonSubtitlePosition()}};this.changePlaybackRate=
b=>{if(!isNaN(Number(b))){b=Number(b);if(this.adjustmentMenuElem){let d=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_range_playback")[0],g=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_text_playback")[0];d.value=b;g.value=b}this.video.playbackRate!=b&&(this.video.playbackRate=b)}};this.changeBrightness=b=>{if(!isNaN(Number(b))){b=Number(b);if(this.adjustmentMenuElem){let d=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_range_brightness")[0],
g=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_text_brightness")[0];d.value=b;g.value=b}this.brightness=b;this.video.style.filter="brightness("+this.brightness+") contrast("+this.contrast+") saturate("+this.saturate+")";this.video.style.filter=h()}};this.changeContrast=b=>{if(!isNaN(Number(b))){b=Number(b);if(this.adjustmentMenuElem){let d=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_range_contrast")[0],g=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_text_contrast")[0];
d.value=b;g.value=b}this.contrast=b;this.video.style.filter=h()}};this.changeSaturate=b=>{if(!isNaN(Number(b))){b=Number(b);if(this.adjustmentMenuElem){let d=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_range_saturate")[0],g=this.adjustmentMenuElem.getElementsByClassName("subtitles_fll_input_text_saturate")[0];d.value=b;g.value=b}this.saturate=b;this.video.style.filter=h()}};const h=()=>{let b="";1!=this.brightness&&(b+="brightness("+this.brightness+")");1!=this.contrast&&(b+=
"contrast("+this.contrast+")");1!=this.saturate&&(b+="saturate("+this.saturate+")");return b.trim()};this.hideAdjustmentMenu=()=>{let b=subtitlesForLL.configs;b.subtitlePosition=this.subtitlePosition;b.playbackRate=this.video.playbackRate;b.brightness=this.brightness;b.contrast=this.contrast;b.saturate=this.saturate;chrome.storage.sync.set(b);this.adjustmentMenuElem&&(this.adjustmentMenuElem.style.display="none")};this.adjustmentMenuIsHide=()=>null==this.adjustmentMenuElem?!0:"none"==this.adjustmentMenuElem.style.display}
;function SubtitlesForLLCommentViewer(){};function SubtitlesForLLCommentWindow(){this.commentWindowCallback=this.commentWindowElem=this.commentViewerElem=this.commentsOverlayElem=this.commentButton=null;this.comments=[];this.init=c=>{this.commentButton=document.createElement("button");this.commentButton.className="subtitles_fll_comment_button";this.commentButton.style.cssText="position:absolute; top:20px; left:20px; width:40px; height:40px; border-radius:20px; background-color:rgba(200,200,200,0.7);";this.commentButton.onclick=a;this.commentViewerElem=
document.createElement("div");this.commentViewerElem.classList.add("subtitles_fll_comment_viewer");this.commentViewerElem.style.cssText="position:absolute; top:100px; left:0px; width:100%; height:50px; overflow-y:scroll; font-size: 16px;";this.commentCellContainer=document.createElement("div");this.commentCellContainer.classList.add("subtitles_fll_comment_cell_container");this.commentCellContainer.style.cssText="position:relative; width:100%; height:100%;";this.commentViewerElem.insertAdjacentElement("beforeend",
this.commentCellContainer)};this.loadComments=c=>{let e="";this.comments.forEach(f=>{e+='<div class="subtitles_fll_comment_cell" style="position:relative; width:200px; height:100%; margin:0px 10px; margin-right:auto; padding:10px; background-color:#aaa; color:#222; border-radius:15px; white-space:nowrap;"><div style="display:inline-block; margin:5px;"><img style="width:20px; height:20px; border-radius:10px; background-color:#aaa;"></div><div style="display:inline-block; vertical-align:top; width:calc(100% - 30px); white-space:initial;"><div style="display:inline-block;">'+
f.comment+'</div><div><div style="display:inline-block;">\u25cb \u2661</div></div></div></div>'});this.commentCellContainer.innerHTML=e};const a=()=>{this.draw()};this.drawCommentWindow=()=>{if(!this.commentWindowElem){this.commentWindowElem=document.createElement("div");this.commentWindowElem.className="subtitles_fll_comment_window";this.commentWindowElem.style.cssText="position:absolute; top:100px; left:20px; margin:20px; font-size:18px; z-index:10000;";this.commentWindowElem.innerHTML='<div style="position:relative; width:400px; margin:0px; background-color:rgba(100,100,100,0.8); border-radius:10px;"><div class="subtitles_fll_comment_window_menu" style="width:100%; height:60px;"><div class="subtitles_fll_comment_window_menu_left" style="display:inline-block; width:50%; line-height:100%; text-align:left;"><img style="display:inline-block; width:40px; height:40px; margin:10px; border-radius:20px; background-color:#aaa; vertical-align:middle;"></div><div class="subtitles_fll_comment_window_menu_right" style="display:inline-block; width:50%; line-height:100%; text-align:right;"><button class="subtiltes_fll_comment_window_close" style="display:inline-block; width:40px; height:40px; margin:10px; padding:10px; vertical-align:middle; border-radius:20px; outline:0;"><svg viewBox="0 0 612 612" xmlns="http://www.w3.org/2000/svg"><g><line stroke="#dddddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_1" y2="561.45315" x2="561.49999" y1="48.45311" x1="51.5" stroke-width="99" fill="none"></line><line stroke="#dddddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_2" y2="562" x2="561" y1="50" x1="50" stroke-width="99" fill="none"></line><line transform="rotate(90 305.5,306.00000000000006) " stroke="#dddddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_4" y2="562" x2="561" y1="50" x1="50" stroke-width="99" fill="none"></line></g></svg></button></div></div><textarea class="subtitles_fll_comment_window_comment_textarea" style="width:100%; min-height:60px; border:none; margin:0px; background-color:#999;" placeholder="\u8cea\u554f\u3057\u3066\u307f\u307e\u3057\u3087\u3046"></textarea><div class="subtitles_fll_comment_window_bottom_menu" style="width:100%;"><div class="subtitles_fll_comment_window_bottom_menu_left" style="display:inline-block; width:50%; line-height:100%; text-align:left;"></div><div class="subtitles_fll_comment_window_bottom_menu_right" style="display:inline-block; width:50%; line-height:100%; text-align:right;"><button class="subtitles_fll_bg_color_blue" style="width:100px; height:30px; font-size:16px; margin:10px; border-radius:15px; text-align:center; font-weight:bold;">\u66f8\u304d\u8fbc\u307f</button></div></div></div>';
this.commentWindowElem.querySelector(".subtiltes_fll_comment_window_close").onclick=()=>{this.commentWindowElem.remove();this.commentWindowElem=null;this.commentWindowCallback&&this.commentWindowCallback("clickedCloseButton")};var c=this.commentWindowElem.querySelector(".subtitles_fll_comment_window_comment_textarea");c.oninput=e=>{c.style.height="auto";c.style.height=c.scrollHeight+"px"};this.commentButton.parentElement.insertAdjacentElement("beforeend",this.commentWindowElem);c.focus();this.commentWindowCallback&&
this.commentWindowCallback("clickedCommentButton")}};this.comments=[]};(()=>{function a(){return location.host.match(/^(?:www\.amazon\..+)/)&&location.pathname.match(/(?:\/gp\/video\/detail|.*\/dp\/.*?)/mi)||"www.primevideo.com"==location.host&&location.pathname.match(/.*\/detail\/.+/mi)}if(a())SubtitlesForLLAmazonPrime();else if(location.host.match(/^(?:www\.amazon\..+)/)&&location.pathname.match(/(?:\/Amazon-Video\/|\/gp\/video)/)){let c=location.href;(new MutationObserver(e=>{c!==location.href&&(a()&&SubtitlesForLLAmazonPrime(),c=location.href)})).observe(document.documentElement,
{subtree:!0,childList:!0})}})();function SubtitlesForLLHelpWindow(){let a=subtitlesForLL.localize.localize;this.draw=()=>{let c=chrome.runtime.getURL("icons/adjust.svg"),e=document.createElement("div");e.className="subtitleViewer_fll_help_window";e.style.cssText="position:fixed; background-color:rgba(0,0,0,0.3); width:100%; height:100%; top:0; left:0; z-index:100000;";e.innerHTML='<div style="position:relative; text-align:center; width:100%; height:100%; color:#333;"><div style="position:absolute; width:400px; height:230px; background-color:#ddd; border-radius:10px; margin:auto; top:0; bottom:0; left:0; right:0;"><div style="margin: 20px;">Subtitle for Learning Language</div><div style="display:flex; font-size:15px; margin:10px 20px; height:calc(100% - 130px);"><div><img src="'+
c+'" style="width:60px;height:100%;"></div><div style="text-align:left;position: relative;width: 100%;margin: 10px;"><div style="position: absolute;margin: auto;top: 0;bottom: 0;height: 60px;">'+a("HELP_MESSAGE_1")+'</div></div></div><div style="position:absolute; width: calc(100% - 20px); margin: 10px; bottom:0px; text-align:center;"><button class="subtitles_fll_help_ok" style="width: 150px;height:30px;outline:none;border: solid 1px #999;border-radius: 15px;margin: 10px;">OK</button><button class="subtitles_fll_help_dontshow" style="width: 150px;height:30px;outline:none;border: solid 1px #999;border-radius: 15px;margin: 10px;">'+
a("Don't show again")+"</button></div></div></div>";e.getElementsByClassName("subtitles_fll_help_ok").item(0).onclick=f=>{e.remove();e=null};e.getElementsByClassName("subtitles_fll_help_dontshow").item(0).onclick=f=>{chrome.storage.sync.set({hideHelpWindow:!0});e.remove();e=null};document.body.insertAdjacentElement("beforeend",e)}};function SubtitlesForLLLocalSubtitle(){const a=subtitlesForLL.localize.localize,c=[".srt",".vtt",".ass",".ssa"],e=["srt","vtt","ssa","ssa"];this.callback=this.dragArea=this.element=null;this.init=()=>{this.element=document.createElement("div");this.element.style.cssText="position:relative; width: calc(100% - 20px); text-align: center; margin: 0px 10px 10px 10px; border-top:1px solid #444;";this.element.innerHTML='<div style="margin:5px 0px;">'+a("If you want to open the subtitle file directly, please open the file from the following.")+
'</div><div class="subtitles_fll_file_drag_area" style="width:100%; border: dotted 2px #999; padding: 10px; border-radius: 20px;"><div>'+a("Drag & Drop Subtitle File Here")+'</div><div style="color:#999;">'+a("Support Files")+' : .srt .vtt .ass .ssa</div><input class="subtitles_fll_file_input" type="file" name="file" accept="'+c.join(",")+'" style="margin-top: 5px; padding:2px 20px; color:#999;"></div>';this.dragArea=this.element.getElementsByClassName("subtitles_fll_file_drag_area").item(0);this.fileInputElem=
this.element.getElementsByClassName("subtitles_fll_file_input").item(0);this.fileInputElem.addEventListener("change",h=>{if(!(null==h.target.files||1>h.target.files.length)){var b=f(h.target.files[0].name);null==b?alert(a("Unsupported file type.")):k(h.target.files[0],b)}});this.dragArea.addEventListener("dragover",h=>{h.stopPropagation();h.preventDefault();this.dragArea.style.background="#888"});this.dragArea.addEventListener("dragleave",h=>{h.stopPropagation();h.preventDefault();this.dragArea.style.background=
null});this.dragArea.addEventListener("drop",h=>{h.stopPropagation();h.preventDefault();this.dragArea.style.background=null;h=h.dataTransfer.files;if(1<h.length)return alert(a("Cannot open multiple files."));let b=f(h[0].name);null==b?alert(a("Unsupported file type.")):k(h[0],b)})};const f=h=>{for(let b=0;b<c.length;b++){let d=h.match(new RegExp(".*\\"+c[b]+"$","im"));if(d&&0<d.length)return e[b]}return null},k=(h,b)=>{let d=new FileReader;d.onload=()=>{this.callback&&this.callback(null,{filePath:h.name,
fileType:b,text:d.result})};d.onerror=()=>{this.callback&&this.callback("\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002",{filePath:h.name,fileType:b})};d.readAsText(h)}};function SubtitlesForLLLocalize(a){const c={userRank:{"super admin":{ja:"\u7ba1\u7406\u4eba"},Administrator:{ja:"\u7ba1\u7406\u6a29\u9650\u6240\u6709"},administrator:{ja:"\u7ba1\u7406\u6a29\u9650\u6240\u6709"},"Subtitle Translator":{ja:"\u7ffb\u8a33\u8005"},translator:{ja:"\u7ffb\u8a33\u8005"},"Sub Translator":{ja:"\u526f\u7ffb\u8a33\u8005"},subtranslator:{ja:"\u526f\u7ffb\u8a33\u8005"},moderator:{ja:"\u76e3\u8996\u8005"},anonymous:{ja:"\u533f\u540d"},"Application Developers":{ja:"\u30a2\u30d7\u30ea\u958b\u767a\u8005"},
"app developer":{ja:"\u30a2\u30d7\u30ea\u958b\u767a\u8005"},"Trusted member":{ja:"\u4fe1\u983c\u3067\u304d\u308b\u30e6\u30fc\u30b6\u30fc"},trusted:{ja:"\u4fe1\u983c\u3067\u304d\u308b\u30e6\u30fc\u30b6\u30fc"},"Platinum Member":{ja:"\u516c\u958b\u65701001\u4ee5\u4e0a",default:"Uploads 1001-"},"platinum member":{ja:"\u516c\u958b\u65701001\u4ee5\u4e0a",default:"Uploads 1001-"},"Gold member":{ja:"\u516c\u958b\u6570101\u301c1000",default:"Uploads 101-1000"},"gold member":{ja:"\u516c\u958b\u6570101\u301c1000",
default:"Uploads 101-1000"},"Silver Member":{ja:"\u516c\u958b\u657051\u301c100",default:"Uploads 51-100"},"silver ember":{ja:"\u516c\u958b\u657051\u301c100",default:"Uploads 51-100"},"Bronze Member":{ja:"\u516c\u958b\u65701\u301c50",default:"Uploads 1-50"},"bronze member":{ja:"\u516c\u958b\u65701\u301c50",default:"Uploads 1-50"},"Admin Warning":{ja:"\u8981\u6ce8\u610f"},warning:{ja:"\u8981\u6ce8\u610f"},"Read Only Member":{ja:"ROM"}},Search:{ja:"\u691c\u7d22"},Season:{ja:"\u30b7\u30fc\u30ba\u30f3"},
Episode:{ja:"\u30a8\u30d4\u30bd\u30fc\u30c9"},Year:{ja:"\u5e74"},Score:{ja:"\u30b9\u30b3\u30a2"},Download:{ja:"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"},Language:{ja:"\u8a00\u8a9e"},File:{ja:"\u30d5\u30a1\u30a4\u30eb"},"If you want to open the subtitle file directly, please open the file from the following.":{ja:"\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u958b\u304f\u5834\u5408\u306f\u3001\u4e0b\u8a18\u304b\u3089\u958b\u3044\u3066\u304f\u3060\u3055\u3044\u3002"},"Drag & Drop Subtitle File Here":{ja:"\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u3092\u30c9\u30e9\u30c3\u30b0&\u30c9\u30ed\u30c3\u30d7\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},
"Support Files":{ja:"\u5bfe\u5fdc\u30d5\u30a1\u30a4\u30eb"},"Unsupported file type.":{ja:"\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u7a2e\u985e\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002"},"Cannot open multiple files.":{ja:"\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002"},Subtitle:{ja:"\u5b57\u5e55"},"Subtitle search":{ja:"\u5b57\u5e55\u691c\u7d22"},Settings:{ja:"\u8a2d\u5b9a"},Words:{ja:"\u30ef\u30fc\u30c9"},"Please enter the ENGLISH TITLE on Search Tab and search.":{ja:"\u691c\u7d22\u30bf\u30d6\u3067\u82f1\u984c\u3092\u5165\u529b\u3057\u3001\u5b57\u5e55\u3092\u691c\u7d22\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},
Encoding:{ja:"\u6587\u5b57\u30a8\u30f3\u30b3\u30fc\u30c9"},"Tokenizing...":{ja:"\u5b57\u5e55\u306e\u89e3\u6790\u4e2d..."},USER_WORDS_DESCRIPTION:{ja:"\u767b\u9332\u3057\u305f\u5358\u8a9e\u306e\u8868\u793a\u8272\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002(\u30c6\u30b9\u30c8\u6a5f\u80fd)",default:"You can change the display color of the registered words. (Test feature)"},Word:{ja:"\u30ef\u30fc\u30c9"},Color:{ja:"\u8272"},Regex:{ja:"\u6b63\u898f\u8868\u73fe"},Add:{ja:"\u8ffd\u52a0"},
"Waiting for PlaybackResource to be received...":{ja:"\u30d3\u30c7\u30aa\u60c5\u5831\u3092\u53d7\u4fe1\u3059\u308b\u306e\u3092\u5f85\u3063\u3066\u3044\u307e\u3059..."},"initializing...":{ja:"\u521d\u671f\u5316\u4e2d..."},"Waiting for video to load start...":{ja:"\u52d5\u753b\u306e\u30ed\u30fc\u30c9\u304c\u958b\u59cb\u3055\u308c\u308b\u306e\u3092\u5f85\u3063\u3066\u3044\u307e\u3059\u3002"},"Waiting for video to be loaded...":{ja:"\u52d5\u753b\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u306e\u3092\u5f85\u3063\u3066\u3044\u307e\u3059..."},
"Getting video information...":{ja:"\u52d5\u753b\u60c5\u5831\u3092\u53d6\u5f97\u4e2d\u3067\u3059..."},"The download of subtitles has reached the limit imposed by OpenSubtitles.com's API.":{ja:"\u5b57\u5e55\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304cOpenSubtitles.com\u306eAPI\u5236\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002"},OPENSUBTITLES_LOGIN_WINDOW_NOTE:{ja:'API\u306e\u4ed5\u69d8\u5909\u66f4\u306b\u3088\u308a1\u65e5\u306b5\u56de\u3092\u8d85\u3048\u3066\u5b57\u5e55\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u884c\u3046\u5834\u5408\u3001<a href="https://www.opensubtitles.com/users/sign_up" target="_blank" rel="noopener" style="font-weight:bold;">OpenSubtitles.com</a>\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3057\u305f\u3002',
default:'Due to API specification changes, if you download subtitles more than 5 times a day, you will now need an <a href="https://www.opensubtitles.com/users/sign_up" target="_blank" rel="noopener" style="font-weight:bold;">OpenSubtitles.com</a> account.'},SAVE_PASSWORD_MESSAGE:{ja:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4fdd\u5b58\u3059\u308b(\u5b89\u5168\u4e0a\u306e\u7406\u7531\u306b\u3088\u308a\u3001\u7d76\u5bfe\u306b\u4ed6\u306e\u30b5\u30a4\u30c8\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4fdd\u5b58\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044)",
default:"Save password (For security reasons, never save a password that you use on other sites.)"},Login:{ja:"\u30ed\u30b0\u30a4\u30f3"},"Please enter your OpenSubtitles.com Username and Password.":{ja:"OpenSubtitles.com\u306e\u30e6\u30fc\u30b6\u30fcID\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},"Loggging in to OpenSubtitles.com...":{ja:"OpenSubtitles.com\u306b\u30ed\u30b0\u30a4\u30f3\u4e2d\u3067\u3059"},"The time until the limit is reset":{ja:"\u5236\u9650\u304c\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u307e\u3067"},
"Please enter a title":{ja:"\u82f1\u8a9e\u306e\u539f\u984c\u3067\u691c\u7d22\u3057\u3066\u304f\u3060\u3055\u3044",default:"Enter keywords(English)"},"No results found.":{ja:"\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002"},"No results found for ":{ja:"\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u691c\u7d22\u30ef\u30fc\u30c9 : "},"Results for ":{ja:"\u691c\u7d22 : "},"Other users are watching with such subtitles":{ja:"\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u306f\u3053\u3093\u306a\u5b57\u5e55\u3068\u4e00\u7dd2\u306b\u898b\u3066\u3044\u307e\u3059\u3002"},
"Searching for subtitles...":{ja:"\u5b57\u5e55\u3092\u691c\u7d22\u4e2d\u3067\u3059..."},"OpenSubtitles.org returned an error.":{ja:"OpenSubtitles.org\u3067\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u307e\u3057\u305f\u3002"},ERROR:{ja:"\u30a8\u30e9\u30fc"},"Downloading...":{ja:"\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d\u3067\u3059..."},"Search other subtitles of same movie":{ja:"\u3053\u306e\u4f5c\u54c1\u306e\u3001\u4ed6\u306e\u5b57\u5e55\u3092\u691c\u7d22"},AUTO_IMDB_SEARCH_MSG_1:{ja:"",
default:"Searching for "},AUTO_IMDB_SEARCH_MSG_2:{ja:"<br>\u306e\u5b57\u5e55\u3092\u81ea\u52d5\u691c\u7d22\u4e2d\u3067\u3059...",default:""},USER_COUNT_PREFIX:{ja:"",default:""},USER_COUNT_SUFFIX:{ja:"\u4eba\u306e\u30e6\u30fc\u30b6\u30fc\u304c\u3053\u306e\u5b57\u5e55\u3067\u5b66\u7fd2\u3057\u307e\u3057\u305f\u3002",default:" Users leaned with this subtitle."},"Google Translate":{ja:"Google\u7ffb\u8a33"},SETTINGS_MESSAGE:{ja:"\u8a2d\u5b9a\u3092\u53cd\u6620\u3059\u308b\u306b\u306f\u3001\u753b\u9762\u4e0b\u90e8\u306e\u300c\u4fdd\u5b58\u30dc\u30bf\u30f3\u300d\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044",
default:'Press the "Save" button at the bottom of the screen to reflect the settings.'},"If the value exceeds the range adjustable with the slider, please adjust using the numerical input box.":{ja:"\u30b9\u30e9\u30a4\u30c0\u30fc\u3067\u8abf\u6574\u51fa\u6765\u308b\u7bc4\u56f2\u3092\u8d85\u3048\u308b\u5834\u5408\u306f\u3001\u6570\u5024\u30dc\u30c3\u30af\u30b9\u3067\u8abf\u6574\u3057\u3066\u304f\u3060\u3055\u3044"},"Subtitle timing":{ja:"\u5b57\u5e55\u8868\u793a\u30bf\u30a4\u30df\u30f3\u30b0\u8abf\u6574"},
"Playback rate":{ja:"\u518d\u751f\u901f\u5ea6(\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc\uff1aS,F or &lt;,&gt;)",default:"Playback rate(Key S,F or &lt;,&gt;)"},"Video brightness":{ja:"\u30d3\u30c7\u30aa\u660e\u308b\u3055"},"Video contrast":{ja:"\u30d3\u30c7\u30aa\u30b3\u30f3\u30c8\u30e9\u30b9\u30c8"},"Video saturate":{ja:"\u30d3\u30c7\u30aa\u5f69\u5ea6"},"Subtitle position":{ja:"\u5b57\u5e55\u8868\u793a\u4f4d\u7f6e"},"Your Amazon":{ja:"\u5229\u7528\u3059\u308bAmazon"},"Native language":{ja:"\u3042\u306a\u305f\u306e\u8a00\u8a9e"},
"Learning language":{ja:"\u5b66\u7fd2\u3059\u308b\u8a00\u8a9e"},"Subtitle font-size (Window ratio)":{ja:"\u5b57\u5e55\u30d5\u30a9\u30f3\u30c8\u30b5\u30a4\u30ba(\u30a6\u30a3\u30f3\u30c9\u30a6\u6bd4\u7387)"},"Subtitles view font-size (px)":{ja:"\u5b57\u5e55\u4e00\u89a7\u30d5\u30a9\u30f3\u30c8\u30b5\u30a4\u30ba(px)"},"Dictionary font-size (px)":{ja:"\u8f9e\u66f8\u30d5\u30a9\u30f3\u30c8\u30b5\u30a4\u30ba(px)"},"Dictionary Popup background-alpha":{ja:"\u8f9e\u66f8\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u80cc\u666f\u900f\u660e\u5ea6"},
"User dictionary link settings":{ja:"\u30e6\u30fc\u30b6\u30fc\u8f9e\u66f8\u30ea\u30f3\u30af\u8a2d\u5b9a"},"Subtitle files cache":{ja:"\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u30ad\u30e3\u30c3\u30b7\u30e5"},ALLOW_TRANSMISSION_MESSAGE:{ja:"\u533f\u540d\u3067\u52d5\u753b\u3001\u5b57\u5e55\u306e\u60c5\u5831\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\u3059\u308b\u4e8b\u3092\u8a31\u53ef\u3059\u308b"},ALLOW_TRANSMISSION_WARNING:{ja:"\u7121\u52b9\u306b\u3059\u308b\u3068\u81ea\u52d5\u3067\u306e\u5b57\u5e55\u691c\u7d22\u3001\u5b57\u5e55\u306e\u81ea\u52d5\u30bf\u30a4\u30df\u30f3\u30b0\u8abf\u6574\u304c\u7121\u52b9\u306b\u306a\u308a\u307e\u3059"},
"Enable automatic subtitle display timing adjustment.(some videos)":{ja:"\u81ea\u52d5\u5b57\u5e55\u8868\u793a\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3059\u308b(\u4e00\u90e8\u306e\u4f5c\u54c1)"},"Quick back sec (Shortcut key = R)":{ja:"\u30af\u30a4\u30c3\u30af\u30d0\u30c3\u30af\u79d2\u6570(R\u30ad\u30fc)"},Delete:{ja:"\u524a\u9664"},Save:{ja:"\u4fdd\u5b58"},"Shortcut keys":{ja:"\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc"},"Playback rate UP : F or &gt;":{ja:"\u518d\u751f\u901f\u5ea6\u30a2\u30c3\u30d7 : F or &gt"},
"Playback rate DOWN : S or &lt;":{ja:"\u518d\u751f\u901f\u5ea6\u30c0\u30a6\u30f3 : S or &lt"},"Seek to prev subtitle position : E":{ja:"\u524d\u306e\u5b57\u5e55\u306e\u518d\u751f\u4f4d\u7f6e\u306b\u30b7\u30fc\u30af : E",default:"Seek to prev subtitle : E"},"Seek to next subtitle position : D":{ja:"\u6b21\u306e\u5b57\u5e55\u306e\u518d\u751f\u4f4d\u7f6e\u306b\u30b7\u30fc\u30af : D",default:"Seek to next subtitle : D"},"Quick back : R":{ja:"\u30af\u30a4\u30c3\u30af\u30d0\u30c3\u30af : R"},"Playback or Pause : Space":{ja:"\u518d\u751f or \u4e00\u6642\u505c\u6b62 : \u30b9\u30da\u30fc\u30b9\u30ad\u30fc"},
"You can not select the same language.":{ja:"\u300c\u3042\u306a\u305f\u306e\u8a00\u8a9e\u300d\u3068\u300c\u5b66\u7fd2\u3059\u308b\u8a00\u8a9e\u300d\u3067\u540c\u3058\u8a00\u8a9e\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002"},"Connection error":{ja:"\u63a5\u7d9a\u30a8\u30e9\u30fc"},noun:{ja:"\u540d\u8a5e"},verb:{ja:"\u52d5\u8a5e"},adjective:{ja:"\u5f62\u5bb9\u8a5e"},adverb:{ja:"\u526f\u8a5e"},conjunction:{ja:"\u63a5\u7d9a\u8a5e"},preposition:{ja:"\u524d\u7f6e\u8a5e"},
pronoun:{ja:"\u4ee3\u540d\u8a5e"},particle:{ja:"\u52a9\u8a5e"},interjection:{ja:"\u9593\u6295\u8a5e"},article:{ja:"\u51a0\u8a5e"},"auxiliary verb":{ja:"\u52a9\u52d5\u8a5e"},Synonyms:{ja:"\u540c\u7fa9\u8a9e",th:"\u0e04\u0e33\u0e1e\u0e49\u0e2d\u0e07\u0e04\u0e27\u0e32\u0e21\u0e2b\u0e21\u0e32\u0e22"},Classifiers:{ja:"\u5206\u985e\u5b50",th:"\u0e08\u0e31\u0e14\u0e01\u0e25\u0e38\u0e48\u0e21"},Antonyms:{ja:"\u5bfe\u7fa9\u8a9e",th:"\u0e04\u0e33\u0e15\u0e23\u0e07\u0e02\u0e49\u0e32\u0e21"},Example:{ja:"\u4f8b",
th:"\u0e15\u0e31\u0e27\u0e2d\u0e22\u0e48\u0e32\u0e07"},Definitions:{ja:"\u5b9a\u7fa9",th:"\u0e04\u0e33\u0e08\u0e33\u0e01\u0e31\u0e14\u0e04\u0e27\u0e32\u0e21"},"Now Loading...":{ja:"\u8aad\u8fbc\u4e2d\u3067\u3059..."},"No results":{ja:"\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f"},"Don't show again":{ja:"\u6b21\u56de\u304b\u3089\u306f\u8868\u793a\u3057\u306a\u3044"},HELP_MESSAGE_1:{ja:"\u5b57\u5e55\u8868\u793a\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3001\u8868\u793a\u4f4d\u7f6e\u306e\u8abf\u6574\u306f\u753b\u9762\u4e0b\u90e8\u306e\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002",
default:"To adjust the timing and position of the subtitles, click the icons at the bottom of the screen."},"Could not download subtitles.":{ja:"\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u307e\u305b\u3093\u3067\u3057\u305f\u3002"},ERROR_503:{ja:"\u300chttps://www.opensubtitles.org/\u300d\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u73fe\u5728\u5229\u7528\u3067\u304d\u306a\u3044\u72b6\u614b\u3067\u3059\u3002\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u304a\u3044\u3066\u304b\u3089\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002(503)",
default:"The https://www.opensubtitles.org/ server is currently unavailable. Please wait for a while before trying.(503)"}};this.localize=function(e,f){if(a&&f&&c[f]&&c[f][e]){if(null!=c[f][e][a.nativeLanguage])return c[f][e][a.nativeLanguage];if(null!=c[f][e]["default"])return c[f][e]["default"]}else if(a&&c[e]){if(null!=c[e][a.nativeLanguage])return c[e][a.nativeLanguage];if(null!=c[e]["default"])return c[e]["default"]}return e}};function OpenSubtitlesComAPI(){this.API_KEY="64N8HsdaSEY92p2jO3ua8nnmXiG4Xj4K";this.LOCAL_PASS=")7Z#~c#)+A9KpX+u9./xqHexhC$%-MPE";this.settings={headers:{"Api-Key":this.API_KEY,"X-User-Agent":"SubtitlesForLearningLanguage v1.7"}};this.reloginTimer=this.lastLoginAt=this.token=this.password=this.userName=null;this.hasLoadedSettings=this.loginInProgress=!1;this.waitForLogin=()=>new Promise((a,c)=>{0==this.loginInProgress?a():this._waitForLoginToFinish(a)});this._waitForLoginToFinish=a=>{this.loginInProgress?
setTimeout(()=>{this._waitForLoginToFinish(a)},100):a()};this.loadSettings=()=>new Promise((a,c)=>{chrome.storage.sync.get("openSubtitlesAccount",e=>{if(e&&e.openSubtitlesAccount&&0<e.openSubtitlesAccount.length&&(e=JSON.parse(subtitlesForLL.decodeFromBase64Url(e.openSubtitlesAccount)))&&e.iv&&e.salt&&e.encryptedData){this._decrypt(e,this.LOCAL_PASS).then(f=>{f&&f.userName&&f.password&&(this.userName=f.userName,this.password=f.password,this.hasLoadedSettings=!0);a(f)}).catch(f=>{console.error(f);
c(f)});return}a(null)})});this.hasAccount=()=>this.userName&&this.password?!0:!1;this.login=()=>{this.loginInProgress=!0;return(new Promise((a,c)=>{this.userName&&this.password?this.loginWithIdAndPassword(this.userName,this.password,!1).then(e=>{a(e)}).catch(e=>{c(e);console.error(e)}):a(null)})).catch(a=>{console.error(a)}).finally(()=>{this.loginInProgress=!1})};this.loginWithIdAndPassword=(a,c,e)=>{if(null==a||null==c)throw"OpenSubtitlesComAPI.loginWithIdAndPassword()\u306e\u5f15\u6570userName or password\u304cnull\u3067\u3059\u3002";
this.loginInProgress=!0;let f=this._getApiUrl("login"),k=this._getHeaders();k["Content-Type"]="application/json";let h={username:a,password:c};return new Promise((b,d)=>{fetch(f,{method:"POST",mode:"cors",headers:k,body:JSON.stringify(h)}).then(g=>g.json()).then(g=>{g&&200==g.status?g.token&&0<g.token.length&&(this.userName=a,this.password=c,this.token=g.token,this.lastLoginAt=new Date,this.reloginTimer&&clearTimeout(this.reloginTimer),this.reloginTimer=setTimeout(()=>{this.loginWithIdAndPassword(this.userName,
this.password,!1).catch(m=>{console.error(m)})},828E5),1==e||null==e?this._saveSettings({userName:a,password:c}).then(()=>{b(g)}):b(g)):b(g)}).finally(()=>{this.loginInProgress=!1})})};this._saveSettings=a=>this._encrypt(JSON.stringify(a),this.LOCAL_PASS).then(c=>new Promise((e,f)=>{f=subtitlesForLL.encodeToBase64Url(JSON.stringify(c));chrome.storage.sync.set({openSubtitlesAccount:f},()=>{e()})}));this.subtitles=a=>{let c=this._getApiUrl("subtitles");a=subtitlesForLL.getQueryParamsString(a).toLowerCase();
0<a.length&&(c+="?"+a);let e=null;a=this._getHeaders();a["Content-Type"]="application/json";return fetch(c,{method:"GET",mode:"cors",headers:a}).then(f=>{e=f.status;return f.json()}).then(f=>{if(200!=e)throw'ERROR: Failed to fetch "/subtitles" from OpenSubtitles.com. ERROR_CODE:'+e;return new Promise((k,h)=>{k({data:f,statusCode:e})})})};this.download=a=>{let c,e,f,k=this._getHeaders();k["Content-Type"]="application/json";return new Promise((h,b)=>{fetch(this._getApiUrl("download"),{method:"POST",
mode:"cors",headers:k,body:JSON.stringify(a)}).then(d=>{e=d.status;return d.json()}).then(d=>{c=d;if(null!=d.remaining&&0>=d.remaining&&null==d.link)h({data:c,statusCodeOfApi:e});else if(null==d||null==d.link)b(Error("\u6307\u5b9a\u3055\u308c\u305f\u5b57\u5e55\u306e\u30d5\u30a1\u30a4\u30eb\u306eURL\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002StatusCode:"+e));else{var g=this._getHeaders();delete g.Authorization;delete g["Api-Key"];return fetch(d.link,{method:"GET",mode:"cors",headers:g}).then(m=>
{f=m.status;return m.text()}).then(m=>{null==m?b(Error("\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u304c\u5185\u5bb9\u304c\u60f3\u5b9a\u5916\u3067\u3059\u3002StatusCode:"+f)):h({data:c,text:m,statusCodeOfApi:e,statusCodeOfDownloadingFile:f})}).catch(m=>{b(Error("\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002StatusCode:"+f))})}}).catch(d=>{b(Error("OpenSubtitles.com\u304b\u3089\u5b57\u5e55URL\u3092\u53d6\u5f97\u51fa\u6765\u307e\u305b\u3093\u3067\u3057\u305f\u3002"))})})};
this._fetch=(a,c,e)=>{c=this._getApiUrl(c);let f=this._getHeaders(),k={method:a,mode:"cors",headers:f};"GET"==a?(a=subtitlesForLL.getQueryParamsString(e).toLowerCase(),0<a.length&&(c+="?"+a)):"POST"==a&&(f["Content-Type"]="application/json",k.body=JSON.stringify(e));return fetch(c,k).then(h=>h.json())};this._getHeaders=()=>{let a=JSON.parse(JSON.stringify(this.settings.headers));this.token&&(a.Authorization="Bearer "+this.token);return a};this._getApiUrl=a=>"https://api.opensubtitles.com/api/v1/"+
a;this.showLoginWindow=()=>{null==document.body.querySelector("#subtitles_fll_os_login_window_container")&&document.body.insertAdjacentHTML("beforeend",'\n\t\t\t\t<div id="subtitles_fll_os_login_window_container">\n\t\t\t\t\t<div id="subtitles_fll_os_login_window">\n\t\t\t\t\t\t<form>\n\t\t\t\t\t\t\tOpenSubtitles User-ID:<input type="text" class="os_id">\n\t\t\t\t\t\t\tOpenSubtitles Password:<input type="text" class="os_pass">\n\t\t\t\t\t\t\t<button>Login</button>\n\t\t\t\t\t\t\t<button>Close</button>\n\t\t\t\t\t\t</form>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t')};
this._encrypt=(a,c)=>{c=(new TextEncoder).encode(c);const e=window.crypto.getRandomValues(new Uint8Array(16)),f=window.crypto.getRandomValues(new Uint8Array(12));return window.crypto.subtle.importKey("raw",c,"PBKDF2",!1,["deriveKey"]).then(k=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:2E3,hash:"SHA-256"},k,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])).then(k=>window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},k,(new TextEncoder).encode(a))).then(k=>new Promise((h,b)=>
{h({iv:this._encodeToBase64FromUint8Array(f),salt:this._encodeToBase64FromUint8Array(e),encryptedData:this._encodeToBase64FromUint8Array(k)})}))};this._decrypt=({iv:a,salt:c,encryptedData:e},f)=>{f=(new TextEncoder).encode(f);const k=this._decodeFromBase64ToUint8Array(c),h=this._decodeFromBase64ToUint8Array(a),b=this._decodeFromBase64ToUint8Array(e);return window.crypto.subtle.importKey("raw",f,"PBKDF2",!1,["deriveKey"]).then(d=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:k,iterations:2E3,
hash:"SHA-256"},d,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])).then(d=>window.crypto.subtle.decrypt({name:"AES-GCM",iv:h},d,b)).then(d=>new Promise((g,m)=>{g(JSON.parse((new TextDecoder).decode(d)))}))};this._encodeToBase64FromUint8Array=a=>{null==a.buffer&&(a=new Uint8Array(a));let c="";const e=a.byteLength;for(let f=0;f<e;f++)c+=String.fromCharCode(a[f]);return btoa(c)};this._decodeFromBase64ToUint8Array=a=>new Uint8Array(Array.prototype.map.call(atob(a),c=>c.charCodeAt()))};function SubtitlesForLLSettingsView(){function a(k,h){k='<select name="'+k+'" style="display:inline-block; width:100%; height:35px; border-radius:20px; padding:0px 10px; font-size:14px; border:none; outline:none;">';let b=Object.keys(subtitlesForLL.languageCode.codes);for(let d=0;d<b.length;d++)k=h==b[d]?k+('<option value="'+b[d]+'" selected="selected">'+subtitlesForLL.languageCode.codes[b[d]].enName+" ("+subtitlesForLL.languageCode.codes[b[d]].nativeName+")</option>"):k+('<option value="'+b[d]+'">'+
subtitlesForLL.languageCode.codes[b[d]].enName+" ("+subtitlesForLL.languageCode.codes[b[d]].nativeName+")</option>");return k+"</select>"}function c(k){let h='<select name="amazonHostname" style="display:inline-block; width:100%; height:35px; border-radius:20px; padding:0px 10px; font-size:14px; border:none; outline:none;">';subtitlesForLL.amazon.hostnames.forEach((b,d)=>{h=k==b.hostname?h+('<option value="'+b.hostname+'" selected="selected">'+b.country+" - "+b.hostname+(b.hostname!=b.primeHostname?
" ("+b.primeHostname+")":"")+"</option>"):h+('<option value="'+b.hostname+'">'+b.country+" - "+b.hostname+(b.hostname!=b.primeHostname?" ("+b.primeHostname+")":"")+"</option>")});return h+="</select>"}let e=subtitlesForLL.localize.localize;this.element=null;this.init=()=>{this.element=document.createElement("div");this.element.className="subtitles_fll_settngs_view";this.element.style.cssText="color:#ddd; font-size:14px; overflow-y:scroll; height:calc(100% - 40px);";var k=chrome.runtime.getURL("/license.html");
k='<div style="padding: 20px; border-bottom: 1px solid #999;">'+e("SETTINGS_MESSAGE")+'</div><div style=""><div class="amazon_hostname_selector" style="display:flex; height:100%; align-items:center; margin: 20px;"><div style="width:40%;">'+e("Your Amazon")+'</div><div style="width:60%;">'+c(subtitlesForLL.configs.amazonRegion)+'</div></div></div><div style=""><div class="native_language_selector" style="display:flex; height:100%; align-items:center; margin: 20px;"><div style="width:40%;">'+e("Native language")+
'</div><div style="width:60%;">'+a("nativeLanguage",subtitlesForLL.configs.nativeLanguage)+'</div></div><div class="learning_language_selector" style="display:flex; height:100%; align-items:center; margin: 20px;"><div style="width:40%;">'+e("Learning language")+'</div><div style="width:60%;">'+a("learningLanguage",subtitlesForLL.configs.learningLanguage)+'</div></div></div><div class="subtitles_fll_configs_subtitle_size" style="margin:20px; display:flex; align-items:center;">'+e("Subtitle font-size (Window ratio)")+
'<div style="margin-right:0px; margin-left:auto;"><input type="number" value="'+subtitlesForLL.configs.subtitleFontSizeVW+'" min="1.5" max="5.0" step="0.1" style="width:60px; height:35px; border-radius:20px; text-align:right; padding:0px 10px; border:none; outline:none;"></div></div><div class="subtitles_fll_configs_subtitles_view_size" style="margin:20px; display:flex; align-items:center;">'+e("Subtitles view font-size (px)")+'<div style="margin-right:0px; margin-left:auto;"><input type="number" value="'+
subtitlesForLL.configs.subtitleScrollViewFontSize+'" min="5" style="width:60px; height:35px; border-radius:20px; text-align:right; padding:0px 10px; border:none; outline:none;"></div></div><div class="subtitles_fll_configs_dict_size" style="margin:20px; display:flex; align-items:center;">'+e("Dictionary font-size (px)")+'<div style="margin-right:0px; margin-left:auto;"><input type="number" value="'+subtitlesForLL.configs.dictionaryFontSize+'" min="5" style="width:60px; height:35px; border-radius:20px; text-align:right; padding:0px 10px; border:none; outline:none;"></div></div><div class="subtitles_fll_configs_dict_bg_alpha" style="margin:20px; display:flex; align-items:center;">'+
e("Dictionary Popup background-alpha")+'<div style="margin-right:0px; margin-left:auto;"><input type="number" value="'+subtitlesForLL.configs.dictionaryBackgroundAlpha+'" min="0.1" max="1" step="0.1" style="width:60px; height:35px; border-radius:20px; text-align:right; padding:0px 10px; border:none; outline:none;"></div></div><div class="subtitles_fll_user_dict" style="margin:20px; white-space:nowrap;"><div>'+e("User dictionary link settings")+'</div><div style="margin-left:auto; margin-right:0px;" class="subtitles_fll_dictionary_container"></div></div><div class="subtitles_fll_quick_back" style="margin:20px; display:flex; align-items:center;">'+
e("Quick back sec (Shortcut key = R)")+'<div style="margin-right:0px; margin-left:auto;"><input type="number" value="'+subtitlesForLL.configs.quickBackSec+'" min="1" max="10" step="0.1" style="width:60px; height:35px; border-radius:20px; text-align:right; padding:0px 10px; border:none; outline:none;"></div></div><div style="margin:20px; display:flex; align-items:center;">'+e("Subtitle files cache")+'<div style="margin-right:0px; margin-left:auto;"><button class="subtitles_fll_configs_delete_button subtitles_fll_bg_color_red" style="width:80px; height:35px; text-align:center; border-radius:20px;"">'+
e("Delete")+'</button></div></div><div style="text-align:center; margin:20px;"><button class="subtitles_fll_configs_save_button" style="width:150px; height:35px; text-align:center; border-radius:20px;">'+e("Save")+'</button></div><div style="margin:20px;"><div>'+e("Shortcut keys")+'</div><div style="text-align:right; direction:ltr;">'+e("Playback rate UP : F or &gt;")+'</div><div style="text-align:right; direction:ltr;">'+e("Playback rate DOWN : S or &lt;")+'</div><div style="text-align:right; direction:ltr;">'+
e("Seek to prev subtitle position : E")+'</div><div style="text-align:right; direction:ltr;">'+e("Seek to next subtitle position : D")+'</div><div style="text-align:right; direction:ltr;">'+e("Quick back : R")+'</div><div style="text-align:right; direction:ltr;">'+e("Playback or Pause : Space")+'</div></div><div><div style="text-align:center; margin-bottom:20px;"><a href="'+k+'" target="_blank" rel=\u201dnoopener\u201d>License</a></div></div>';this.element.innerHTML=k;if("rtl"==window.getComputedStyle(subtitlesForLL.webPlayerElement).direction){k=
this.element.getElementsByTagName("div");for(let d=0;d<k.length;d++){let g=k[d];"0px"==g.style.marginRight&&"auto"==g.style.marginLeft&&(g.style.marginRight="auto",g.style.marginLeft="0px")}}f(subtitlesForLL.configs.learningLanguage,subtitlesForLL.configs.nativeLanguage);let h=this.element.getElementsByClassName("native_language_selector").item(0).getElementsByTagName("select").item(0),b=this.element.getElementsByClassName("learning_language_selector").item(0).getElementsByTagName("select").item(0);
h.onchange=d=>{f(b.value,h.value)};b.onchange=d=>{f(b.value,h.value)};this.element.getElementsByClassName("subtitles_fll_configs_delete_button")[0].onclick=d=>{subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let g=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});g.onMessage.addListener(m=>{g.disconnect();g=null});g.postMessage({type:"removeAllFiles"});alert("\u524a\u9664\u3057\u307e\u3057\u305f\u3002")})};this.element.getElementsByClassName("subtitles_fll_configs_save_button")[0].onclick=
d=>{d={};var g=this.element.getElementsByClassName("amazon_hostname_selector")[0].getElementsByTagName("select")[0];d.amazonRegion=g.value;g=this.element.getElementsByClassName("native_language_selector")[0].getElementsByTagName("select")[0];d.nativeLanguage=g.value;g=this.element.getElementsByClassName("learning_language_selector")[0].getElementsByTagName("select")[0];d.learningLanguage=g.value;if(d.nativeLanguage==d.learningLanguage)alert(e("You can not select the same language."));else if(g=this.element.getElementsByClassName("subtitles_fll_configs_subtitle_size")[0].getElementsByTagName("input")[0],
d.subtitleFontSizeVW=Number(g.value),g=this.element.getElementsByClassName("subtitles_fll_configs_subtitles_view_size")[0].getElementsByTagName("input")[0],5>Number(g.value))alert("\u30d5\u30a9\u30f3\u30c8\u30b5\u30a4\u30ba\u304c\u5c0f\u3055\u3059\u304e\u307e\u3059\u3002");else if(d.subtitleScrollViewFontSize=Number(g.value),g=this.element.getElementsByClassName("subtitles_fll_configs_dict_size")[0].getElementsByTagName("input")[0],5>Number(g.value))alert("\u30d5\u30a9\u30f3\u30c8\u30b5\u30a4\u30ba\u304c\u5c0f\u3055\u3059\u304e\u307e\u3059\u3002");
else{d.dictionaryFontSize=Number(g.value);g=this.element.querySelector(".subtitles_fll_configs_dict_bg_alpha input");d.dictionaryBackgroundAlpha=Number(g.value);g=this.element.querySelector(".subtitles_fll_quick_back input");d.quickBackSec=Number(g.value);this.element.getElementsByClassName("subtitles_fll_user_dic_textarea").item(0);var m=this.element.getElementsByClassName("subtitles_fll_user_dic_cell");g=[];for(var p=0;p<m.length;p++){var B=m[p],y=B.getElementsByClassName("subtitles_fll_user_dic_name").item(0);
B=B.getElementsByClassName("subtitles_fll_user_dic_url").item(0);0==y.value.length&&0==B.value.length||g.push({name:subtitlesForLL.common.escapeHTML(0>=y.value.length?" ":y.value),url:encodeURI(B.value)})}m=null==subtitlesForLL.configs.userDictionaryRules||null==subtitlesForLL.configs.userDictionaryRules[d.learningLanguage]||null==subtitlesForLL.configs.userDictionaryRules[d.learningLanguage][d.nativeLanguage]?subtitlesForLL.common.getDefaultDictionaryRules(d.learningLanguage,d.nativeLanguage):subtitlesForLL.configs.userDictionaryRules[d.learningLanguage][d.nativeLanguage];
p=!1;if(g.length==m.length)for(y=0;y<g.length;y++){if(g[y].name!=m[y].name||g[y].url!=m[y].url){p=!0;break}}else p=!0;p&&(null==d.userDictionaryRules&&(d.userDictionaryRules={}),null==d.userDictionaryRules[d.learningLanguage]&&(d.userDictionaryRules[d.learningLanguage]={}),d.userDictionaryRules[d.learningLanguage][d.nativeLanguage]=g);g=subtitlesForLL.configs.nativeLanguage;m=subtitlesForLL.configs.learningLanguage;chrome.storage.sync.set(d);subtitlesForLL.configs=Object.assign(subtitlesForLL.configs,
d);if(g!=d.nativeLanguage||m!=d.learningLanguage)subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let t=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});t.onMessage.addListener(()=>{t.disconnect();t=null});t.postMessage({type:"setupDictionary"});location.reload()});else{document.getElementsByClassName("subtitles_fll_overlay_subtitle_container")[0].style.fontSize=d.subtitleFontSizeVW+"vw";if(g=document.getElementsByClassName("subtitles_fll_subtitles_container").item(0))g.style.fontSize=
d.subtitleScrollViewFontSize+"px";f(d.learningLanguage,d.nativeLanguage);alert("\u4fdd\u5b58\u3057\u307e\u3057\u305f\u3002")}}}};this.close=()=>{this.element.remove();this.element=this.element.innerHTML=null};const f=(k,h)=>{let b=this.element.getElementsByClassName("subtitles_fll_dictionary_container").item(0);b.style.cssText="font-size:13px;";let d="";k=subtitlesForLL.configs.userDictionaryRules&&subtitlesForLL.configs.userDictionaryRules[k]&&subtitlesForLL.configs.userDictionaryRules[k][h]?subtitlesForLL.configs.userDictionaryRules[k][h]:
subtitlesForLL.common.getDefaultDictionaryRules(k,h);for(h=0;h<k.length+1;h++){let g;g=h<k.length?k[h]:{name:"",url:""};d+='<div class="subtitles_fll_user_dic_cell" style="display:flex; margin:10px 0px 10px 10px;"><div style="width:110px;">Name<input type="text" class="subtitles_fll_user_dic_name" value="'+g.name+'" name="name" style="width:60px; height:30px; margin:0px 5px; padding:0px 5px; border-radius:15px; border:none;"></div><div style="width:calc(100% - 100px); text-align:right;">URL<input type="text" class="subtitles_fll_user_dic_url" value="'+
g.url+'" name="url" style="width:200px; height:30px; margin:0px 0px 0px 5px; padding:0px 5px; border-radius:15px; border:none;"></div></div>'}b.innerHTML=d}};function SubtitlesForLLContentsView(){const a=subtitlesForLL.localize.localize;this.subtitles=this.originalSubtitleType=this.originalSubtitleStr=this.amazonUIChanger=this.videoElem=this.currentCatalogId=this.subtitleSettings=this.subtitleCallback=this.clickSeekButtonCallback=this.mouseUpCallback=this.clickCallback=this.mouseLeaveCallback=this.mouseEnterCallback=null;this.currentSubtitleIndex=-1;this.activeSubtitleElems=[];this.overlaySubtitleElem=this.readPositionSubtitleElem=null;this.element=document.createElement("div");
this.element.id="subtitles_fll_contents_view";this.element.style.cssText="background-color:#222; border-left: solid 1px #444444; width:400px; min-width:400px; max-width:400px; height:100%; z-index:10000; position:absolute; top:0px; right:0px; pointer-events:auto;";this.wordSeparater=this.usageSubtitleInfo=this.subtitlesContainer=this.encodingMenuElem=this.subtitlesTabMsgContainer=this.loadingElem=null;let c,e=null,f=0;this.changeVideoElem=n=>{this.videoElem=n};this.init=n=>{this.videoElem=n;subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)&&
(this.element.style.right=null,this.element.style.left="0px");n='<div class="subtitles_fll_menus" style="display:flex; background-color:#222222; font-size:14px; color:#ffffff; width:100%; height:40px; margin:0px;"><div class="subtitles_fll_menu_button" style="background-color:#000000; border-right:solid 1px #444444; padding:0px 10px 0px 10px; width:80px; height:100%; margin:0px; text-align:center; display:flex; align-items:center; justify-content:center; cursor:pointer;">'+a("Subtitle")+'</div><div class="subtitles_fll_menu_button" style="background-color:#000000; border-right:solid 1px #444444; padding:0px 10px 0px 10px; width:80px; height:100%; margin:0px; text-align:center; display:flex; align-items:center; justify-content:center; cursor:pointer;">'+
a("Search")+'</div><div class="subtitles_fll_menu_button" style="background-color:#000000; border-right:solid 1px #444444; padding:0px 10px 0px 10px; width:80px; height:100%; margin:0px; text-align:center; display:flex; align-items:center; justify-content:center; cursor:pointer;">'+a("Settings")+'</div><div class="subtitles_fll_menu_button" style="background-color:#000000; border-right:solid 1px #444444; padding:0px 10px 0px 10px; width:80px; height:100%; margin:0px; text-align:center; display:flex; align-items:center; justify-content:center; cursor:pointer;">'+
a("Words")+"</div></div>";this.element.innerHTML=n;n=this.element.getElementsByClassName("subtitles_fll_menu_button");for(let v=0;v<n.length;v++)n[v].onclick=y;this.subtitleSelector=new SubtitlesForLLSubtitleSelector;this.subtitleSelector.init();this.subtitleSelector.showLoadingView(a("initializing..."));this.subtitleSelector.downloadedSubtitleFileCallback=g;this.element.appendChild(this.subtitleSelector.element);this.subtitleView=document.createElement("div");this.subtitleView.classList.add("subtitles_fll_subtitles_tab");
this.subtitleView.classList.add("subtitles_fll_scroll_bar");this.subtitleView.style.cssText="position:relative; background-color:#000000; color:#dddddd; width:100%; height:calc(100% - 40px); overflow-y:scroll;";this.element.appendChild(this.subtitleView);this.subtitlesTabMsgContainer=document.createElement("div");this.subtitlesTabMsgContainer.className="subtitles_fll_subtitles_tab_msg_container";this.subtitlesTabMsgContainer.style.cssText="height: 100%; width: 100%; position: absolute; top: 0; left: 0; pointer-events: none;";
this.subtitlesTabMsgContainer.innerHTML='<div style="height: 100px;position: absolute;margin: auto;top: 0;left: 0;bottom: 0;right: 0;font-size: 16px;padding: 20px;">'+a("Please enter the ENGLISH TITLE on Search Tab and search.")+"</div>";this.subtitleView.insertAdjacentElement("beforeend",this.subtitlesTabMsgContainer);this.encodingMenuElem=document.createElement("div");this.encodingMenuElem.style.cssText="width:100%; text-align:right; margin:5px 0px; background-color:#222;";let l='<div class="dicpop_container" style="display:inline-block; text-align:center;"><a href="https://apps.apple.com/app/id1602968053" target="_blank" rel=\u201dnoopener\u201d style="line-height:40px;">YouTube Version (iOS) : <img class="app_store" src="'+
chrome.runtime.getURL("/icons/appstore.svg")+'"></a></div><select class="subtitles_fll_text_encoding_select" style="margin:10px 10px 10px 5px; width:130px; height:26px; border-radius:13px; padding:0px 10px"><option value="default" disabled selected>'+a("Encoding")+"</option>";subtitlesForLL.languageCode.encodingTypes(subtitlesForLL.configs.learningLanguage).forEach((v,C)=>{l+='<option value="'+v+'">'+v+"</option>"});l+="</select>";this.encodingMenuElem.innerHTML=l;let q=this.encodingMenuElem.getElementsByClassName("subtitles_fll_text_encoding_select").item(0);
q.onchange=v=>{"default"!=q.value&&b(q.value)};this.subtitleView.appendChild(this.encodingMenuElem);this.subtitlesContainer=document.createElement("div");this.subtitlesContainer.className="subtitles_fll_subtitles_container";this.subtitlesContainer.style.cssText="width:100%; height:100%; font-size:"+(subtitlesForLL.configs.subtitleScrollViewFontSize||0)+"px;";subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)?(this.subtitlesContainer.style.direction="rtl",this.subtitlesContainer.style.textAlign=
"right"):(this.subtitlesContainer.style.direction="ltr",this.subtitlesContainer.style.textAlign="left");this.subtitleView.appendChild(this.subtitlesContainer);this.subtitlesContainer.addEventListener("mouseup",v=>{this.mouseUpCallback&&this.mouseUpCallback(v)});this.selectMenu(1);window.addEventListener("beforeunload",v=>{this.stopCountSubtitleUsageTime();this.saveUsageSubtitleInfoFile();this.sendUsageSubtitleInfo()});this.showLoadingView("Waiting for video to load start...")};const k=()=>{var n=
subtitlesForLL;let l=null,q=null,v=null,C;if(n.currentContentId){n=subtitlesForLL.getMovieData(n.currentContentId);q=n.seasonNumber;v=n.episodeNumber;C=n.episodeYear||n.movieYear;let E=location.hostname,r=document.getElementsByTagName("html"),D=!1;r&&r.lang&&0<r.lang.length&&null!=r.lang.match(/^en(?:-.+)?$/m)&&(D=!0);("www.primevideo.com"==E&&D||"www.amazon.com"==E&&D||"www.amazon.co.uk"==E)&&n&&null!=n.rootTitle&&(l=n.rootTitle)}this.subtitleSelector.setSeasonAndEpisode(l,q,v,C)};this.videoLoadStart=
n=>{this.closeSubtitles();this.subtitleSelector.initAllView();this.subtitleSelector.showLoadingView(a("Waiting for video to be loaded..."));this.showLoadingView(a("Waiting for video to be loaded..."))};this.videoLoadedData=()=>{k();null==subtitlesForLL.currentCatalogId?(this.showLoadingView(a("Waiting for PlaybackResource to be received...")),setTimeout(()=>{this.videoLoadedData()},500)):(this.currentCatalogId=subtitlesForLL.currentCatalogId,this.hideLoadingView(),this.subtitleSelector.showSearchInterface(),
this.amazonUIChanger&&(this.amazonUIChanger.defaultTiming=0,this.amazonUIChanger.changeSubtitleTiming(0,!1),this.amazonUIChanger.changeBrightness(this.amazonUIChanger.brightness),this.amazonUIChanger.changeContrast(this.amazonUIChanger.contrast),this.amazonUIChanger.changeSaturate(this.amazonUIChanger.saturate)),m(this.currentCatalogId,n=>{n&&null!=n.text?(this.readUsageSubtitleInfoFile(this.currentCatalogId,l=>{if(null==l||0>=Object.keys(l).length)l=d(this.currentCatalogId);this.usageSubtitleInfo=
l;l.recommend&&null!=l.recommend.timing&&!1!==subtitlesForLL.configs.enableAutoSubtitleTimingAdjustment&&(this.amazonUIChanger.defaultTiming=Number(l.recommend.timing));null!=l.timing?this.amazonUIChanger.changeSubtitleTiming(l.timing):l.recommend&&null!=l.recommend.timing&&!1!==subtitlesForLL.configs.enableAutoSubtitleTimingAdjustment&&this.amazonUIChanger.changeSubtitleTiming(l.recommend.timing);0==this.videoElem.paused&&this.startCountSubtitleUsageTime()}),this.originalSubtitleStr=n.text,this.originalSubtitleType=
n.type,p(n.text,n.type),this.encodingMenuElem.style.display="block"):(this.encodingMenuElem.style.display="none",h(l=>{l&&(this.usageSubtitleInfo=d(this.currentCatalogId))}))}))};const h=n=>{let l=subtitlesForLL;if(l.playbackResources&&l.currentContentId&&l.playbackResources[l.currentContentId]&&l.playbackResources[l.currentContentId].subtitleUrls){let q=subtitlesForLL.languageCode.toAmazonLangCode(l.configs.learningLanguage,l.playbackResources[l.currentContentId].subtitleUrls);if(null==q){n(!1);
return}B(l.playbackResources[l.currentContentId].subtitleUrls,q,null,v=>{n&&n(v)})}n(!1)};this.startCountSubtitleUsageTime=()=>{this.usageSubtitleInfo&&(null!=c&&console.warn("subtitleBeginTime\u304cnull\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002(\u60f3\u5b9a\u5916)"),c=Math.floor((new Date).getTime()/1E3))};this.stopCountSubtitleUsageTime=()=>{null!=c&&this.usageSubtitleInfo&&(this.usageSubtitleInfo.usageTime+=Math.floor((new Date).getTime()/1E3)-c,this.usageSubtitleInfo.usageRate=0==this.usageSubtitleInfo.usageTime?
0:this.usageSubtitleInfo.usageTime/this.usageSubtitleInfo.videoDuration*100,c=null)};const b=n=>{let l=(new TextEncoder).encode(this.originalSubtitleStr);n=(new TextDecoder(n)).decode(l);p(n,this.originalSubtitleType)},d=n=>{let l={};l.userIdentifier=subtitlesForLL.configs.userIdentifier;l.catalogId=n;l.usageTime=0;l.usageRate=0;l.videoDuration=this.videoElem.duration-this.adDuration;l.timing=0;return l},g=(n,l,q,v)=>{if(null!=q&&0<q.length){this.usageSubtitleInfo&&(this.saveUsageSubtitleInfoFile(),
this.sendUsageSubtitleInfo());this.removeSubtitleSettingFile();this.amazonUIChanger&&(this.amazonUIChanger.defaultTiming=0,this.amazonUIChanger.changeSubtitleTiming(0,!1));let C="srt";"localSubtitle"==v?C=l.SubFormat||l.subFormat:l&&(l.SubFormat&&0<l.SubFormat.length||l.subFormat&&0<l.subFormat.length)&&(C=l.SubFormat||l.subFormat);this._saveSubtitleFile(q,C);this.originalSubtitleStr=q;this.originalSubtitleType=C;p(q,C);this.encodingMenuElem.style.display="block";this.usageSubtitleInfo=d(n);"search"==
v?this.usageSubtitleInfo.openSubtitlesOrg=l:"recommend"==v&&(this.usageSubtitleInfo.recommend=l,null!=l.timing&&!1!==subtitlesForLL.configs.enableAutoSubtitleTimingAdjustment&&(this.amazonUIChanger.defaultTiming=Number(l.timing),this.amazonUIChanger.changeSubtitleTiming(Number(l.timing))));0==this.videoElem.paused&&this.startCountSubtitleUsageTime();this.saveUsageSubtitleInfoFile()}else this.encodingMenuElem.style.display="none"};this._saveSubtitleFile=(n,l)=>{if(n&&0<n.length)if(l=!l||"ssa"!=l.toLowerCase()&&
"ass"!=l.toLowerCase()?"srt":"ass",l=subtitlesForLL.getSubtitleFileNameWithCatalogId(this.currentCatalogId,l),null==l)console.warn("\u5b57\u5e55\u306e\u4fdd\u5b58\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u751f\u6210\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002");else{var q="/"+l;subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let v=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});v.onMessage.addListener(C=>
{v.disconnect();v=null});v.postMessage({type:"saveFile",filePath:q,text:n})})}};this.readUsageSubtitleInfoFile=(n,l)=>{let q="/"+subtitlesForLL.getSubtitleFileNameWithCatalogId(n)+".json";subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let v=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});v.onMessage.addListener(C=>{v.disconnect();v=null;null==C?l({}):(C="string"===typeof C.text?JSON.parse(C.text):C.text,l&&l(C))});v.postMessage({type:"readFile",filePath:q})})};
this.saveUsageSubtitleInfoFile=()=>{if(!(null==this.usageSubtitleInfo||0>=Object.keys(this.usageSubtitleInfo).length)){this.stopCountSubtitleUsageTime();var n="/"+subtitlesForLL.getSubtitleFileNameWithCatalogId(this.currentCatalogId)+".json";subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let l=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});l.onMessage.addListener(()=>{l.disconnect();l=null});l.postMessage({type:"saveFile",filePath:n,text:JSON.stringify(this.usageSubtitleInfo)})})}};
this.removeSubtitleSettingFile=()=>{let n="/"+subtitlesForLL.getSubtitleFileNameWithCatalogId(this.currentCatalogId)+".json";subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let l=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});l.onMessage.addListener(()=>{l.disconnect();l=null});l.postMessage({type:"removeFile",filePath:n})})};this.sendUsageSubtitleInfo=()=>{null==this.usageSubtitleInfo||0>=Object.keys(this.usageSubtitleInfo).length||0==this.usageSubtitleInfo.usageTime||
(this.stopCountSubtitleUsageTime(),this.usageSubtitleInfo=null)};const m=(n,l)=>{n=subtitlesForLL.getSubtitleFileNameWithCatalogId(n);if(null==n)l(null);else{var q="/"+n;subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let v=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});v.onMessage.addListener(C=>{v.disconnect();v=null;null==C?l&&l(null):l&&l(C)});v.postMessage({type:"readSubtitleFile",filePath:q})})}};this.loadSubtitleArray=n=>{t(n)};const p=(n,l)=>{let q=
new SubtitlesForLLSubtitleFile,v;"srt"==l.toLowerCase()||"vtt"==l.toLowerCase()?v=q.parseSubtitles(n):"ssa"==l.toLowerCase()?v=q.parseSubtitlesOfSsa(n):console.warn("loadSubtitlesString() - \u5bfe\u5fdc\u5916\u306etype\u306e\u5b57\u5e55\u3067\u3059\u3002type == "+l);t(v)},B=(n,l,q,v)=>{(new SubtitlesForLLSubtitleFile).loadAmazonSubtitleUrls(n,l,q,(C,E)=>{C?v&&v(!1):E?(this.loadSubtitleArray(E),v&&v(!0)):v&&v(!1)},q)};this.closeSubtitles=()=>{this.subtitles=null;this.currentSubtitleIndex=-1;this.activeSubtitleElems=
[];this.readPositionSubtitleElem=null;e&&(e.disconnect(),e=null);f=0;this.subtitlesTabMsgContainer.style.display="block";this.subtitlesContainer.innerHTML="";this.overlaySubtitleElem.innerHTML="";this.subtitleView.scroll(0,0);this.selectMenu(1)};const y=n=>{let l=this.element.getElementsByClassName("subtitles_fll_menu_button");for(let q=0;q<l.length;q++)l[q]==n.target&&this.selectMenu(q)};this.selectMenu=n=>{let l=this.element.getElementsByClassName("subtitles_fll_menu_button");for(let q=0;q<l.length;q++)q==
n?(l[q].style.backgroundColor="rgb(34, 34, 34)",l[q].style.color=null):(l[q].style.backgroundColor="#000",l[q].style.color="#999");this.settingsView&&(this.settingsView.close(),this.settingsView=null);this.userWordsView&&(this.userWordsView.close(),this.userWordsView=null);0==n?(this.subtitleView.style.display="block",this.subtitleSelector.element.style.display="none"):1==n?(this.subtitleView.style.display="none",this.subtitleSelector.element.style.display="block"):2==n?(this.subtitleView.style.display=
"none",this.settingsView=new SubtitlesForLLSettingsView,this.settingsView.init(),this.element.appendChild(this.settingsView.element),this.subtitleSelector.element.style.display="none"):3==n&&(this.subtitleView.style.display="none",this.subtitleSelector.element.style.display="none",this.userWordsView=new SubtitlesForLLUserWordsView,this.userWordsView.init(),this.element.appendChild(this.userWordsView.element),this.userWordsView.callback=()=>{this.recreateSubtitleCells()})};this.recolorSubtitleCells=
(n,l)=>{null!=l.regex&&null!=l.color&&subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{f=0;this.subtitles.forEach((q,v)=>{null!=q.text.match(new RegExp(l.regex,"i"))&&(q=this.subtitlesContainer.childNodes[v],null!=q&&(q=q.querySelector(".subtitles_fll_cell_subtitle_container"),u(this.subtitles,v,q)))})})};this.recolorSubtitleAllCells=()=>{subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{f=0;this.subtitles.forEach((n,l)=>{let q=subtitlesForLL.userWords.keys();for(;userWordKey=q.next().value;){var v=
subtitlesForLL.userWords.get(userWordKey);if(null!=n.text.match(new RegExp(v.regex,"i"))){v=this.subtitlesContainer.childNodes[l];if(null==v)break;v=v.querySelector(".subtitles_fll_cell_subtitle_container");u(this.subtitles,l,v)}}})})};this.recreateSubtitleCells=()=>{subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{f=0;this.subtitles.forEach((n,l)=>{n=this.subtitlesContainer.childNodes[l].querySelector(".subtitles_fll_cell_subtitle_container");u(this.subtitles,l,n)})})};const t=n=>{this.closeSubtitles();
this.subtitlesTabMsgContainer.style.display="none";this.selectMenu(0);null==this.loadingElem&&(this.loadingElem=document.createElement("div"),this.loadingElem.className="subtitles_fll_loading_container",this.loadingElem.style.cssText="position:fixed; width:"+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px; height:calc(100% - 40px); top:40px; right:0; background-color:rgba(0,0,0,0.5);",1==subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLang)&&(this.loadingElem.style.left="0",this.loadingElem.style.right=
"auto"),this.loadingElem.innerHTML='<div style="position:absolute; width:100%; height:80px; top:0; left:0; right:0; bottom:0; margin:auto;"><div style="text-align:center;">'+a("Tokenizing...")+'</div><?xml version="1.0" encoding="utf-8"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin:auto; background:none; display:block; shape-rendering:auto;" width="80px" height="80px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="#dddddd" stroke-width="7" r="32" stroke-dasharray="150.79644737231007 52.26548245743669"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></svg></div>',
this.subtitleView.insertAdjacentElement("beforeend",this.loadingElem));subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{this.subtitles=n;let l=subtitlesForLL.languageCode.toDeepLCode(subtitlesForLL.configs.nativeLanguage)&&subtitlesForLL.languageCode.toDeepLCode(subtitlesForLL.configs.learningLanguage);for(let E=0;E<this.subtitles.length;E++){let r=document.createElement("div");r.className="subtitles_fll_cell";r.dataset.index=E;var q=document.createElement("div");q.className="subtitles_fll_cell_seek";
var v=chrome.runtime.getURL("icons/play_button64.png");q.innerHTML='<img src="'+v+'" alt="">';q.onclick=G=>{if(this.clickSeekButtonCallback)for(let H=0;H<this.subtitlesContainer.childNodes.length;H++)if(this.subtitlesContainer.childNodes[H]==r){this.clickSeekButtonCallback(G,this.subtitles[H]);break}};r.insertAdjacentElement("beforeend",q);let D=u(this.subtitles,E);D.dataset.index=E;r.insertAdjacentElement("beforeend",D);q=document.createElement("div");q.className="subtitles_fll_cell_google_translate";
q.title=a("Google Translate");v=chrome.runtime.getURL("icons/google_translate60.png");var C=document.createElement("img");C.src=v;C.setAttribute("alt","");q.appendChild(C);r.insertAdjacentElement("beforeend",q);q.addEventListener("mouseenter",G=>{if(this.mouseEnterCallback)return this.mouseEnterCallback("googleDict",G,{index:E,subtitleContainerElem:D})},!1);q.addEventListener("mouseleave",G=>{if(this.mouseLeaveCallback)return this.mouseLeaveCallback("googleDict",G,{index:E,subtitleContainerElem:D})},
!1);q.addEventListener("click",G=>{if(this.clickCallback)return this.clickCallback("googleDict",G,{index:E,subtitleContainerElem:D})},!1);l&&(q=document.createElement("div"),q.className="subtitles_fll_cell_deepl_translate",v=chrome.runtime.getURL("icons/deepl.svg"),C=document.createElement("img"),C.src=v,C.setAttribute("alt",""),q.onclick=F,q.appendChild(C),r.insertAdjacentElement("beforeend",q));this.subtitlesContainer.insertAdjacentElement("beforeend",r)}})},x=()=>{this.loadingElem?(this.loadingElem.remove(),
this.loadingElem=null):console.warn("finishedAllTokenizeCallback() - loadingElem\u304cnull\u3067\u3059\u3002");null!=e&&(e.disconnect(),e=null)},z=subtitlesForLL.USER_WORD_COLORS,u=(n,l,q)=>{if(null==q){q=document.createElement("div");q.className="subtitles_fll_cell_subtitle_container";var v=subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage);"rtl"==subtitlesForLL.direction!=v&&(q.style.cssText="direction:"+(v?"rtl;":"ltr;"))}n=n[l].text;v=subtitlesForLL.userWords;let C=
v.keys();for(;userWordKey=C.next().value;){let E=v.get(userWordKey),r=E.regex;null!=r&&(n=n.replace(new RegExp(r,"ig"),'<font color="'+z[E.color]+'">$1</font>'))}null==e&&(e=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"}));e.onMessage.addListener(w);e.postMessage({type:"tokenize",index:l,word:n,from:subtitlesForLL.configs.learningLanguage,to:subtitlesForLL.configs.nativeLanguage});return q},w=n=>{f++;let l=n.words;n=this.subtitlesContainer.children[n.index].querySelector(".subtitles_fll_cell_subtitle_container");
let q="",v=0;if(null!=l)for(let C=0;C<l.length;C++)null!=l[C].word?(q+='<span data-index="'+v+'">'+l[C].word+"</span>",v+=l[C].word.length):null!=l[C].separate?(q+=l[C].separate,v+=l[C].separate.length):null!=l[C].tag&&(q+=l[C].tag);n.innerHTML=q;A(n);f>=this.subtitles.length&&x&&x()},A=n=>{if(0==SubtitlesForLLWordPopupWindow.isMouseEnterPopupNotSupportLanguage(subtitlesForLL.configs.learningLanguage)&&(n=n.getElementsByTagName("span")))for(let l=0;l<n.length;l++)n[l].addEventListener("mouseenter",
q=>{q.target.style.backgroundColor="#448";if(this.mouseEnterCallback)return this.mouseEnterCallback("word",q)},!1),n[l].addEventListener("mouseleave",q=>{q.target.style.backgroundColor=null;if(this.mouseLeaveCallback)return this.mouseLeaveCallback("word",q)},!1),n[l].addEventListener("click",q=>{if(this.clickCallback)return this.clickCallback("word",q)},!1)},F=n=>{var l=n.target.parentElement.getElementsByClassName("subtitles_fll_cell_subtitle_container");if(null==l||0>=l.length)console.warn("clickedGoogleTranslate() - \u5b57\u5e55\u304c\u5165\u3063\u3066\u3044\u308b.subtitles_fll_cell_subtitle_container\u3092\u53d6\u5f97\u51fa\u6765\u307e\u305b\u3093\u3067\u3057\u305f\u3002(\u60f3\u5b9a\u5916)");
else{l=encodeURIComponent(l[0].innerText.replace(/\n/g," "));if("subtitles_fll_cell_google_translate"==n.target.className){var q=subtitlesForLL.languageCode.toGoogleLangCode(subtitlesForLL.configs.nativeLanguage)||"auto";let v=subtitlesForLL.languageCode.toGoogleLangCode(subtitlesForLL.configs.learningLanguage)||"auto";l="https://translate.google.com/?hl="+q+"&sl="+v+"&tl="+q+"&text="+l+"&op=translate";q="GoogleTranslate"}else if("subtitles_fll_cell_deepl_translate"==n.target.className)q=subtitlesForLL.languageCode.toDeepLCode(subtitlesForLL.configs.nativeLanguage)||
"auto",l="https://www.deepl.com/translator#"+(subtitlesForLL.languageCode.toDeepLCode(subtitlesForLL.configs.learningLanguage)||"auto")+"/"+q+"/"+l,q="DeepL";else{console.error("clickedTranslate() - \u30bf\u30fc\u30b2\u30c3\u30c8\u306e\u89aa\u30af\u30e9\u30b9\u304c\u60f3\u5b9a\u5916\u3067\u3059");return}window.open(l,q,"noopener,top="+(n.screenY-217.5)+",left="+(window.screenX+window.outerWidth)+",width=760,height=435")}};this.scrollToSec=n=>{this.currentSubtitleIndex=-1;this.syncSubtitle(n)};this.syncSubtitle=
n=>{if(!(null==this.subtitles||0>=this.subtitles.length||0>=this.subtitlesContainer.childNodes.length)){for(var l=0;l<this.activeSubtitleElems.length;l++){var q=this.subtitles[this.activeSubtitleElems[l].dataset.index];if(q.startTime>n||q.endTime<=n){q=this.subtitles.indexOf(q);this.subtitlesContainer.childNodes[q].style.backgroundColor="#222";this.activeSubtitleElems.splice(l,1);l--;for(var v=0;v<this.overlaySubtitleElem.childNodes.length;v++)if(this.overlaySubtitleElem.childNodes[v].dataset.index==
q){this.overlaySubtitleElem.childNodes[v].remove();break}}}for(l=this.currentSubtitleIndex+1;l<this.subtitles.length;l++)if(q=this.subtitles[l],v=this.subtitlesContainer.childNodes[l],q.startTime<=n){if(this.currentSubtitleIndex=l,q.endTime>n&&!(0<=this.activeSubtitleElems.indexOf(v))&&(this.activeSubtitleElems.push(v),v.style.backgroundColor="#666",q=v.querySelector(".subtitles_fll_cell_subtitle_container").cloneNode(!0)))A(q),q.className="subtitles_fll_overlay_subtitle_cell_container",q.dataset.index=
l,this.overlaySubtitleElem.appendChild(q)}else break;n=null!=this.currentSubtitleIndex?this.currentSubtitleIndex+1:0;var C;n<this.subtitlesContainer.childNodes.length&&(C=this.subtitlesContainer.childNodes[n]);C!=this.readPositionSubtitleElem&&null!=this.readPositionSubtitleElem&&0>this.activeSubtitleElems.indexOf(this.readPositionSubtitleElem)&&(this.readPositionSubtitleElem.style.backgroundColor="#222");0>=this.activeSubtitleElems.length&&null!=C&&(C.style.backgroundColor="#444");this.readPositionSubtitleElem=
C;0<=this.currentSubtitleIndex&&this.currentSubtitleIndex<this.subtitles.length&&(C=this.subtitlesContainer.childNodes[this.currentSubtitleIndex].getBoundingClientRect(),(C.bottom>this.subtitlesContainer.clientHeight||0>C.top)&&this.subtitlesContainer.childNodes[0<this.currentSubtitleIndex?this.currentSubtitleIndex-1:0].scrollIntoView(!0))}};this.showLoadingView=n=>{let l=this.element.getElementsByClassName("subtitles_fll_search_loading_view");null==l||0>=l.length?this.element.insertAdjacentHTML("beforeend",
'<div class="subtitles_fll_search_loading_view" style="position:absolute; height:100%; z-index:1; top:0; left:0; right:0; bottom:0; margin:0px; background-color:rgba(0,0,0,0.8);"><div style="height:100px;margin:auto 0px;position: absolute;top: 0;bottom: 0;left: 0;right: 0;"><div class="subtitles_fll_loading_text" style="color:#ddd; text-align:center; font-size:16px; margin:20px auto;">'+n+'</div><div><?xml version="1.0" encoding="utf-8"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin:auto; background:none; display:block; shape-rendering:auto;" width="80px" height="80px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="#dddddd" stroke-width="7" r="32" stroke-dasharray="150.79644737231007 52.26548245743669"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></svg></div></div></div>'):
(l[0].getElementsByClassName("subtitles_fll_loading_text")[0].innerHTML=n,l[0].style.display="block")};this.hideLoadingView=()=>{let n=this.element.getElementsByClassName("subtitles_fll_search_loading_view");n&&1<=n.length&&(n[0].style.display="none")}};function SubtitlesForLLSubtitleFile(){this.loadAmazonSubtitleUrls=(a,c,e,f)=>{let k;if(e){for(let b=0;b<a.length;b++)if(a[b].languageCode&&a[b].displayName.toLowerCase()==e.toLowerCase()){k=a[b].url;c=a[b].languageCode;break}null==k&&console.error(`${e}\u306e\u5b57\u5e55\u304cAmazon\u516c\u5f0f\u5b57\u5e55\u306b\u3042\u308a\u307e\u305b\u3093\u3002`)}else for(e=0;e<a.length;e++)if(a[e].languageCode&&a[e].languageCode.toLowerCase()==c.toLowerCase()){k=a[e].url;break}if(null==k)f("NOT_FOUND_IN_AMAZON",
null);else{var h=new XMLHttpRequest;h.open("GET",k,!0);h.onloadend=b=>{if(200==h.status){a:{var d=h.responseText;b=c;try{var g=(new DOMParser).parseFromString(d,"text/xml")}catch(m){console.error("parseAmazonStyle() - Amazon\u306e\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u306eDOMParser\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");console.error(m);b=null;break a}g=g.querySelectorAll("body p");d="";for(let m=0;m<g.length;m++){let p=g[m].innerHTML.trim();""!=p&&(0==b.indexOf("ar")&&(p=p.replace(/^(?!\u202B|\u200F)/gm,
"\u202b")),p=p.replace(/<br [^>]*>/g,"\n"),d+=m+"\n",d+=g[m].getAttribute("begin").replace(".",",")+" --\x3e "+g[m].getAttribute("end").replace(".",",")+"\n",d+=p+"\n\n")}b=d}b=this.parseSubtitles(b);f&&f(null,b)}else f&&f("ERROR:"+h.status,null)};h.send()}};this.parseSubtitles=a=>{a=a.replace(/\r\n|\r/g,"\n");a=a.replace(/^NOTE(?:\n\n|[ \n][\s\S]*?(?:\n\n|z))/gm,"\n");a=a.split("\n\n");let c=[];for(let e=0;e<a.length;e++){let f=a[e].match(/(?:([0-9]*):)?([0-9]{1,2}):([0-9]{1,2})(?:.([0-9]+))?(?: ?--\x3e ?)(?:([0-9]*):)?([0-9]{1,2}):([0-9]{1,2})(?:.([0-9]+))?[^\n]*\n([^$]*)/);
null!=f&&c.push({startTime:3600*Number(f[1]||0)+60*Number(f[2]||0)+Number(f[3]||0)+Number("0."+(f[4]||0)),endTime:3600*Number(f[5]||0)+60*Number(f[6]||0)+Number(f[7]||0)+Number("0."+(f[8]||0)),text:f[9]})}c.sort((e,f)=>e.startTime<f.startTime?-1:e.startTime>f.startTime?1:0);return c};this.parseSubtitlesOfSsa=a=>{a=a.replace(/\r\n|\r/g,"\n");let c=[];var e=a.match(/(?:\n|A)\[Events\]\n([\s\S]*)/);if(null==e||0>=e.length)return c;a=e[1];e=a.match(/^Format:[ ]*(.*)$/m);if(null==e||2>e.length)return c;
let f,k,h;e=e[1].split(/,[ ]*/g);h=e.indexOf("Text");0>h&&(h=e.length);f=e.indexOf("Start");k=e.indexOf("End");if(0>f||0>k)return c;e="^Dialogue:[ ]*";for(let d=0;d<h;d++)e+="([^,\\n]*),";e+="(.*)";a=a.split("\n");if(null==a||0>=a.length)return c;let b=new RegExp(e,"m");a.forEach(d=>{var g=d.match(b);if(!(null==g||g.length<=h+1)){var m=g[k+1];d=g[h+1];null==d||0>=d.length||(g=g[f+1].match(/(?:([0-9]*):)?([0-9]{1,2}):([0-9]{1,2})(?:.([0-9]+))?/),m=m.match(/(?:([0-9]*):)?([0-9]{1,2}):([0-9]{1,2})(?:.([0-9]+))?/),
d=d.replace(/\{.*?\}/g,"").replace(/\\n/gi," "),c.push({startTime:3600*Number(g[1]||0)+60*Number(g[2]||0)+Number(g[3]||0)+Number("0."+(g[4]||0)),endTime:3600*Number(m[1]||0)+60*Number(m[2]||0)+Number(m[3]||0)+Number("0."+(m[4]||0)),text:d}))}});c.sort((d,g)=>d.startTime<g.startTime?-1:d.startTime>g.startTime?1:0);return c}};function SubtitlesForLLPlayerController(){this.amazonUIChanger=null;this.isClosed=!0;this.isReceivedNewCatalogId=this.isLoadedData=!1;let a=null,c=null,e=null,f=null,k=null,h=this.videoElem=null,b=0;this.closeCallback=null;this.init=(t,x,z,u)=>{function w(){return setTimeout(()=>{C=null;A.classList.remove("subtitles_fll_show_animation");A.classList.add("subtitles_fll_hide_animation")},1500)}this.isClosed=!1;e=t;this.videoElem=z;h=u;f=x;this.amazonUIChanger=new SubtitlesForLLAmazonUIChanger(this.videoElem);
this.amazonUIChanger.clickedButtonCallback=r=>{"play"==r?this.play():"pause"==r?this.pause():"fastSeekForward"==r?this.seekToSec(this.videoElem.currentTime+10):"fastSeekBack"==r&&this.seekToSec(this.videoElem.currentTime-10)};this.amazonUIChanger.change();this.amazonUIChanger.subtitleTimingDifferenceCallback=y;k=this.amazonUIChanger.subtitlesMainContainer;(x.getElementsByClassName("atvwebplayersdk-playerclose-button").item(0)||x.getElementsByClassName("closeButtonWrapper").item(0)).onclick=d;a=new SubtitlesForLLContentsView;
a.amazonUIChanger=this.amazonUIChanger;a.init(this.videoElem);a.overlaySubtitleElem=this.amazonUIChanger.overlaySubtitleContainerElem;k.appendChild(a.element);B();t=document.createElement("style");t.innerText="#subtitles_fll_player_box{width:100%; height:100%; position:fixed; top:0px; left:0px; z-index:200;}";document.getElementsByTagName("head")[0].appendChild(t);c=new SubtitlesForLLWordPopupWindow;c.init();c.clickCallback=(r,D)=>{let G=D.key;D=D.dic;"addUserWord"!=r&&"deleteUserWord"!=r||a.recolorSubtitleCells(G,
D)};k.appendChild(c.element);let A=document.createElement("div");A.className="subtitles_fll_open_close_button_container";A.style.cssText="direction:ltr; background-color:rgba(100,100,100,0.5); position:absolute; width:20px; height:40px; top:80px; right:"+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px; bottom:auto; left:auto; z-index:10001; cursor:pointer;";t=chrome.runtime.getURL("icons/double-right.svg");x=chrome.runtime.getURL("icons/double-left.svg");let F,n,l=document.createElement("img");l.alt=
"close";l.style.cssText="width:20px; height:40px;";0==subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)?(A.style.right=""+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px",A.style.borderRadius="20px 0px 0px 20px",l.style.marginLeft="3px",n=t,F=x):(A.style.left=""+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px",A.style.borderRadius="0px 20px 20px 0px",l.style.marginRight="3px",n=x,F=t);l.src=n;A.insertAdjacentElement("beforeend",l);let q=f.getElementsByClassName("scalingVideoContainer").item(0),
v=f.getElementsByClassName("webPlayerUIContainer").item(0)||f.getElementsByClassName("scalingUiContainer").item(0);A.onclick=r=>{A.style.transition="unset";r=document.getElementById("subtitles_fll_overlay_container");"none"==a.element.style.display?(a.element.style.display="block",l.src=n,l.alt="close",0==subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)?A.style.right=subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px":A.style.left=subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+
"px",q&&(q.style.width="calc(100% - "+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px)"),v&&(v.style.width="calc(100% - "+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px)"),r&&(r.style.width="calc(100% - "+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px)")):(a.element.style.display="none",l.src=F,l.alt="open",0==subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)?A.style.right="0px":A.style.left="0px",q&&(q.style.width="100%"),v&&(v.style.width="100%"),r&&(r.style.width=
"100%"))};k.insertAdjacentElement("beforeend",A);let C=w();v.addEventListener("mousemove",r=>{C&&(clearTimeout(C),C=null);A.classList.remove("subtitles_fll_hide_animation");A.classList.add("subtitles_fll_show_animation");C=w()});a.clickCallback=(r,D,G)=>{"word"==r?(r=window.getSelection().toString(),r&&0<r.length||(r=D.target.innerText,null==r||0>r.length||(c.draw(D.target.innerText,{clipMode:!0,eventTarget:D.target}),E=!1))):"googleDict"==r&&c.draw(G.subtitleContainerElem.innerText,{clipMode:!0,
eventTarget:D.target})};a.mouseLeaveCallback=(r,D)=>{"word"!=r&&"googleDict"!=r||0!=c.isClipMode||(c.hide(!1),"subtitles_fll_overlay_subtitle_cell_container"==D.target.parentElement.className&&(1==this.videoElem.paused&&E&&this.play(),E=!1))};let E=!1;a.mouseEnterCallback=(r,D,G)=>{if("word"==r||"googleDict"==r)if(1==c.isHidden||0==c.isClipMode)r="word"==r?D.target.innerText:G.subtitleContainerElem.innerText,r=r.replace(/\n/g," "),c.draw(r,{eventTarget:D.target}),"subtitles_fll_overlay_subtitle_cell_container"==
D.target.parentElement.className&&0==this.videoElem.paused&&(this.pause(),E=!0)};a.mouseUpCallback=r=>{let D=window.getSelection().toString();D&&0<D.length&&(enableClick=!1,c.draw(D,{forceDraw:!0,clipMode:!0,isSelectedText:!0,eventTarget:r.target}))};a.clickSeekButtonCallback=(r,D)=>{this.seekToSubtitle(D,r)};e.addEventListener("click",r=>{let D=window.getSelection().toString();D&&0<D.length||(0==c.isHidden()&&0==c.element.contains(r.target)&&r.target!=c.element&&c.hide(!0),0==this.amazonUIChanger.adjustmentMenuIsHide()&&
0==this.amazonUIChanger.adjustmentMenuElem.contains(r.target)&&r.target!=this.amazonUIChanger.adjustmentMenuElem&&this.amazonUIChanger.hideAdjustmentMenu())},!0);document.onkeydown=r=>{if("Space"==r.code&&r.target==document.body)return this.videoElem.paused?this.play():this.pause(),!1};if(t=document.querySelector(".cascadesContainer"))t.addEventListener("keydown",r=>{"INPUT"==r.target.tagName&&r.stopPropagation()},!0),t.addEventListener("keyup",r=>{"INPUT"==r.target.tagName&&r.stopPropagation()},
!0);document.addEventListener("keyup",r=>{if("INPUT"==r.target.tagName)return!0;if("KeyF"==r.code||r.shiftKey&&"Period"==r.code){var D=2>this.videoElem.playbackRate+.1?this.videoElem.playbackRate+.1:2;this.amazonUIChanger.changePlaybackRate(D.toFixed(1));this.showOverlayMessage("x"+D.toFixed(1));r.stopImmediatePropagation()}else"KeyS"==r.code||r.shiftKey&&"Comma"==r.code?(r=.1<this.videoElem.playbackRate-.1?this.videoElem.playbackRate-.1:.1,this.amazonUIChanger.changePlaybackRate(r.toFixed(1)),this.showOverlayMessage("x"+
r.toFixed(1))):"KeyE"==r.code||r.shiftKey&&"ArrowLeft"==r.code?(r=a.currentSubtitleIndex,D=a.subtitles,0<=r&&r<D.length&&(.5>this.videoElem.currentTime-b-D[r].startTime+this.amazonUIChanger.timing&&0<r?this.seekToSubtitle(D[r-1]):this.seekToSubtitle(D[r]))):"KeyD"==r.code||r.shiftKey&&"ArrowRight"==r.code?(r=a.currentSubtitleIndex,D=a.subtitles,0<=r&&r+1<D.length&&this.seekToSubtitle(D[r+1])):"KeyR"==r.code&&this.seekToSec(this.videoElem.currentTime-subtitlesForLL.configs.quickBackSec);return!1},
!0);e.addEventListener("mouseenter",r=>{});window.addEventListener("resize",r=>{c.refreshPosition(c.targetX,c.targetY)},!1);return this};const d=t=>{this.close();document.getElementById("subtitles_fll_main_container").remove()};this.close=()=>{this.isClosed||(a.closeSubtitles(),a.saveUsageSubtitleInfoFile(),a.sendUsageSubtitleInfo(),this.isLoadedData=!1,this.isClosed=!0,this.closeCallback())};this.play=()=>{if(0==subtitlesForLL.isChromeOSMode)this.videoElem.paused&&this.videoElem.play();else if(this.videoElem.paused){let t=
f.querySelector(".pausedOverlay");t&&(t.dispatchEvent(new PointerEvent("pointerdown",{pointerType:"mouse"})),t.dispatchEvent(new PointerEvent("pointerup",{pointerType:"mouse"})))}};this.pause=()=>{if(0==subtitlesForLL.isChromeOSMode)0==this.videoElem.paused&&this.videoElem.pause();else if(0==this.videoElem.paused){let t=f.querySelector(".pausedOverlay");t&&(t.dispatchEvent(new PointerEvent("pointerdown",{pointerType:"mouse"})),t.dispatchEvent(new PointerEvent("pointerup",{pointerType:"mouse"})))}};
let g=!1;this.seekToSubtitle=t=>{t=t.startTime-.1+b-this.amazonUIChanger.timing;this.seekToSec(0>t?0:t)};this.seekToSec=t=>{if(0==subtitlesForLL.isChromeOSMode)this.videoElem.paused&&this.play(),this.videoElem.currentTime=t;else{let u=h.parentElement;var x=u.getElementsByClassName("progressBar").item(0),z=x.getBoundingClientRect();t=z.left+(t-b)/this.videoElem.duration*x.offsetWidth;x=new PointerEvent("pointerdown",{pointerType:"mouse",clientX:t,clientY:z.top});u.dispatchEvent(x);z=new PointerEvent("pointerup",
{pointerType:"mouse",clientX:t,clientY:z.top});u.dispatchEvent(z);this.videoElem.paused&&(g=!0)}};let m;this.showOverlayMessage=t=>{m&&(clearTimeout(m),m=null);let x=k.getElementsByClassName("subtitles_fll_overlay_message").item(0);null==x&&(x=document.createElement("div"),x.className="subtitles_fll_overlay_message",x.style.cssText="position:absolute; text-align:left; font-size:40px; color:#ddd; z-index:10000; margin:50px; top:0px; left:0px;");x.innerHTML=t;k.insertAdjacentElement("beforeend",x);
m=setTimeout(()=>{x.remove();m=null},1E3)};this.changeVideoElem=t=>{this.videoElem=t;subtitlesForLL.isChromeOSMode&&(h.style.width="0.0%");a.changeVideoElem(this.videoElem);this.amazonUIChanger.changeVideoElem(this.videoElem);B()};this.setReceivedNewCatalogId=t=>{(this.isReceivedNewCatalogId=t)&&0==this.isLoadedData&&p()};const p=()=>{0==this.isReceivedNewCatalogId||this.isLoadedData||null==this.videoElem||2>this.videoElem.readyState||(this.isReceivedNewCatalogId=this.isClosed=!1,this.isLoadedData=
!0,this.refreshAdDuration(),a.videoLoadedData(null),subtitlesForLL.configs.playbackRate&&this.videoElem.playbackRate!=subtitlesForLL.configs.playbackRate&&(this.videoElem.playbackRate=subtitlesForLL.configs.playbackRate),this.amazonUIChanger.refreshSubtitlePosition(),this.amazonUIChanger.refreshAmazonSubtitlePosition())},B=()=>{a.videoLoadStart(void 0);this.videoElem.addEventListener("loadedmetadata",x=>{},!1);const t=x=>{this.isLoadedData||0==this.isReceivedNewCatalogId||p()};this.videoElem.addEventListener("loadeddata",
t,!0);2<=this.videoElem.readyState&&t();this.videoElem.addEventListener("timeupdate",x=>{this.videoElem&&(180>=this.videoElem.currentTime&&this.refreshAdDuration(),x=0,null!=this.amazonUIChanger.timing&&(x=this.amazonUIChanger.timing),a.syncSubtitle(this.videoElem.currentTime-b+x))},!1);this.videoElem.addEventListener("seeking",x=>{isNaN(this.videoElem.duration)&&console.warn("seeking\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f\u304cvideo.duration\u304cNaN\u3067\u3059\u3002\u60f3\u5b9a\u5916\u3067\u3059\u3002seeking\u3067\u306f\u306a\u304fseeked\u3067adDuration\u306e\u8a08\u7b97\u3092\u3059\u3079\u304d\u304b\u3082");
x=0;null!=this.amazonUIChanger.timing&&(x=this.amazonUIChanger.timing);a.scrollToSec(this.videoElem.currentTime-b+x)},!1);this.videoElem.addEventListener("seeked",x=>{this.refreshAdDuration()},!1);this.videoElem.addEventListener("play",x=>{0==this.isLoadedData&&p();a.startCountSubtitleUsageTime()},!1);this.videoElem.addEventListener("pause",x=>{a.stopCountSubtitleUsageTime()},!1);this.videoElem.addEventListener("waiting",x=>{},!1);this.videoElem.addEventListener("playing",x=>{},!1);this.videoElem.addEventListener("suspend",
x=>{},!1);this.videoElem.addEventListener("progress",x=>{},!1);this.videoElem.addEventListener("canplay",x=>{0==this.isLoadedData&&p()},!1);this.videoElem.addEventListener("canplaythrough",x=>{0==this.isLoadedData&&p();g&&(g=!1,this.videoElem.paused&&this.play())},!1);this.videoElem.addEventListener("stalled",x=>{},!1);this.videoElem.addEventListener("ended",x=>{a.saveUsageSubtitleInfoFile();a.sendUsageSubtitleInfo()},!1);this.videoElem.addEventListener("abort",x=>{a.saveUsageSubtitleInfoFile();a.sendUsageSubtitleInfo()},
!1);this.videoElem.addEventListener("error",x=>{},!1)},y=t=>{a.usageSubtitleInfo&&(a.usageSubtitleInfo.timing=t,a.saveUsageSubtitleInfoFile());a.scrollToSec(this.videoElem.currentTime-b+t)};this.refreshAdDuration=()=>{if(null==this.videoElem||isNaN(this.videoElem.duration)||null==h)b=0;else{let t=SubtitlesForLLPlayerController.calcAdDuration(this.videoElem,h);b!=t&&(b=t)}a.adDuration=b};this.getCurrentTime=()=>this.videoElem.currentTime()-b}
SubtitlesForLLPlayerController.calcAdDuration=(a,c)=>{let e;"INPUT"==c.tagName?e=c.value:"SPAN"==c.tagName?(e=parseFloat(c.style.width),isNaN(e)&&(e=0)):console.error("seekBarElem\u306etagName\u304c\u4f8b\u5916\u3067\u3059\u3002");a=0==subtitlesForLL.isChromeOSMode?(a.duration*e-100*a.currentTime)/(e-100):-(a.duration*e-100*a.currentTime)/100;return.02>a?0:a};function SubtitlesForLLSubtitleSelector(){let a=subtitlesForLL.localize.localize;this.searchResults=null;this.element=document.createElement("div");this.element.style.cssText="height:calc(100% - 40px);  overflow-y:scroll; color:#ddd;";this.downloadedSubtitleFileCallback=this.localSubtitle=this.messageElement=this.resultContainer=this.inputEpisodeElem=this.inputSeasonElem=this.searchButtonElem=this.inputWordElem=null;this.init=()=>{var k='<div class="subtitles_fll_subtitle_selector_search_container" style="margin:20px 0px;"><div class="subtitles_fll_subtitle_selector_search_container_line1" style="margin:10px 5px; position:relative;"><input class="subtitles_fll_subtitle_selector_input_word" type="text" placeholder="'+
a("Please enter a title")+'" style="font-size:18px; margin:5px; padding:0px 15px; width:calc(100% - 90px); background-color:#ddd; border:none; border-radius:30px; height:35px;"><button class="subtitles_fll_subtitle_selector_search_button" style="width:70px; height:35px; border-radius:30px; text-align:center; margin:5px; border:none; color:rgb(221, 221, 221); font-size:12px;">'+a("Search")+'</button></div><div style="display:flex; justify-content:center; align-items:center; white-space:nowrap;"><div style="margin: auto;"><span style="margin:10px 5px;">'+
a("Season")+'</span><input class="subtitles_fll_subtitle_selector_input_season" type="text" style="font-size:18px;padding:0px 6px;width:40px;background-color:#ddd;border:none;border-radius:30px;height:35px; text-align:right;"></div><div style="margin: auto;"><span style="margin:10px 5px;">'+a("Episode")+'</span><input class="subtitles_fll_subtitle_selector_input_episode" type="text" style="font-size:18px;padding:0px 6px;width:40px;background-color:#ddd;border:none;border-radius:30px;height:35px; text-align:right;"></div><div style="margin: auto;"><span style="margin:10px 5px;">'+
a("Year")+'</span><input class="subtitles_fll_subtitle_selector_check_year" type="checkbox" style="width:18px; height:18px;"><input class="subtitles_fll_subtitle_selector_input_year" type="text" style="font-size:18px;padding:0px 6px;width:65px;background-color:#777;border:none;border-radius:30px;height:35px; text-align:right;"></div></div><div class="subtitles_fll_subtitle_selector_search_container_line2" style="margin:10px;"><div style="text-align:right;">by <a href="https://www.opensubtitles.com/" target="_blank" rel=\u201dnoopener\u201d>OpenSubtitles.com</a></div></div></div><div class="dicpop_container" style="text-align:center; padding: 10px 0px; border-top: 1px solid rgb(68, 68, 68);"><a href="https://apps.apple.com/app/id1602968053" target="_blank" rel=\u201dnoopener\u201d style="line-height:40px;">YouTube Version (iOS) : <img class="app_store" src="'+
chrome.runtime.getURL("/icons/appstore.svg")+'"></a></div><div class="subtitles_fll_subtitle_selector_result_detail" style="padding:10px; border-top:1px solid #444;"></div><div class="subtitles_fll_subtitle_selector_result_container" style="height:calc(100% - 96px); position:relative;"></div>';this.element.innerHTML=k;this.hideSearchInterface();k=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_search_container").item(0);this.resultContainer=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_result_container")[0];
this.inputWordElem=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_input_word")[0];this.inputWordElem.onkeypress=h=>{13==(h.keyCode||h.charCode||0)&&c()};this.searchButtonElem=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_search_button")[0];this.searchButtonElem.onclick=c;this.inputSeasonElem=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_input_season")[0];this.inputEpisodeElem=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_input_episode")[0];
this.inputYearElem=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_input_year").item(0);this.inputYearCheck=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_check_year").item(0);this.inputYearCheck.addEventListener("change",h=>{this.inputYearElem.style.backgroundColor=this.inputYearCheck.checked?"#ddd":"#777"},{passive:!0,capture:!1});this.localSubtitle=new SubtitlesForLLLocalSubtitle;this.localSubtitle.init();this.localSubtitle.callback=(h,b)=>{h?(console.error(h),
console.error(b)):this.downloadedSubtitleFileCallback&&this.downloadedSubtitleFileCallback(subtitlesForLL.currentCatalogId,{SubFormat:b.fileType},b.text,"localSubtitle")};k.insertAdjacentElement("beforeend",this.localSubtitle.element);this.showLoadingView("")};this.initAllView=()=>{this.searchResults=null;this.hideSearchInterface();this.hideLoadingView();this.showLoadingView("");this.removeMessage();this.removeResults();this.hideSearchResultDetail()};this.showSearchInterface=()=>{this.element.getElementsByClassName("subtitles_fll_subtitle_selector_search_container")[0].style.display=
"block"};this.hideSearchInterface=()=>{this.element.getElementsByClassName("subtitles_fll_subtitle_selector_search_container")[0].style.display="none"};this.setSeasonAndEpisode=(k,h,b,d)=>{this.inputSeasonElem.value=h||"";this.inputEpisodeElem.value=b||"";this.inputYearElem.value=d||"";""==this.inputWordElem.value&&k&&0<k.length&&(this.inputWordElem.value=k)};this.showLoadingView=k=>{let h=this.element.getElementsByClassName("subtitles_fll_search_loading_view");null==h||0>=h.length?this.element.insertAdjacentHTML("beforeend",
'<div class="subtitles_fll_search_loading_view" style="position:absolute; height:100%; z-index:1; top:0; left:0; right:0; bottom:0; margin:0px; background-color:rgba(0,0,0,0.8);"><div style="height:100px;margin:auto 0px;position: absolute;top: 0;bottom: 0;left: 0;right: 0;"><div class="subtitles_fll_loading_text" style="color:#ddd; text-align:center; font-size:16px; margin:20px auto;">'+k+'</div><div><?xml version="1.0" encoding="utf-8"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin:auto; background:none; display:block; shape-rendering:auto;" width="80px" height="80px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="#dddddd" stroke-width="7" r="32" stroke-dasharray="150.79644737231007 52.26548245743669"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></svg></div></div></div>'):
(h[0].getElementsByClassName("subtitles_fll_loading_text")[0].innerHTML=k,h[0].style.display="block")};this.hideLoadingView=()=>{let k=this.element.getElementsByClassName("subtitles_fll_search_loading_view");k&&1<=k.length&&(k[0].style.display="none")};this.showSearchResultDetail=k=>{let h=this.element.getElementsByClassName("subtitles_fll_subtitle_selector_result_detail")[0];h.innerHTML=k;h.style.display="block"};this.hideSearchResultDetail=()=>{this.element.getElementsByClassName("subtitles_fll_subtitle_selector_result_detail")[0].style.display=
"none"};this.showMessage=k=>{this.resultContainer.innerHTML='<div class="subtitles_fll_search_result_message_view" style="position:absolute; height:150px; top:0; left:0; right:0; bottom:0; margin:auto;"><div style="color:#ddd; text-align:center; font-size:16px; margin:20px auto;">'+k+"</div></div>"};this.removeMessage=()=>{let k=this.element.getElementsByClassName("subtitles_fll_search_result_message_view");k&&1<=k.length&&k[0].remove()};this.showResults=(k,h,b)=>{if(h&&0<h.length){this.resultContainer.innerHTML=
"";k=document.createElement("div");k.classList.add("subtitle_cells");k.style.cssText="width:100%; margin:0px; color:#ddd;";for(let B=0;B<h.length;B++){a:{var d=void 0;var g=h[B].attributes;var m=B,p=b;if(0==Array.isArray(g.files)||0>=g.files.length){console.warn("\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u306e\u60c5\u5831\u304c\u60f3\u5b9a\u5916\u3067\u3059\u3002");g=null;break a}let y=document.createElement("div");y.className="subtitles_fll_search_result_cell";let t="#888";g.uploader&&g.uploader.rank&&
(d=g.uploader.rank.toLowerCase(),"administrator"==d||"moderator"==d||"subtranslator"==d||"super admin"==d||"translator"==d||"trusted member"==d?t="#ab9851":"admin warning"==d&&(t="#a05020"),d=a(g.uploader.rank,"userRank"));y.innerHTML='<a class="subtitles_fll_search_result_link" data-index="'+m+'"><div><div class="subtitles_fll_search_result_title">'+(g.feature_details.parent_title?subtitlesForLL.common.escapeHTML(g.feature_details.parent_title):subtitlesForLL.common.escapeHTML(g.feature_details.title))+
(g.feature_details.year?'<span style="margin-left:5px;">('+subtitlesForLL.common.escapeHTML(g.feature_details.year)+")</span>":"")+'</div><div class="subtitles_fll_search_result_episode_title">'+(null!=g.feature_details.season_number?" S:"+subtitlesForLL.common.escapeHTML(g.feature_details.season_number):"")+(null!=g.feature_details.episode_number?" Ep:"+subtitlesForLL.common.escapeHTML(g.feature_details.episode_number):"")+(g.feature_details.title&&null!=g.feature_details.episode_number?" - "+subtitlesForLL.common.escapeHTML(g.feature_details.title):
"")+'</div><div class="subtitles_fll_search_result_details">'+(g.download_count?"<span>"+a("DL")+" : "+Number(g.download_count).toLocaleString()+"</span>":"")+' <span style="margin-left:10px;">'+a("Language")+" : "+(g.language?subtitlesForLL.common.escapeHTML(g.language):"-")+'</span></div><div style="color:#888; width:100%; text-align:right;"></div><div class="subtitles_fll_search_result_uploader">'+(subtitlesForLL.common.escapeHTML(g.upload_date)?' <span style="margin-left:10px;">'+(new Date(g.upload_date)).toLocaleString()+
"</span>":"")+(subtitlesForLL.common.escapeHTML(g.uploader.name)?' <span style="margin-left:10px;">by '+subtitlesForLL.common.escapeHTML(g.uploader.name)+"</span>":"")+(d?'<span style="margin-left:2px;color:'+t+';">('+d+")</span>":"")+"</div></div></a>";p&&(y.querySelector(".subtitles_fll_search_result_link").onclick=p);g=y}null!=g&&k.insertAdjacentElement("beforeend",g)}this.resultContainer.appendChild(k)}};this.removeResults=()=>{this.resultContainer.innerHTML=""};const c=k=>{this.initAllView();
e(this.inputWordElem.value)},e=k=>{this.inputWordElem.value=k;this.showLoadingView(a("Searching for subtitles..."));let h={};h.languages=subtitlesForLL.languageCode.toOpensubtitlesComLangCode(subtitlesForLL.configs.learningLanguage);let b=k.match(/IMDB-ID:(?:tt)?([0-9]+)/i);null!=b?h.imdb_id=b[1]:h.query=k;0<this.inputSeasonElem.value.length&&(h.season_number=this.inputSeasonElem.value);0<this.inputEpisodeElem.value.length&&(h.episode_number=this.inputEpisodeElem.value);this.inputYearCheck.checked&&
this.inputYearElem&&0<this.inputYearElem.value.length&&(h.year=this.inputYearElem.value);subtitlesForLL.openSubtitlesApi.subtitles(h).then(d=>{let g=d&&d.data&&d.data.data;this.searchResults=g;200!=d.statusCode?this.showMessage("<div><p>"+a("OpenSubtitles.org returned an error.")+"</p><p>"+a("ERROR_"+req.status)+'</p></div><div style="text-align:left; margin:20px;"><p>'+subtitlesForLL.common.deleteTagAndEscapeHTML(req.responseText.substring(0,500))+"</p></div>"):g&&0<g.length?(h.imdb_id?this.showSearchResultDetail(a("Results for ")+
'<b><a href="https://www.imdb.com/title/tt'+encodeURIComponent(h.imdbid)+'" target="_blank" rel=\u201dnoopener\u201d>IMDB-ID:'+h.imdb_id+"</a></b>"):this.showSearchResultDetail(a("Results for ")+"<b>"+subtitlesForLL.common.escapeHTML(h.query)+"</b>"),this.showResults(h,g,f)):h.imdb_id?this.showSearchResultDetail(a("No results found for ")+'<b><a href="https://www.imdb.com/title/tt'+encodeURIComponent(h.imdbid)+'" target="_blank" rel=\u201dnoopener\u201d>IMDB-ID:'+h.imdbid+"</a></b>"):this.showSearchResultDetail(a("No results found for ")+
"<b>"+subtitlesForLL.common.escapeHTML(k)+"</b>")}).catch(d=>{console.error(d)}).finally(()=>{this.showSearchInterface();this.hideLoadingView()})},f=k=>{let h=this.searchResults[k.currentTarget.dataset.index];this.showLoadingView(a("Downloading..."));let b=subtitlesForLL.currentCatalogId;subtitlesForLL.openSubtitlesApi.loadSettings().then(d=>{this.showLoadingView("Downloading...");return this.download(h.attributes.files[0].file_id)}).then(d=>{this.hideLoadingView();this.downloadedSubtitleFileCallback&&
this.downloadedSubtitleFileCallback(b,{subFormat:"srt"},d.text,"openSubtitlesCom")}).catch(d=>{console.error(d)}).finally(()=>{this.hideLoadingView()})};this.download=k=>{this.showLoadingView("Downloading...");return new Promise((h,b)=>{subtitlesForLL.openSubtitlesApi.download({file_id:k}).then(d=>{this.hideLoadingView();if(d.data&&0>=d.data.remaining&&null==d.link){if(subtitlesForLL.openSubtitlesApi.hasLoadedSettings&&null==subtitlesForLL.openSubtitlesApi.token)return this.showLoadingView("Logging in to OpenSubtitles.com..."),
subtitlesForLL.openSubtitlesApi.login().then(g=>{if(200==g.status)return this.showLoadingView("Downloading..."),subtitlesForLL.openSubtitlesApi.download({file_id:k}).then(m=>{h(m)});this.showLoginWindow(g.message,m=>{m?this.download(k).then(p=>{h(p)}).catch(p=>{b(p)}):b(Error("\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"))})}).finally(()=>{this.hideLoadingView()});null==subtitlesForLL.openSubtitlesApi.token?this.showLoginWindow("(Reset-Time:"+d.data.reset_time+")",g=>
{g?this.download(k).then(m=>{h(m)}).catch(m=>{b(m)}):b(Error("\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"))}):(subtitlesForLL.showMessageBox("<p>"+a("\u5b57\u5e55\u30921\u65e5\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u56de\u6570\u306e\u4e0a\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002")+"</p><p>"+a("The time until the limit is reset")+":"+d.data.reset_time+"</p>"),b(Error(a("\u5b57\u5e55\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5236\u9650\u306b\u9054\u3057\u307e\u3057\u305f\u3002"))))}else h(d)}).catch(d=>
{console.error(d);this.hideLoadingView();b(d)})})};this.showLoginWindow=(k,h)=>{const b=a("The download of subtitles has reached the limit imposed by OpenSubtitles.com's API.");k=`
			${k?'<div style="font-weight:bold; color:red;">'+k+"</div>":""}
			<div>${a("OPENSUBTITLES_LOGIN_WINDOW_NOTE")}</div>
			<div class="subtitles_fll_login_container">
				<form id="subtitles_fll_os_form">
					<table style="width:auto; margin:20px 0px;"><tbody>
						<tr><td style="vertical-align:middle; padding:20px;">${a("OpenSubtitles User-ID")}</td><td style="vertical-align:middle; padding:20px;"><input type="text" id="subtitles_fll_os_user_name" name="os_user_name" autocomplete="off" value="" style="width:160px; height:35px; border-radius:20px; text-align:left; padding:0px 10px; border:none; outline:none;"></td></tr>
						<tr><td style="vertical-align:middle; padding:20px;">${a("OpenSubtitles Password")}</td><td style="vertical-align:middle; padding:20px;"><input type="text" id="subtitles_fll_os_password" name="os_pass" autocomplete="off" value="" style="width:160px; height:35px; border-radius:20px; text-align:left; padding:0px 10px; border:none; outline:none;"></td></tr>
					</tbody></table>
					<div><input id="subtitles_fll_os_save_pass" type="checkbox" checked>${a("SAVE_PASSWORD_MESSAGE")}</div>
					<div class="subtitles_fll_login_message" style="font-weight:bold; color:red;"></div>
					<div style="margin: 0px; margin-top: 20px; display: flex; flex-direction: row; flex-wrap: nowrap; align-content: center; align-items: center; justify-content: center;">
						<button id="subtitles_fll_os_cancel" data-index="0" type="button" style="width:100%; margin:5px; font-weight:bold; font-size:20px; text-align:center; border:solid 1px #555; padding:10px 20px; border-radius:20px;">${a("Cancel")}</button>
						<button id="subtitles_fll_os_login" class="subtitles_fll_green_link" data-index="1" type="submit" style="width:100%; margin:5px; font-weight:bold; font-size:20px; text-align:center; border:solid 1px #555; padding:10px 20px; border-radius:20px; border:none; color:#fff;">${a("Login")}</button>
					</div>
				</form>
			</div>
		`;const d=(m,p,B)=>{let y=p.querySelector("#subtitles_fll_os_user_name").value,t=p.querySelector("#subtitles_fll_os_password").value,x=p.querySelector("#subtitles_fll_os_save_pass").checked,z=p.querySelector(".subtitles_fll_login_message"),u=p.querySelectorAll("button");0==m?(h&&h(!1),p.remove()):1==m?0>=y.length||0>=t.length?(z.innerHTML=a("Please enter your OpenSubtitles.com Username and Password."),u.forEach(w=>{w.disabled=!1})):(z.innerHTML=a("Loggging in to OpenSubtitles.com..."),B.innerHTML=
a("Logging in..."),subtitlesForLL.openSubtitlesApi.loginWithIdAndPassword(y,t,x).then(w=>{200==w.status&&w.token?(p.remove(),h&&h(!0)):z.innerHTML=a("Login failed")+subtitlesForLL.common.escapeHTML(w.message)}).catch(w=>{z.innerHTML=a("Login failed")}).finally(()=>{u.forEach(w=>{w.disabled=!1});B.innerHTML=a("Login")})):(h&&h(!1),p.remove())};let g=subtitlesForLL.showMessageBox(b,k,[],d);g.querySelector("form").addEventListener("submit",m=>{m.preventDefault();d(1,g,g.querySelector("#subtitles_fll_os_login"))});
g.querySelector("#subtitles_fll_os_cancel").addEventListener("click",m=>{d(m.currentTarget.dataset.index,g,m.currentTarget)})}};function SubtitlesForLL(){this.myConstructor=()=>{this.SUBTITLESFLL_URL="http://localhost";this.SUBTITLE_CONTENTS_VIEW_WIDTH=400;this.DICTIONARY_BG_ALPHA=.8;this.SCROLL_BAR_WIDTH=12;this.USER_WORDS_MAX_COUNT=100;this.USER_WORD_COLORS={red:"#D44",orange:"#DA6",yellow:"#DD6",green:"#6B6"};this.AMAZON_LANGUAGES={"\u65e5\u672c\u8a9e":{subtitlesfll:"ja",amazon:"ja"},"\u0627\u0644\u0639\u0631\u0628\u064a\u0629":{subtitlesfll:"ar",amazon:"ar"},"Catal\u00e0":{subtitlesfll:"ca",amazon:"ca"},"\u010ce\u0161tina":{subtitlesfll:"cs",
amazon:"cs"},Dansk:{subtitlesfll:"da",amazon:"da"},Deutsch:{subtitlesfll:"de",amazon:"de"},"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac":{subtitlesfll:"el",amazon:"el"},English:{subtitlesfll:"en",amazon:"en"},"Espa\u00f1ol":{subtitlesfll:"es",amazon:"es"},"Espa\u00f1ol (Latinoam\u00e9rica)":{subtitlesfll:"es-419",amazon:"es-419"},"Espa\u00f1ol (Espa\u00f1a)":{subtitlesfll:"es-es",amazon:"es-es"},Euskara:{subtitlesfll:"eu",amazon:"eu"},Suomi:{subtitlesfll:"fi",amazon:"fi"},Filipino:{subtitlesfll:"tl",
amazon:"tl"},"Fran\u00e7ais":{subtitlesfll:"fr",amazon:"fr"},"Fran\u00e7ais (Canada)":{subtitlesfll:"fr",amazon:"fr-ca"},"Fran\u00e7ais (France)":{subtitlesfll:"fr",amazon:"fr-fr"},Galego:{subtitlesfll:"gl",amazon:"gl"},"\u05e2\u05d1\u05e8\u05d9\u05ea":{subtitlesfll:"he",amazon:"he"},"\u0939\u093f\u0928\u094d\u0926\u0940":{subtitlesfll:"hi",amazon:"hi"},Magyar:{subtitlesfll:"hu",amazon:"hu"},Indonesia:{subtitlesfll:"id",amazon:"id"},Italiano:{subtitlesfll:"it",amazon:"it"},"\u0c95\u0ca8\u0ccd\u0ca8\u0ca1":{subtitlesfll:"kn",
amazon:"kn"},"\ud55c\uad6d\uc5b4":{subtitlesfll:"ko",amazon:"ko"},"\u0d2e\u0d32\u0d2f\u0d3e\u0d33\u0d02":{subtitlesfll:"ml",amazon:"ml"},"Bahasa Melayu":{subtitlesfll:"ms",amazon:"ms"},"Norsk Bokm\u00e5l":{subtitlesfll:"nb",amazon:"nb"},Nederlands:{subtitlesfll:"nl",amazon:"nl"},Polski:{subtitlesfll:"pl",amazon:"pl"},"Portugu\u00eas (Brasil)":{subtitlesfll:"pt-br",amazon:"pt-br"},"Portugu\u00eas (Portugal)":{subtitlesfll:"pt-pt",amazon:"pt-pt"},"Rom\u00e2n\u0103":{subtitlesfll:"ro",amazon:"ro"},"\u0420\u0443\u0441\u0441\u043a\u0438\u0439":{subtitlesfll:"ru",
amazon:"ru"},Svenska:{subtitlesfll:"sv",amazon:"sv"},"\u0ba4\u0bae\u0bbf\u0bb4\u0bcd":{subtitlesfll:"ta",amazon:"ta"},"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41":{subtitlesfll:"te",amazon:"te"},"\u0e44\u0e17\u0e22":{subtitlesfll:"th",amazon:"th"},"T\u00fcrk\u00e7e":{subtitlesfll:"tr",amazon:"tr"},"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430":{subtitlesfll:"uk",amazon:"uk"},"Ti\u1ebfng Vi\u1ec7t":{subtitlesfll:"vi",amazon:"vi"},"\u4e2d\u6587\uff08\u7b80\u4f53\uff09":{subtitlesfll:"zh",
amazon:"zh-hans"},"\u4e2d\u6587\uff08\u7e41\u9ad4\uff09":{subtitlesfll:"zh-hant",amazon:"zh-hant"}};this.configs=null;this.userWords=new Map;this.isChromeOSMode=!1;this.queryParams=this.getQueryParams();this.hashData=this.getHashData();this.pageJsonData=null;this.isEnabledSubtitleViewer=this.hashData&&0!=this.hashData.enable?!0:!1;this.direction=null;this.playbackResources={};this.additionalEpisodeDataArray=[];this.subtitleViewer=this.pageTitle=this.currentCatalogId=this.currentContentId=null};this.init=
()=>{this.pageJsonData=this.parsePageJson();this.isEnabledSubtitleViewer&&(this.languageCode=new SubtitlesForLLLanguageCode,this.common=new SubtitlesForLLCommon)};this.getAsinFromCatalogId=a=>{if(null==a||10>=a.length)return console.error("\u5f15\u6570catalogId\u304ccatalogId\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002"),null;try{for(let c in this.pageJsonData.header.props.state.self)if(this.pageJsonData.header.props.state.self[c].gti==a)return this.pageJsonData.header.props.state.self[c].asins&&
this.pageJsonData.header.props.state.self[c].asins[0]?this.pageJsonData.header.props.state.self[c].asins[0]:c}catch(c){console.warn(c)}try{for(let c in this.pageJsonData.episodes.props.state.self)if(this.pageJsonData.episodes.props.state.self[c].gti==a)return this.pageJsonData.episodes.props.state.self[c].asins&&this.pageJsonData.episodes.props.state.self[c].asins[0]?this.pageJsonData.episodes.props.state.self[c].asins[0]:c}catch(c){console.warn(c)}try{for(let c of subtitlesForLL.additionalEpisodeDataArray)for(let e of c.widgets.titleContent[0].cards)if(e.self.gti==
a)return e.titleID}catch(c){console.warn(c)}console.warn("catalogId\u304b\u3089Asin\u3092\u5f97\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002");return null};this.getRootAsinFromCatalogId=a=>{null==a||10>a.length?console.error("\u5f15\u6570asinOrCatalogId\u304c\u60f3\u5b9a\u5916\u306e\u6587\u5b57\u5217\u3067\u3059\u3002"):10==a.length&&(a=this.getCatalogIdFromAsin(a));try{for(let c in this.pageJsonData.episodes.props.state.self)if(this.pageJsonData.episodes.props.state.self[c].gti==a){let e=
this.pageJsonData.episodes.props.state.pageTitleId;if(this.pageJsonData.header.props.state.self[e].asins[0])return this.pageJsonData.header.props.state.self[e].asins[0]}}catch(c){console.warn(c)}try{for(let c in this.pageJsonData.header.props.state.self)if(this.pageJsonData.header.props.state.self[c].gti==a)return this.pageJsonData.header.props.state.self[c].asins&&this.pageJsonData.header.props.state.self[c].asins[0]?this.pageJsonData.header.props.state.self[c].asins[0]:c}catch(c){console.warn(c)}try{for(let c of subtitlesForLL.additionalEpisodeDataArray)for(let e of c.widgets.titleContent[0].cards)if(e.self.gti==
a)return c.widgets.pageContext.pageTitleId}catch(c){console.warn(c)}console.warn("catalogId\u304b\u3089rootAsin\u3092\u5f97\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002");return null};this.getCatalogIdFromAsin=a=>{if(null==a||10!=a.length)return console.error("\u5f15\u6570asin\u304cASIN\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002"),null;try{if(this.pageJsonData.header.props.state.self[a])return this.pageJsonData.header.props.state.self[a].gti}catch(c){console.warn(c)}try{if(this.pageJsonData.episodes.props.state.self[a])return this.pageJsonData.episodes.props.state.self[a].gti}catch(c){console.warn(c)}try{for(let c of subtitlesForLL.additionalEpisodeDataArray)for(let e of c.widgets.titleContent[0].cards)if(e.titleID==
a)return e.self.gti}catch(c){console.warn(c)}console.warn("asin\u304b\u3089catalogId\u3092\u5f97\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002");return null};this.getPlaybackResourceFromCatalogId=a=>{for(let c in this.playbackResources)if(this.playbackResources[c].catalogId==a)return this.playbackResources[c];return null};this.getMovieData=a=>{let c;let e;if(a&&10>=a.length){c=a;var f=this.getCatalogIdFromAsin(c)}else if(null==a)e=subtitlesForLL.currentContentId,f=subtitlesForLL.currentCatalogId,
c=this.getAsinFromCatalogId(f);else{if(this.playbackResources[a])e=a,f=this.playbackResources[a].catalogId;else for(let h in this.playbackResources)if(this.playbackResources[h].catalogId==a){e=h;f=a;break}f&&(c=this.getAsinFromCatalogId(f))}a={};c&&(a.asin=c);if(f){var k=this.getRootAsinFromCatalogId(f);a.catalogId=f;a.rootAsin=k}this.playbackResources[e]&&(f=this.playbackResources[e])&&(f.seasonNumber&&(a.seasonNumber=f.seasonNumber),f.episodeNumber?(a.episodeNumber=f.episodeNumber,a.episodeTitle=
f.title):a.rootTitle=f.title,a.subtitleUrls=f.subtitleUrls,a.episodeImages=f.images);if(c&&10>=c.length){try{if(this.pageJsonData.header&&this.pageJsonData.header.props.state.detail.headerDetail[k]){const h=this.pageJsonData.header.props.state.detail.headerDetail[k];a.rootTitle=h.parentTitle||h.title;a.movieYear=h.releaseYear;a.movieImages=h.images}}catch(h){console.error(h)}try{if(this.pageJsonData.episodes&&this.pageJsonData.episodes.props.state.detail.detail[c]){const h=this.pageJsonData.episodes.props.state.detail.detail[c];
a.seasonNumber=a.seasonNumber||h.seasonNumber;a.episodeNumber=a.episodeNumber||h.episodeNumber;a.episodeTitle=a.episodeTitle||h.title;a.subtitleNames=a.subtitleNames||h.subtitles;a.episodeYear=a.episodeYear||h.releaseYear;a.episodeImages=a.episodeImages||h.images}else{k=!1;for(let h of this.additionalEpisodeDataArray){for(let b of h.widgets.titleContent[0].cards)if(b.titleID==c){k=!0;a.seasonNumber=a.seasonNumber||b.detail.seasonNumber;a.episodeNumber=a.episodeNumber||b.detail.episodeNumber;a.episodeTitle=
a.episodeTitle||b.detail.title;a.subtitleNames=a.subtitleNames||b.detail.subtitles;a.episodeYear=a.episodeYear||b.detail.releaseYear;a.episodeImages=a.episodeImages||b.detail.images;break}if(k)break}}}catch(h){console.error(h)}}return a};this.getEpisodeNumber=a=>{a=getMovieData(a);return null!=a.episodeNumber?a.episodeNumber:null};this.getSeasonNumber=a=>{a=getMovieData(a);return null!=a.episodeNumber?a.seasonNumber:null};this.getSubtitleFileName=(a,c)=>{a=this.getMovieData(a);return null==a||a.catalogId?
(console.error("getMovieData()\u3067catalogId\u304c\u53d6\u5f97\u3067\u304d\u306a\u304b\u3063\u305f\u305f\u3081\u5b57\u5e55\u30d5\u30a1\u30a4\u30eb\u306e\u751f\u6210\u304c\u51fa\u6765\u307e\u305b\u3093\u3067\u3057\u305f\u3002"),null):this.getSubtitleFileNameWithCatalogId(a.catalogId,c)};this.getSubtitleFileNameWithCatalogId=(a,c)=>{null!=c&&(c="."!=c.substring(0,1)?"."+c:c);return encodeURIComponent(a)+"_"+this.configs.learningLanguage+(null!=c?c:"")};this.getDefaultPlayUrl=(a,c)=>{a=(""+location.origin+
location.pathname).replace(/\/detail\/[^\?\/]*/,"/detail/"+encodeURIComponent(a));return a+="?"+this.getQueryParamsString(c)};this.getSubtitlePlayUrl=(a,c)=>{null==c&&(c={});c=this.encodeToBase64Url(JSON.stringify(c));a="string"===typeof a?new URL(a):a;return a.origin+a.pathname+a.search+"#"+c};this.getCurrentVideoTime=()=>subtitlesForLL.subtitleViewer&&subtitlesForLL.subtitleViewer.currentVideoElem&&null!=subtitlesForLL.subtitleViewer.currentVideoElem.currentTime?subtitlesForLL.subtitleViewer.currentVideoElem.currentTime:
null;this.getSubtitleSearchUrlFromAmazonUrl=a=>{let c=null,e=null;null!=a&&(c=this.parseAsinFromAmazonURL(a),e=this.getQueryParams(a));return this.getSubtitleSearchUrlFromId(c,e)};this.getSubtitleSearchUrlFromId=(a,c)=>{if(null!=a){var e=this.getSubtitleForLLSearchParams(a);c&&void 0!==c.t&&0==isNaN(c.t)&&(e.t=parseInt(c.t))}else{try{e=this.getSubtitleForLLSearchParams()}catch(f){return console.warn(f),null}a=this.getCurrentVideoTime();0==isNaN(a)&&(e.t=parseInt(a))}e="data="+this.encodeToBase64Url(e);
return this.SUBTITLESFLL_URL+"/search?"+e};this.getSubtitleForLLSearchParams=a=>{let c={host:location.host,searchLang:this.configs.learningLanguage};this.hashData&&this.hashData.searchTitle&&(c.searchTitle=this.hashData.searchTitle);a=this.getMovieData(a);c.catalogId=a.catalogId;c.asin=a.asin;null!=a.rootTitle&&(c.title=a.rootTitle);null!=a.movieYear&&(c.movieYear=a.movieYear);null!=a.seasonNumber&&(c.season=a.seasonNumber);null!=a.episodeNumber&&(c.episode=a.episodeNumber,null!=a.episodeYear&&(c.episodeYear=
a.episodeYear));null!=a.subtitlesUrls?c.subtitles=this._getAvailableSubtitles(a.subtitleUrls):null!=a.subtitleNames&&(c.subtitles=this._getAvailableSubtitles(a.subtitleNames));null!=a.movieImages?c.img=a.movieImages.covershot||a.movieImages.packshot||a.movieImages.titleshot||a.movieImages.heroshot:a.episodeImages&&(c.img=a.episodeImages.episode||a.episodeImages.hero);return c};this.parseAsinFromAmazonURL=a=>(a=a.match(/(?:\/video\/detail\/|\/dp\/)([A-Z0-9]{10,})/))&&2<=a.length?a[1]:"";this.parsePageJson=
()=>{let a=document.querySelectorAll('.av-page-desktop script[type="text/template"]'),c={};for(let e=0;e<a.length;e++){let f;try{f=JSON.parse(a[e].innerText)}catch(k){continue}f&&f.props&&f.props.state&&f.props.state.pageTitleId&&f.props.state.detail&&(f.props.state.detail.headerDetail&&0<Object.keys(f.props.state.detail.headerDetail).length?c.header=f:c.episodes=f)}return c};this._getAvailableSubtitles=a=>{var c=[];for(var e in this.AMAZON_LANGUAGES)this.AMAZON_LANGUAGES[e].subtitlesfll==this.configs.learningLanguage&&
c.push(e);e=[];if(0<a.length)if("string"===typeof a[0])for(let f of c)for(let k of a)0==k.search(new RegExp("^"+f,"i"))&&e.push({code:this.AMAZON_LANGUAGES[f].amazon,name:k});else if("object"===typeof a[0]){c=this.languageCode.toAmazonLangCode(this.configs.learningLanguage).replace(/-.*/g,"");for(let f of a)0==f.languageCode.indexOf(c)&&e.push({code:f.languageCode,name:f.displayName})}return e};this.getQueryParams=a=>{let c={};null==a?a=window.location:"string"===typeof a&&(a=new URL(a));if(a&&a.search&&
0<a.search.length){a=a.search.substring(1).split("&");for(let e=0;e<a.length;e++){let f=a[e].split("="),k=decodeURIComponent(f[0]);null==c[k]&&(c[k]=decodeURIComponent(f[1]))}}return c};this.getQueryParamsString=a=>{let c=Object.keys(a);c.sort();let e=[];for(let f=0;f<c.length;f++)e[f]=c[f]+"="+encodeURIComponent(a[c[f]]);return e.join("&")};this.getHashData=a=>{null==a&&(a=location.hash);if(1>=a.length)return null;"#"==a.substring(0,1)&&(a=a.substring(1));a=a.replace(/-/g,"+").replace(/_/g,"/");
a=(new TextDecoder).decode(new Uint8Array(Array.prototype.map.call(atob(a),c=>c.charCodeAt())));return JSON.parse(a)};this.replaceCurrentLocation=()=>{let a=this.getQueryParamsString(this.queryParams),c=this.encodeToBase64Url(JSON.stringify(this.hashData));location.replace(location.origin+location.pathname+(0<a.length?"?"+a:"")+"#"+c)};this.getElementsByTagNameFromAddedNode=(a,c)=>{let e=[];if(a.nodeType!=Node.ELEMENT_NODE)return e;a.tagName==c.toUpperCase()&&e.push(a);a=a.getElementsByTagName(c);
for(c=0;c<a.length;c++)e.push(a[c]);return e};this.getElementByClassNameFromAddedNode=(a,c)=>a.nodeType!=Node.ELEMENT_NODE?null:a.classList&&a.classList.contains(c)?a:(a=a.getElementsByClassName(c))&&0<a.length?a[0]:null;this.getElementsByClassNameFromAddedNode=(a,c)=>{let e=[];if(a.nodeType!=Node.ELEMENT_NODE)return e;a.classList&&a.classList.contains(c)&&e.push(a);a=a.getElementsByClassName(c);for(c=0;c<a.length;c++)e.push(a[c]);return e};this.getTargetElementsByQuerySelectorAll=(a,c)=>{let e;if(null==
a)e=document.body.querySelectorAll(c);else{e=[];for(let k=0;k<a.length;k++){let h=a[k].addedNodes;for(let b=0;b<h.length;b++){var f=h[b];if(f.nodeType==Node.ELEMENT_NODE){f.matches(c)&&e.push(f);f=f.querySelectorAll(c);for(let d=0;d<f.length;d++)e.push(f[d])}}}}return e};this.isRightToLeftLanguage=a=>{switch(a){case "ar":case "az":case "ug":case "ur":case "kk":case "ks":case "ky":case "ku":case "sd":case "tt":case "ps":case "pa":case "fa":case "ms":case "yi":case "he":case "dv":return!0;default:return!1}};
this.encodeToBase64Url=a=>{"object"===typeof a&&(a=JSON.stringify(a));a=String.fromCharCode.apply(null,(new TextEncoder).encode(a));return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")};this.decodeFromBase64Url=a=>{a=a.replace(/-/g,"+").replace(/_/g,"/");a=atob(a);a=new Uint8Array(Array.prototype.map.call(a,c=>c.charCodeAt()));return(new TextDecoder).decode(a)};this.decompressGzipBase64ToString=a=>{a=a.replace(/-/g,"+").replace(/_/g,"/");a=atob(a);a=new Uint8Array(Array.prototype.map.call(a,
f=>f.charCodeAt()));const c=new DecompressionStream("gzip"),e=c.writable.getWriter();e.write(a.buffer);e.close();return(new Response(c.readable)).arrayBuffer().then(f=>(new TextDecoder).decode(f))};this.showMessageBox=(a,c,e,f)=>{let k=this._createMessageBoxElement(a,c,e);document.body.insertAdjacentElement("beforeend",k);setTimeout(()=>{k.style.transition="backdrop-filter 0.5s, -webkit-backdrop-filter 0.5s";k.style.opacity="1";k.style.backdropFilter="blur(1.5px) brightness(0.5) grayscale(0.6)";k.style.webkitBackdropFilter=
"blur(1.5px) brightness(0.5) grayscale(0.6)"},0);const h=k.querySelectorAll(".buttons button");h.forEach(b=>{b.onclick=()=>{h.forEach(g=>{g.disabled=!0});let d=null;f&&(d=f(parseInt(b.dataset.index),k,b));1!=d&&null!=d||k.remove()}});return k};this._createMessageBoxElement=(a,c,e)=>{function f(h){return null==h||"OK"==h?{buttonTitle:"OK",classNames:["ok_button"]}:"CANCEL_OK"==h?[{buttonTitle:"\u30ad\u30e3\u30f3\u30bb\u30eb",classNames:["cancel_button"]},{buttonTitle:"OK",classNames:["ok_button"]}]:
"CANCEL"==h?{buttonTitle:"\u30ad\u30e3\u30f3\u30bb\u30eb",classNames:["cancel_button"]}:"string"===typeof h?{buttonTitle:h}:Array.isArray(h)?h.map(b=>f(b)):h}e=f(e);0==Array.isArray(e)&&(e=[e]);const k=document.createElement("div");k.classList.add("message_box");k.style.cssText="position:fixed; z-index:9999; top:-100px; left:-100px; width:calc(100% + 200px); height:calc(100% + 200px); box-sizing:border-box; margin:0px; text-align:center;";a='<div style="display:flex; width:100%; height:100%;"><div class="message_window" style="box-shadow:2px 2px 15px black; display:inline-block; background-color:#ddd; color:#333; border-radius: 30px; padding:30px; margin:auto; max-width: calc(100% - 300px); box-sizing:border-box;">'+
(a?'<h4 style="margin:0px; margin-bottom:10px; font-size:16px;">'+a+"</h4>":"")+(c?'<div class="message" style="display:inline-block; width:100%; margin:auto; text-align:left; font-size:15px;">'+c+"</div>":"")+(0<e.length?'<div class="buttons" style="margin: 0px; margin-top: 20px; display: flex; flex-direction: row; flex-wrap: nowrap; align-content: center; align-items: center; justify-content: center;">':"");for(c=0;c<e.length;c++){let h=e[c].buttonTitle,b=e[c].style||"";a+='<button class="'+(e[c].classNames||
[]).join(" ")+'" style="width:100%; margin:5px; font-weight:bold; font-size:20px; border:solid 1px #555; padding:10px 20px; border-radius:20px;'+b+'" data-index="'+c+'">'+h+"</button>"}a+=(0<e.length?"</div>":"")+"</div></div>";k.innerHTML=a;return k};this.setDirection=a=>{this.direction=a};this.setSubtitleViewer=a=>{this.subtitleViewer=a};this.setConfigs=a=>{this.configs=a};this.setUserWords=a=>{this.userWords=a};this.myConstructor()};function SubtitlesForLLUserWordsView(){const a=subtitlesForLL.localize.localize;this.init=()=>{this.element=document.createElement("div");this.element.className="subtitles_fll_user_words_view";this.element.style.cssText="color:#ddd; font-size:14px; overflow-y:scroll; height:calc(100% - 40px);";let f='<div style="height:100%;"><div style="margin:5px;">'+a("USER_WORDS_DESCRIPTION")+" MAX="+subtitlesForLL.USER_WORDS_MAX_COUNT+'</div><div style="margin:5px;">Colors: red, orange, yellow, green</div><table class="subtitles_fll_user_words_table"><thead><tr><th style="padding:0px 5px;">'+
a("Word")+"</th><th>"+a("\u8272")+"</th><th>"+a("Regex")+'</th></tr></thead><tbody class="subtitles_fll_user_words_tbody"></tbody></table><div style="text-align:center; margin:20px;"><button class="subtitles_fll_configs_add_button" style="width:150px; height:35px; text-align:center; border-radius:20px;">'+a("Add")+'</button></div><div style="text-align:center; margin:20px;"><button class="subtitles_fll_configs_save_button" style="width:150px; height:35px; text-align:center; border-radius:20px;">'+
a("Save")+"</button></div>";this.element.innerHTML=f;this.tbodyElem=this.element.querySelector(".subtitles_fll_user_words_tbody");this.element.querySelector(".subtitles_fll_configs_add_button").onclick=k=>{if(this.tbodyElem.childNodes.length>=subtitlesForLL.USER_WORDS_MAX_COUNT)alert("Can not save more than "+subtitlesForLL.USER_WORDS_MAX_COUNT+" words");else{k=document.createElement("tr");var h='<td><input class="subtitles_fll_user_word" type="text" style="width:150px; margin-left:5px;"></input></td><td><input class="subtitles_fll_user_word_color" type="text" style="width:80px;"></input></td><td style="vertical-align:middle; text-align:center;"><input class="subtitles_fll_user_word_is_regex" type="checkbox" style="margin:0px 5px;"></td><td style="vertical-align:middle;"><button class="subtitltes_fll_user_word_delete" style="height:31px; border-radius:15px;">'+
a("Delete")+"</button></td>";k.innerHTML=h;k.querySelector(".subtitltes_fll_user_word_delete").onclick=e;this.tbodyElem.insertAdjacentElement("beforeend",k)}};this.element.getElementsByClassName("subtitles_fll_configs_save_button")[0].onclick=k=>{let h=Object.keys(subtitlesForLL.USER_WORD_COLORS),b=new Map;this.tbodyElem.childNodes.forEach(d=>{var g=d.querySelector(".subtitles_fll_user_word_is_regex"),m=d.querySelector(".subtitles_fll_user_word");d=d.querySelector(".subtitles_fll_user_word_color");
if(!(null==m.value||0>=m.value.length)){m=m.value;d=d.value;var p=g.checked;-1>=h.indexOf(d)&&(d="red");d=d.toLowerCase();p?g="("+m+")":(g=m.replace(/(\\\*\+\.\?\{\}\(\)\[\]\^\$\|)/g,"\\$1").replace(/ /g,"\\s+"),g=0==subtitlesForLL.languageCode.isNotSeparateLanguage(subtitlesForLL.configs.learningLanguage)?"\\b("+g+")\\b":"("+m+")");dic={color:d,regex:g,isRegex:p};b.set(m,dic)}});subtitlesForLL.userWords=b;subtitlesForLL.configs.userWords=JSON.stringify([...b]);chrome.storage.sync.set(subtitlesForLL.configs);
this.callback&&this.callback("save",b)};c()};this.close=()=>{this.element.remove();this.element=this.element.innerHTML=null};const c=()=>{let f=subtitlesForLL.userWords,k=f.keys();for(;userWordKey=k.next().value;){var h=f.get(userWordKey);let b=document.createElement("tr");h='<td><input class="subtitles_fll_user_word" type="text" value="'+userWordKey+'" style="width:150px; margin-left:5px;"></input></td><td><input class="subtitles_fll_user_word_color" type="text" value="'+h.color+'" style="width:80px;"></input></td><td style="vertical-align:middle; text-align:center;"><input class="subtitles_fll_user_word_is_regex" type="checkbox" style="margin:0px 5px;"'+
(h.isRegex?' checked="checked"':"")+'></td><td style="vertical-align:middle;"><button class="subtitltes_fll_user_word_delete" style="height:31px; border-radius:15px;">'+a("Delete")+"</button></td>";b.innerHTML=h;b.querySelector(".subtitltes_fll_user_word_delete").onclick=e;this.tbodyElem.insertAdjacentElement("beforeend",b)}},e=f=>{f.target.parentElement.parentElement.remove()}};function SubtitlesForLLWordPopupWindow(){function a(b,d,g){let m="",p;for(let y=0;y<b.length;y++){0<y&&subtitlesForLL.common.availableLocalTranslate(d,g)&&(m+='<hr style="border:none; border-top:solid 1px #888; margin:0px;">');var B=b[y].meaning;m+='<div style="margin:10px 0px; font-size:'+subtitlesForLL.configs.dictionaryFontSize+'px;">';if(0==y||(b[y].originalWord||b[y].word)!=p)p=b[y].originalWord||b[y].word,m+='<h4 style="margin-bottom:10px; font-size:'+(subtitlesForLL.configs.dictionaryFontSize+
2)+'px !important;">'+p+"</h4>";b[y].reading&&(m+='<p class="subtitles_fll_color_orange">['+b[y].reading+"]</p>");m+="<ul>";let t;"string"==typeof B?t="en"==d&&"ja"==g?B.split(" / "):"ja"==d&&"en"==g?B.replace(/\/(\([^\)]+\) ?\([2-9]\))/gi,"\n$1").split("\n"):[B]:Array.isArray(B)&&(t=B);B=[];let x="margin-left:"+(subtitlesForLL.configs.dictionaryFontSize+8)+"px; margin-right:0px; margin-bottom:2px; list-style-position:outside;";subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)&&
(x="margin-right:"+(subtitlesForLL.configs.dictionaryFontSize+8)+"px; margin-left:0px; margin-bottom:2px; list-style-position:outside;");for(let z=0;z<t.length;z++){let u='<li style="'+x+'">';b[y].pos&&(u="es"==d||"es-419"==d?0==b[y].pos.indexOf("{")?u+(b[y].pos+" "):u+("{"+c(b[y].pos)+"} "):u+("["+c(b[y].pos)+"] "));u+=t[z]+"</li>";B.push(u)}0<B.length&&(B=B.join(""),B=B.replace(/(\u300a.+?\u300b|\{.+?\})/g,'<span class="subtitles_fll_color_orange">$1</span>'),B=B.replace(/(\u3008.+?\u3009|\|)/g,
'<span class="subtitles_fll_color_yellow">$1</span>'),B=B.replace(/(\[.+?\]|\(.+?\))/g,'<span class="subtitles_fll_color_green">$1</span>'),"en"==d&&"ja"==g&&(B=B.replace(/\u3008C\u3009/g,'<span class="subtitles_fll_color_darkgray"> \u53ef\u7b97\u540d\u8a5e </span>'),B=B.replace(/\u3008U\u3009/g,'<span class="subtitles_fll_color_darkgray"> \u4e0d\u53ef\u7b97\u540d\u8a5e </span>')),m+=B);b[y].discription&&0<b[y].discription.length&&(b[y].discription=b[y].discription.replace(/([\u300a\{].+?[\u300b\}])/g,
'<span class="subtitles_fll_color_orange">$1</span>'),m+='<li class="subtitles_fll_color_gray">'+b[y].discription+"</li>");b[y].classifiers&&0<b[y].classifiers.length&&(m+='<li class="subtitles_fll_color_gray">'+c("Classifiers")+" : "+b[y].classifiers.join("; ")+"</li>");b[y].synonyms&&0<b[y].synonyms.length&&(m+='<li class="subtitles_fll_color_gray">'+c("Synonyms")+" : "+b[y].synonyms.join("; ")+"</li>");b[y].antonyms&&0<b[y].antonyms.length&&(m+='<li class="subtitles_fll_color_gray">'+c("Antonyms")+
" : "+b[y].antonyms.join("; ")+"</li>");b[y].examples&&0<b[y].examples.length&&(m+='<li class="subtitles_fll_color_gray">'+c("Example")+" : "+b[y].examples.join("; ")+"</li>");b[y].definitions&&0<b[y].definitions.length&&(m+='<li class="subtitles_fll_color_gray">'+c("Definitions")+" : "+b[y].definitions.join("; ")+"</li>");m+="</ul>";m+="</div>"}return m}let c=subtitlesForLL.localize.localize;const e={all:256},f=["red","orange","yellow","green"];this.element=null;this.targetY=this.x=0;this.word=null;
this.isClipMode=this.isLoading=!1;this.clickCallback=null;this.init=()=>{this.element=document.createElement("div");this.element.setAttribute("id","subtitles_fll_word_popup_window");this.element.classList.add("word_popup_window_scroll_bar");this.element.style.cssText="font-size:14px; color:#fff; border-radius:10px; max-width:400px; min-height:50px; max-height:calc(100% - 20px); overflow-y:scroll; position:absolute; top:10px; left:10px; z-index:99999; padding:15px 5px; word-break:break-all;";this.element.style.display=
"none";this.element.innerHTML='<div class="subtitles_fll_word_popup_window_menu" style="display:none; height:20px; margin:0px 0px 20px 5px;"><div class="subtitles_fll_user_word_colors" style="margin-left:0px; margin-right:10px; white-space:nowrap;"><span data-index="0" style="display:inline-block; margin-left: 0px; margin-right: 5px; background-color: #D44; width: 20px; height: 20px; border-radius:10px; cursor:pointer;"></span><span data-index="1" style="display:inline-block; margin-left: 0px; margin-right: 5px; background-color: #DA6; width: 20px; height: 20px; border-radius:10px; cursor:pointer;"></span><span data-index="2" style="display:inline-block; margin-left: 0px; margin-right: 5px; background-color: #DD6; width: 20px; height: 20px; border-radius:10px; cursor:pointer;"></span><span data-index="3" style="display:inline-block; margin-left: 0px; margin-right: 5px; background-color: #6B6; width: 20px; height: 20px; border-radius:10px; cursor:pointer;"></span><span data-index="4" style="display:inline-block; margin-left: 0px; margin-right: 5px; background-color: #ddd; width: 20px; height: 20px; border-radius:10px; cursor:pointer;" title="Remove"></span></div><div class="subtitles_fll_word_popup_window_close" style="margin: -10px 0px 0px 0px; width:40px; height:40px; padding:10px; cursor:pointer; border-radius:20px;"><svg viewBox="0 0 612 612" xmlns="http://www.w3.org/2000/svg"><g><line stroke="#dddddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_1" y2="561.45315" x2="561.49999" y1="48.45311" x1="51.5" stroke-width="99" fill="none"/><line stroke="#dddddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_2" y2="562" x2="561" y1="50" x1="50" stroke-width="99" fill="none"/><line transform="rotate(90 305.5,306.00000000000006) " stroke="#dddddd" stroke-linecap="undefined" stroke-linejoin="undefined" id="svg_4" y2="562" x2="561" y1="50" x1="50" stroke-width="99" fill="none"/></g></svg></div></div><div><h4 class="subtitles_fll_word_popup_window_title" style="margin:0px 10px; font-size:'+
(subtitlesForLL.configs.dictionaryFontSize+2)+'px;">\u8abf\u3079\u305f\u5358\u8a9e</h4></div><div class="subtitles_fll_word_popup_window_loading_container"><p class="subtitles_fll_word_popup_window_loading_text" style="margin:0px 10px;"></p></div><div class="subtitles_fll_word_popup_window_meaning" style="margin:0px 10px;">\u5358\u8a9e\u306e\u610f\u5473</div>';this.menuBarElem=this.element.getElementsByClassName("subtitles_fll_word_popup_window_menu")[0];this.titleElem=this.element.getElementsByClassName("subtitles_fll_word_popup_window_title")[0];
this.meaningElem=this.element.getElementsByClassName("subtitles_fll_word_popup_window_meaning")[0];this.loadingContainer=this.element.getElementsByClassName("subtitles_fll_word_popup_window_loading_container")[0];this.loadingTextElem=this.element.getElementsByClassName("subtitles_fll_word_popup_window_loading_text")[0];this.closeContainerElem=this.element.getElementsByClassName("subtitles_fll_word_popup_window_close")[0];this.colorContainerElem=this.element.getElementsByClassName("subtitles_fll_user_word_colors")[0];
for(let d=0;d<this.colorContainerElem.childNodes.length;d++)this.colorContainerElem.childNodes[d].onclick=g=>{g=g.target.dataset.index;let m=this.word.trim().toLowerCase();var p=subtitlesForLL.userWords.get(m);let B;if(4==g)if(p)subtitlesForLL.userWords.delete(m),B="deleteUserWord";else return;else{if(subtitlesForLL.userWords.size+1>=subtitlesForLL.USER_WORDS_MAX_COUNT){alert("Can not save more than "+subtitlesForLL.USER_WORDS_MAX_COUNT+" words");return}p=m.replace(/(\\\*\+\.\?\{\}\(\)\[\]\^\$\|)/g,
"\\$1").replace(/ /g,"\\s+");p=0==subtitlesForLL.languageCode.isNotSeparateLanguage(subtitlesForLL.configs.learningLanguage)?"\\b("+p+")\\b":"("+m+")";p={regex:p,color:f[g]};subtitlesForLL.userWords.set(m,p);B="addUserWord"}k(g);subtitlesForLL.configs.userWords=JSON.stringify([...subtitlesForLL.userWords]);chrome.storage.sync.set(subtitlesForLL.configs);this.clickCallback&&this.clickCallback(B,{key:m,dic:p})};this.dictionaryLinksElem=h();this.closeContainerElem.insertAdjacentElement("beforebegin",
this.dictionaryLinksElem);subtitlesForLL.isRightToLeftLanguage(subtitlesForLL.configs.learningLanguage)?(this.closeContainerElem.style.marginLeft="0px",this.meaningElem.style.direction="rtl",this.menuBarElem.style.direction="rtl"):(this.closeContainerElem.style.marginRight="0px",this.meaningElem.style.direction="ltr",this.menuBarElem.style.direction="ltr");this.closeContainerElem.onclick=()=>{this.hide(!0)};let b=new MutationObserver(()=>{b.disconnect();this.refreshPosition(this.targetX,this.targetY);
b.observe(this.element,{childList:!0,characterData:!0,subtree:!0})});b.observe(this.element,{childList:!0,characterData:!0,subtree:!0});return this};const k=b=>{this.colorContainerElem.childNodes.forEach(d=>{d.style.border=null});if(null!=b)this.colorContainerElem.childNodes[b].style.border="2px solid #FFF";else if(b=subtitlesForLL.userWords.get(this.word.toLowerCase()))b=f.indexOf(b.color),this.colorContainerElem.childNodes[b].style.border="2px solid #FFF"},h=()=>{let b=document.createElement("div");
b.style="margin-left:auto; margin-right:0px;";var d=subtitlesForLL.configs.learningLanguage,g=subtitlesForLL.configs.nativeLanguage;d=null==subtitlesForLL.configs.userDictionaryRules||null==subtitlesForLL.configs.userDictionaryRules[d]||null==subtitlesForLL.configs.userDictionaryRules[d][g]?subtitlesForLL.common.getDefaultDictionaryRules(d,g):subtitlesForLL.configs.userDictionaryRules[d][g];for(g=0;g<d.length;g++){let m=d[g],p=document.createElement("a");p.style="line-height:20px; margin-right:10px; color:#30b7ec;";
p.innerHTML=m.name;p.onclick=B=>{let y=m.url;y=y.replace(/\$WORD/g,encodeURIComponent(this.word));y=y.replace(/\$LEARNING_LANG_GOOGLE/g,subtitlesForLL.languageCode.toGoogleLangCode(subtitlesForLL.configs.learningLanguage));y=y.replace(/\$NATIVE_LANG_GOOGLE/g,subtitlesForLL.languageCode.toGoogleLangCode(subtitlesForLL.configs.nativeLanguage));window.open(y,m.name,"noopener,top="+(B.screenY-300)+",left="+(window.screenX+window.outerWidth)+",width=760,height=600")};b.appendChild(p)}return b};this.changeClipMode=
b=>{(this.isClipMode=b)?(k(null),this.dictionaryLinksElem&&(this.dictionaryLinksElem.remove(),this.dictionaryLinksElem=h(),this.closeContainerElem.insertAdjacentElement("beforebegin",this.dictionaryLinksElem)),this.menuBarElem.style.display="flex",this.element.classList.add("popup_window_clip_mode"),b=.9,b<subtitlesForLL.configs.dictionaryBackgroundAlpha&&(b=1),this.element.style.backgroundColor="rgba(50,50,50,"+b+")"):(this.menuBarElem.style.display="none",this.element.classList.remove("popup_window_clip_mode"),
this.element.style.backgroundColor="rgba(50,50,50,"+subtitlesForLL.configs.dictionaryBackgroundAlpha+")")};this.draw=(b,d)=>{let g=subtitlesForLL.configs.learningLanguage,m=subtitlesForLL.configs.nativeLanguage;if(d&&d.isSelectedText){b=b.replace(new RegExp("^(?:["+subtitlesForLL.common.separatorRegexNotHyphenApos+"]+)|(?:["+subtitlesForLL.common.separatorRegexNotHyphenApos+"]+$)","gm"),"");b=b.replace(/\n.*/g,"");var p=e[subtitlesForLL.configs.learningLanguage]||e.all;if(0==subtitlesForLL.common.availableLocalTranslate(g,
m)&&b.length>p||256<b.length)return}if(!(0>=b.length))if(g==m)console.warn("fromLang == toLang\u306a\u306e\u3067API\u3067\u610f\u5473\u306f\u8abf\u3079\u307e\u305b\u3093 fromLang = "+g),this.hide(!1);else{this.meaningElem&&(this.meaningElem.innerHTML="");this.word=b;this.titleElem.innerHTML=b;this.titleElem.style.display="block";this.element.style.display="block";this.element.classList.remove("subtitles_fll_fadeout_animation");d&&1==d.clipMode?this.changeClipMode(!0):this.changeClipMode(!1);d&&d.eventTarget?
(p=d.eventTarget.getBoundingClientRect(),this.refreshPosition(p.left,p.top)):this.refreshPosition();this.loadingTextElem.innerHTML=c("Now Loading...");this.loadingContainer.style.display="block";var B={};subtitlesForLL.languageCode.isNotSeparateLanguage(g)&&("ja"==g?(B.recursiveSearch=!0,B.enableDecreaseSearch=!0):B.recursiveSearch=!1);subtitlesForLL.common.waitForLaunchingServiceWorker(()=>{let y=chrome.runtime.connect({name:"Subtitles for Language Learning (Prime Video)"});y.onMessage.addListener(t=>
{y.disconnect();y=null;let x;if("local"==t.type)x=t.words;else if("api"==t.type||"googleDict"==t.type){if(0==t.status&&0==t.isError)return;if(200!=t.status){if(0==t.status){if(0==t.isError)return;this.loadingTextElem.innerHTML=c("Connection error");return}this.loadingTextElem.innerHTML=429==t.status&&t.responseText?t.responseText:c("ERROR")+" : "+t.status;return}x=[];if("api"==t.type){if(t.response&&t.response.translations)for(var z=0;z<t.response.translations.length;z++){var u={};u.word=t.response.translations[z].displaySource;
u.meaning=t.response.translations[z].displayTarget;u.pos=t.response.translations[z].posTag;x.push(u)}}else if("googleDict"==t.type&&t.response)if(u=t.response,u.sentences||u.dict||u.alternative_translations&&0<u.alternative_translations.length)u.dict&&0<u.dict.length&&u.dict.forEach(w=>{x.push({word:w.base_form,meaning:w.terms,pos:w.pos})}),u.alternative_translations&&0<u.alternative_translations.length?u.alternative_translations.forEach(w=>{if(!(null==w.alternative||0>=w.alternative.length)){var A=
{};A.word=w.src_phrase;A.meaning=[];w.alternative.forEach(F=>{A.meaning.push(F.word_postproc)});x.push(A)}}):u.sentences&&0<u.sentences.length&&u.sentences.forEach(w=>{w.orig&&w.trans&&x.push({word:w.orig,meaning:w.trans})});else if(Array.isArray(u))if(2<=u.length){z=u[0];u=u[1];if(z&&0<z.length){let w={word:b,meaning:[]};z.forEach(A=>{A[0]&&w.meaning.push(A[0])});x.push(w)}u&&0<u.length&&u.forEach(w=>{let A={word:b,meaning:w[1]};w[0]&&(A.pos=w[0]);x.push(A)})}else u[0]&&u[0][0]&&u[0][0][0]&&u[0][0][0][0]&&
"string"===typeof u[0][0][0][0][0]&&x.push({word:b,meaning:u[0][0][0][0]})}if(null==x||0>=x.length)this.loadingTextElem.innerHTML=c("No results");else{if("ja"==g&&"en"==m){z=[];for(u=0;u<x.length;u++)x[u].originalWord==b&&(z.push(x[u]),x.splice(u,1),u--);x=z.concat(x)}this.loadingContainer.style.display="none";this.titleElem.style.display="none";this.meaningElem&&this.meaningElem.remove();z=a(x,g,m);"local"==t.type&&x&&0<x.length&&"ja"==g&&"en"==m&&(z+='<div style="text-align:right;">by <a href="http://www.edrdg.org/wiki/index.php/JMdict-EDICT_Dictionary_Project" target="_blank" rel=\u201dnoopener\u201d>Edict</a></div>');
this.meaningElem.innerHTML=z;this.element.insertAdjacentElement("beforeend",this.meaningElem);d&&d.eventTarget?(t=d.eventTarget.getBoundingClientRect(),this.refreshPosition(t.left,t.top)):this.refreshPosition()}});y.postMessage({type:"searchWord",data:{from:g,to:m,word:b},options:B})})}};this.refreshPosition=(b,d)=>{if(!this.isHidden()&&null!=this.element.parentElement){var g=subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH;"none"==document.getElementById("subtitles_fll_contents_view").style.display&&
(g=0);this.element.style.height="auto";if(null!=b&&null!=d)if(b<this.element.parentElement.clientWidth-g){this.element.style.right=null;var m=b-this.element.clientWidth/2;var p=d-this.element.clientHeight-10;10>p&&(this.element.style.height=d-20+"px");this.element.style.maxWidth="400px"}else m=null,p=d-.5*this.element.clientHeight,this.element.style.maxWidth=400>this.element.parentElement.clientWidth-g?""+(this.element.parentElement.clientWidth-g)+"px":"400px";else g=this.element.getBoundingClientRect(),
m=g.left,p=g.bottom;p+this.element.clientHeight+10>this.element.parentElement.clientHeight&&(p=this.element.parentElement.clientHeight-this.element.clientHeight-10);10>p&&(p=10);null!=m&&0>m&&(m=10);this.setPosition(m,p,b,d)}};this.setPosition=(b,d,g,m)=>{null!=b?(this.x=b,this.element.style.left=""+b+"px"):(this.element.style.left="auto",this.element.style.right=""+subtitlesForLL.SUBTITLE_CONTENTS_VIEW_WIDTH+"px");null!=d&&(this.y=d,this.element.style.top=""+d+"px");g&&(this.targetX=g);m&&(this.targetY=
m)};this.hide=b=>{if(!this.isHidden())if(b){if(0==this.element.classList.contains("subtitles_fll_fadeout_animation")){this.element.classList.add("subtitles_fll_fadeout_animation");let d=()=>{this.element.classList.remove("subtitles_fll_fadeout_animation");this.element.style.display="none";this.changeClipMode(!1);this.element.removeEventListener("animationend",d)};this.element.addEventListener("animationend",d)}}else this.element.style.display="none"};this.isHidden=()=>"none"==this.element.style.display}
SubtitlesForLLWordPopupWindow.isMouseEnterPopupNotSupportLanguage=a=>"km"==a||"lo"==a||"my"==a?!0:!1;
